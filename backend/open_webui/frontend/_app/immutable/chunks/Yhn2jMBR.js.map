{"version":3,"mappings":"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","names":["handle_promise","promise","info","token","update","type","index","key","value","child_ctx","block","needs_flush","i","group_outros","transition_out","check_outros","transition_in","flush","is_promise","current_component","get_current_component","set_current_component","error","update_await_block_branch","ctx","dirty","resolved","dispatch","createEventDispatcher","chatId","$$props","tags","getTags","getTagsById","addTag","tagName","addTagById","toast","$$invalidate","updateChatById","_tags","getAllTags","deleteTag","deleteTagById","onMount","e","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","retry","charCode","EventSourceParserStream","parser","controller","event","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","done","parsedData","_c","_b","_a","textStreamUpdate","content","chunkSize","sleep","ms","resolve","insert_hydration","target","svg","anchor","append_hydration","path","className","strokeWidth","API_KEY","CLIENT_ID","getCredentials","response","config","SCOPE","validateCredentials","oauthToken","initialized","loadGoogleDriveApi","reject","script","loadGoogleAuthApi","getAuthToken","initialize","createPicker","doc","fileId","fileName","fileUrl","mimeType","downloadUrl","exportFormat","errorText","blob","result","_OneDriveConfig","__publicField","authorityType","_d","authorityEndpoint","clientId","msalParams","PublicClientApplication","__vitePreload","sharePointBaseUrl","OneDriveConfig","getToken","resource","authParams","accessToken","msalInstance","resp","popupError","getPickerParams","channelId","uuidv4","params","downloadOneDriveFile","fileInfo","fileInfoUrl","downloadResponse","openOneDrivePicker","pickerWindow","channelPort","baseUrl","handleWindowMessage","message","handlePortMessage","portEvent","portData","command","newToken","cleanup","authToken","queryString","url","form","input","err","pickAndDownloadFile","pickerResult","selectedFile","path0","path1","path2","div","create_if_block_2","each_blocks","set_data","t","t_value","decodeString","attr","button","button_class_value","button_data_selected_value","tooltip_changes","current","div1","div0","t1","t1_value","i18n","getContext","onSelect","loaded","items","selectedIdx","page","itemsLoading","allItemsLoaded","loadMoreItems","getItemsPage","res","getChatList","item","$chatId","dayjs","tick","idx","tooltip1_changes","getNoteList","note","tooltip0_changes","$knowledge","knowledge","getKnowledgeBases","legacy_documents","legacy_collections","$i18n","a","tag","collections","collection_files","file","div4","h1","button0","div3","label","div2","button1","t0","t0_value","t3","t3_value","t6","t6_value","show","onSubmit","submitHandler","isValidHttpUrl","isYoutubeUrl","create_if_block_12","create_if_block_11","div2_intro","create_in_transition","fly","if_block0","create_if_block_6","create_if_block_5","create_if_block_4","create_if_block_1","tooltip2_changes","div_intro","t2","t2_value","create_if_block_3","if_block1","_f","_e","_h","_g","path3","path4","path5","mask","g","defs","linearGradient0","stop0","stop1","linearGradient1","stop2","stop3","linearGradient2","stop4","stop5","linearGradient3","stop6","stop7","flyAndScale","files","selectedModels","fileUploadCapableModels","screenCaptureHandler","uploadFilesHandler","inputFilesHandler","uploadGoogleDriveHandler","uploadOneDriveHandler","onUpload","onClose","tab","showAttachWebpageModal","fileUploadEnabled","detectMobile","userAgent","handleFileChange","inputFiles","init","f","cameraInputElement","$user","br","t4","t4_value","_i","_j","each_value_1","ensure_array_like","create_if_block","selectedToolIds","selectedTools","$tools","tool","span","create_if_block_10","show_if","each_value","get_key","src_url_equal","img","img_src_value","img_class_value","img_alt_value","switch_1_changes","button_aria_label_value","toggleFilters","selectedFilterIds","showWebSearchButton","webSearchEnabled","showImageGenerationButton","imageGenerationEnabled","showCodeInterpreterButton","codeInterpreterEnabled","onShowValves","closeOnOutsideClick","tools","$_tools","_tools","getTools","arr","$toolServers","serverIdx","server","id","func","b","filter","toolId","state","parts","serverId","authUrl","getOAuthClientAuthorizationUrl","constants_0","args","create_if_block_19","div6","div5","create_if_block_18","create_if_block_15","create_if_block_14","if_block3","create_if_block_13","create_if_block_8","create_if_block_7","if_block9","div7","WEBUI_BASE_URL","fileitem_changes","create_if_block_17","image_changes","richtextinput_changes","create_if_block_9","button_disabled_value","DOMPurify","marked","html_tag","raw_value","valvesmodal_changes","onChange","createMessagePair","stopResponse","autoScroll","generating","atSelectedModel","selectedModelIds","history","taskIds","prompt","showInputVariablesModal","inputVariablesModalCallback","variableValues","inputVariables","inputVariableValues","showValvesModal","selectedValvesType","selectedValvesItemId","integrationsMenuCloseOnOutsideClick","inputVariableHandler","text","extractInputVariables","replaceVariables","textVariableHandler","clipboardText","clipboardItems","imageUrl","location","getUserPosition","sessionUser","getSessionUser","name","bio","gender","birthDate","age","getAge","language","date","getFormattedDate","time","getFormattedTime","dateTime","getCurrentDateTime","timezone","getUserTimezone","weekday","getWeekday","variables","chatInputElement","setText","cb","getCommand","chatInput","word","replaceCommandWithText","insertTextAtCursor","chatInputContainer","extractCurlyBraceWords","showCommands","suggestions","showTools","recording","isComposing","compositionEndedAt","isSafari","inOrNearComposition","filesInputElement","dragged","shiftKey","placeholder","visionCapableModels","webSearchCapableModels","imageGenerationCapableModels","codeInterpreterCapableModels","showToolsButton","scrollToBottom","element","mediaStream","video","canvas","track","uploadFileHandler","fullContext","$_user","tempItemId","fileItem","$temporaryChatEnabled","extractContentFromFile","metadata","$settings","uploadedFile","uploadFile","WEBUI_API_BASE_URL","$config","compressImageHandler","settings","settingsCompression","configWidth","configHeight","width","height","compressImage","convertHeicToJpeg","onDragOver","onDragLeave","onDrop","onKeyDown","onKeyUp","onFocus","onBlur","getSuggestionRenderer","CommandSuggestionList","dropzoneElement","onDestroy","m","$$value","_inputFiles","filename","func_3","model","func_4","fileIdx","generateAutoCompletion","createMessagesList","func_7","isCtrlPressed","suggestionsContainerElement","regenerateButton","userMessageElement","editButton","$mobile","clipboardData","PASTED_TEXT_CHARACTER_LIMIT","fileData","filterId","func_16","click_handler_7","click_handler_8","click_handler_9","stream","$TTSWorker","TTSWorker","KokoroWorker","showCallOverlay","showControls","$models","acc","filters","f1","f2","if_block","selector_changes","disabled","showSetDefault","saveDefaultModel","it","updateUserSettings","pinModelHandler","modelId","pinnedModels","selectedModelIdx","_selectedModels","Tags","hr0","hr1","tags_changes","hr","saveAs","fileSaver","shareEnabled","shareHandler","moveChatHandler","archiveChatHandler","chat","showFullMessages","getChatAsText","downloadTxt","chatText","downloadPdf","jsPDF","html2canvas","containerElement","isDarkMode","virtualWidth","clonedElement","r","pdf","pageWidthMM","pageHeightMM","pxPerMM","pxPerPDFMM","pagePixelHeight","offsetY","sliceHeight","pageCanvas","imgData","imgHeightMM","left","top","right","bottom","pageWidth","pageHeight","usableWidth","fontSize","lineHeight","paragraphs","y","paragraph","lines","line","downloadJSONExport","chatObj","getChatById","showOverview","showArtifacts","showEmbeds","copyToClipboard","folder","usermenu_changes","if_block4","if_block5","if_block6","if_block8","_l","_k","_n","_m","_o","_q","_p","nav","initNewChat","showModelSelector","onSaveTempChat","closedBannerIds","showShareChatModal","showSidebar","$showSidebar","temporaryChatEnabled","goto","$showControls","showArchivedChats","bannerId","banner","$banners","add_render_callback","select0","select1","option0","option1","option","func_1","option_value_value","selectedId","loading","valvesSpec","valves","debounceTimer","debounceSubmitHandler","getUserValves","getToolUserValvesById","getToolUserValvesSpecById","getFunctionUserValvesById","getFunctionUserValvesSpecById","property","v","updateToolUserValvesById","updateFunctionUserValvesById","$functions","functions","getFunctions","select_value","if_block2","textarea","textarea_class_value","set_input_value","models","chatFiles","showValves","devices","device","style","circle0","circle1","circle2","eventTarget","submitPrompt","wakeLock","confirmed","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","rmsLevel","hasStartedSpeaking","mediaRecorder","audioStream","audioChunks","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","takeScreenshot","context","dataURL","stopCamera","MIN_DECIBELS","transcribeHandler","audioBlob","blobToFile","transcribeAudio","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","startRecording","analyseAudio","stopAudioStream","calculateRMS","sumSquares","normalizedValue","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","lastSoundTime","processFrame","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","speakSpeechSynthesisHandler","voices","getVoicesLoop","voice","playAudio","audio","audioElement","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","messages","monitorAndPlayAudio","signal","chatStartHandler","chatEventHandler","chatFinishHandler","setWakeLock","svg0","svg1","button2","button3","iframe","overlay","contents","selectedContentIdx","copied","iframeElement","getContents","codeBlockContents","codeBlocks","htmlContent","cssContent","jsContent","lang","code","inlineHtml","inlineCss","inlineJs","renderedContent","navigateContent","direction","iframeLoadHandler","showFullScreen","downloadArtifact","artifactCode","codeIdx","click_handler","click_handler_1","a_href_value","fullheightiframe_changes","embed","div0_class_value","is_function","div_class_value","showMessage","generateUserTurn","pane","mediaQuery","largeScreen","minSize","openPane","container","size","handleMediaQuery","onMouseDown","onMouseUp","entries","entry","percentage","closeHandler","node","localizedFormat","chats","chatList","getTimeRange","orderBy","setSortKey","click_handler_2","setChatList","getChatListByFolderId","foldermodal_changes","onUpdate","folderId","onDelete","showFolderModal","showDeleteConfirm","updateHandler","meta","currentName","updateFolderById","_folder","getFolderById","selectedFolder","updateIconHandler","iconName","deleteHandler","deleteFolderById","exportHandler","getChatsByFolderId","div0_intro","fade","div4_intro","func_2","sanitizeResponseContent","suggestions_changes","div1_intro","messageInput","toolServers","$currentChatPage","currentChatPage","modelIdx","$_models","set_style","navbar_changes","chatcontrols_changes","document_1","title_value","MAX_DRAFT_LENGTH","chatIdProp","controlPane","controlPaneComponent","messagesContainerElement","navbarElement","showEventConfirmation","eventConfirmationTitle","eventConfirmationMessage","eventConfirmationInput","eventConfirmationInputPlaceholder","eventConfirmationInputValue","eventCallback","chatIdUnsubscriber","generationController","navigateHandler","storageChatInput","loadChat","saveSessionSelectedModels","selectedModelsString","oldSelectedModelIds","onSelectedModelIdsChange","resetInput","setDefaults","ignoreSettings","_chatId","_messageId","messageChildrenIds","messageElement","saveChatHandler","chatCompletionEventHandler","responseMessage","messageId","chatTitle","allTags","existingCodeExecutionIndex","execution","toastType","toastContent","onMessageHandler","inputElement","savedModelIds","$selectedFolder","pageSubscribe","showControlsSubscribe","selectedFolderSubscribe","$socket","p","uploadGoogleDriveFile","fetchOptions","fileResponse","contentType","fileBlob","uploadWeb","processWeb","uploadYoutubeTranscription","processYoutubeVideo","availableModels","$page","urlModels","modelSelectorButton","modelSelectorInput","q","userSettings","getUserSettings","chatContent","convertMessagesToHistory","taskRes","getTaskIdsByChatId","behavior","chatCompletedHandler","responseMessageId","chatCompleted","chatActionHandler","actionId","chatAction","getChatEventEmitter","userPrompt","parentMessage","userMessageId","userMessage","initChatHandler","addMessages","parentId","currentParentId","choices","sources","selected_model_id","usage","handleOpenAIError","messageContentParts","getMessageContentParts","removeAllDetails","lastMessageContentPart","_raw","lastMessage","_files","array","sendMessage","promptText","msg","generateOpenAICompletion","generatedText","_history","newChat","responseMessageIds","_modelIdx","chatEventEmitter","sendMessageSocket","getFeatures","features","currentModels","_messages","chatMessageFiles","messageFile","userLocation","getAndUpdateUserLocation","processDetails","toolIds","toolServerIds","generateOpenAIChatCompletion","str","getPromptVariables","errorMessage","innerError","status","taskId","stopTask","submitMessage","regenerateResponse","suggestionPrompt","continueResponse","mergeResponses","responses","mergedResponse","generateMoACompletion","textStream","createNewChat","saveDraftTimeout","saveDraft","draft","clearDraft","updateChatFolderIdById","pinnedChats","getPinnedChatList","title","savedChat","func_5"],"ignoreList":[0,2,3],"sources":["../../../../../../node_modules/svelte/src/runtime/internal/await_block.js","../../../../../../src/lib/components/chat/Tags.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/icons/Cube.svelte","../../../../../../src/lib/utils/google-drive-picker.ts","../../../../../../src/lib/utils/onedrive-file-picker.ts","../../../../../../src/lib/components/icons/ClockRotateRight.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Chats.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Notes.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Knowledge.svelte","../../../../../../src/lib/components/chat/MessageInput/AttachWebpageModal.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/chat/ToolServersModal.svelte","../../../../../../src/lib/components/icons/Photo.svelte","../../../../../../src/lib/components/icons/Wrench.svelte","../../../../../../src/lib/components/icons/Voice.svelte","../../../../../../src/lib/components/icons/Terminal.svelte","../../../../../../src/lib/components/icons/Knobs.svelte","../../../../../../src/lib/components/chat/MessageInput/IntegrationsMenu.svelte","../../../../../../src/lib/components/icons/Component.svelte","../../../../../../src/lib/components/icons/PlusAlt.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/icons/AdjustmentsHorizontal.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/icons/ChatBubbleDotted.svelte","../../../../../../src/lib/components/icons/ChatBubbleDottedChecked.svelte","../../../../../../src/lib/components/icons/ChatPlus.svelte","../../../../../../src/lib/components/icons/ChatCheck.svelte","../../../../../../src/lib/components/chat/Navbar.svelte","../../../../../../src/lib/components/chat/Controls/Valves.svelte","../../../../../../src/lib/components/chat/Controls/Controls.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/icons/ArrowsPointingOut.svelte","../../../../../../src/lib/components/chat/Artifacts.svelte","../../../../../../src/lib/components/chat/ChatControls/Embeds.svelte","../../../../../../src/lib/components/chat/ChatControls.svelte","../../../../../../src/lib/components/chat/Placeholder/ChatList.svelte","../../../../../../src/lib/components/chat/Placeholder/FolderPlaceholder.svelte","../../../../../../src/lib/components/chat/Placeholder/FolderTitle.svelte","../../../../../../src/lib/components/chat/Placeholder.svelte","../../../../../../src/lib/components/chat/Chat.svelte"],"sourcesContent":["import { is_promise } from './utils.js';\nimport { check_outros, group_outros, transition_in, transition_out } from './transitions.js';\nimport { flush } from './scheduler.js';\nimport { get_current_component, set_current_component } from './lifecycle.js';\n\n/**\n * @template T\n * @param {Promise<T>} promise\n * @param {import('./private.js').PromiseInfo<T>} info\n * @returns {boolean}\n */\nexport function handle_promise(promise, info) {\n\tconst token = (info.token = {});\n\t/**\n\t * @param {import('./private.js').FragmentFactory} type\n\t * @param {0 | 1 | 2} index\n\t * @param {number} [key]\n\t * @param {any} [value]\n\t * @returns {void}\n\t */\n\tfunction update(type, index, key, value) {\n\t\tif (info.token !== token) return;\n\t\tinfo.resolved = value;\n\t\tlet child_ctx = info.ctx;\n\t\tif (key !== undefined) {\n\t\t\tchild_ctx = child_ctx.slice();\n\t\t\tchild_ctx[key] = value;\n\t\t}\n\t\tconst block = type && (info.current = type)(child_ctx);\n\t\tlet needs_flush = false;\n\t\tif (info.block) {\n\t\t\tif (info.blocks) {\n\t\t\t\tinfo.blocks.forEach((block, i) => {\n\t\t\t\t\tif (i !== index && block) {\n\t\t\t\t\t\tgroup_outros();\n\t\t\t\t\t\ttransition_out(block, 1, 1, () => {\n\t\t\t\t\t\t\tif (info.blocks[i] === block) {\n\t\t\t\t\t\t\t\tinfo.blocks[i] = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcheck_outros();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tinfo.block.d(1);\n\t\t\t}\n\t\t\tblock.c();\n\t\t\ttransition_in(block, 1);\n\t\t\tblock.m(info.mount(), info.anchor);\n\t\t\tneeds_flush = true;\n\t\t}\n\t\tinfo.block = block;\n\t\tif (info.blocks) info.blocks[index] = block;\n\t\tif (needs_flush) {\n\t\t\tflush();\n\t\t}\n\t}\n\tif (is_promise(promise)) {\n\t\tconst current_component = get_current_component();\n\t\tpromise.then(\n\t\t\t(value) => {\n\t\t\t\tset_current_component(current_component);\n\t\t\t\tupdate(info.then, 1, info.value, value);\n\t\t\t\tset_current_component(null);\n\t\t\t},\n\t\t\t(error) => {\n\t\t\t\tset_current_component(current_component);\n\t\t\t\tupdate(info.catch, 2, info.error, error);\n\t\t\t\tset_current_component(null);\n\t\t\t\tif (!info.hasCatch) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\t// if we previously had a then/catch block, destroy it\n\t\tif (info.current !== info.pending) {\n\t\t\tupdate(info.pending, 0);\n\t\t\treturn true;\n\t\t}\n\t} else {\n\t\tif (info.current !== info.then) {\n\t\t\tupdate(info.then, 1, info.value, promise);\n\t\t\treturn true;\n\t\t}\n\t\tinfo.resolved = /** @type {T} */ (promise);\n\t}\n}\n\n/** @returns {void} */\nexport function update_await_block_branch(info, ctx, dirty) {\n\tconst child_ctx = ctx.slice();\n\tconst { resolved } = info;\n\tif (info.current === info.then) {\n\t\tchild_ctx[info.value] = resolved;\n\t}\n\tif (info.current === info.catch) {\n\t\tchild_ctx[info.error] = resolved;\n\t}\n\tinfo.block.p(child_ctx, dirty);\n}\n","<script>\n\timport {\n\t\taddTagById,\n\t\tdeleteTagById,\n\t\tgetAllTags,\n\t\tgetChatList,\n\t\tgetChatListByTagName,\n\t\tgetTagsById,\n\t\tupdateChatById\n\t} from '$lib/apis/chats';\n\timport {\n\t\ttags as _tags,\n\t\tchats,\n\t\tpinnedChats,\n\t\tcurrentChatPage,\n\t\tscrollPaginationEnabled\n\t} from '$lib/stores';\n\timport { createEventDispatcher, onMount } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport Tags from '../common/Tags.svelte';\n\timport { toast } from 'svelte-sonner';\n\n\texport let chatId = '';\n\tlet tags = [];\n\n\tconst getTags = async () => {\n\t\treturn await getTagsById(localStorage.token, chatId).catch(async (error) => {\n\t\t\treturn [];\n\t\t});\n\t};\n\n\tconst addTag = async (tagName) => {\n\t\tconst res = await addTagById(localStorage.token, chatId, tagName).catch(async (error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\t\tif (!res) {\n\t\t\treturn;\n\t\t}\n\n\t\ttags = await getTags();\n\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\ttags: tags\n\t\t});\n\n\t\tawait _tags.set(await getAllTags(localStorage.token));\n\t\tdispatch('add', {\n\t\t\tname: tagName\n\t\t});\n\t};\n\n\tconst deleteTag = async (tagName) => {\n\t\tconst res = await deleteTagById(localStorage.token, chatId, tagName);\n\t\ttags = await getTags();\n\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\ttags: tags\n\t\t});\n\n\t\tawait _tags.set(await getAllTags(localStorage.token));\n\t\tdispatch('delete', {\n\t\t\tname: tagName\n\t\t});\n\t};\n\n\tonMount(async () => {\n\t\tif (chatId) {\n\t\t\ttags = await getTags();\n\t\t}\n\t});\n</script>\n\n<Tags\n\t{tags}\n\ton:delete={(e) => {\n\t\tdeleteTag(e.detail);\n\t}}\n\ton:add={(e) => {\n\t\taddTag(e.detail);\n\t}}\n/>\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\nimport type { ParsedEvent } from 'eventsource-parser';\n\ntype TextStreamUpdate = {\n\tdone: boolean;\n\tvalue: string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tsources?: any;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tselectedModelId?: any;\n\terror?: any;\n\tusage?: ResponseUsage;\n};\n\ntype ResponseUsage = {\n\t/** Including images and tools if any */\n\tprompt_tokens: number;\n\t/** The tokens generated */\n\tcompletion_tokens: number;\n\t/** Sum of the above two fields */\n\ttotal_tokens: number;\n\t/** Any other fields that aren't part of the base OpenAI spec */\n\t[other: string]: unknown;\n};\n\n// createOpenAITextStream takes a responseBody with a SSE response,\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\nexport async function createOpenAITextStream(\n\tresponseBody: ReadableStream<Uint8Array>,\n\tsplitLargeDeltas: boolean\n): Promise<AsyncGenerator<TextStreamUpdate>> {\n\tconst eventStream = responseBody\n\t\t.pipeThrough(new TextDecoderStream())\n\t\t.pipeThrough(new EventSourceParserStream())\n\t\t.getReader();\n\tlet iterator = openAIStreamToIterator(eventStream);\n\tif (splitLargeDeltas) {\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\n\t}\n\treturn iterator;\n}\n\nasync function* openAIStreamToIterator(\n\treader: ReadableStreamDefaultReader<ParsedEvent>\n): AsyncGenerator<TextStreamUpdate> {\n\twhile (true) {\n\t\tconst { value, done } = await reader.read();\n\t\tif (done) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\t\tif (!value) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = value.data;\n\t\tif (data.startsWith('[DONE]')) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsedData = JSON.parse(data);\n\t\t\tconsole.log(parsedData);\n\n\t\t\tif (parsedData.error) {\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parsedData.sources) {\n\t\t\t\tyield { done: false, value: '', sources: parsedData.sources };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parsedData.selected_model_id) {\n\t\t\t\tyield { done: false, value: '', selectedModelId: parsedData.selected_model_id };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parsedData.usage) {\n\t\t\t\tyield { done: false, value: '', usage: parsedData.usage };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tyield {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? ''\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\n\t\t}\n\t}\n}\n\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\nasync function* streamLargeDeltasAsRandomChunks(\n\titerator: AsyncGenerator<TextStreamUpdate>\n): AsyncGenerator<TextStreamUpdate> {\n\tfor await (const textStreamUpdate of iterator) {\n\t\tif (textStreamUpdate.done) {\n\t\t\tyield textStreamUpdate;\n\t\t\treturn;\n\t\t}\n\n\t\tif (textStreamUpdate.error) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.sources) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.selectedModelId) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.usage) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet content = textStreamUpdate.value;\n\t\tif (content.length < 5) {\n\t\t\tyield { done: false, value: content };\n\t\t\tcontinue;\n\t\t}\n\t\twhile (content != '') {\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\n\t\t\tconst chunk = content.slice(0, chunkSize);\n\t\t\tyield { done: false, value: chunk };\n\t\t\t// Do not sleep if the tab is hidden\n\t\t\t// Timers are throttled to 1s in hidden tabs\n\t\t\tif (document?.visibilityState !== 'hidden') {\n\t\t\t\tawait sleep(5);\n\t\t\t}\n\t\t\tcontent = content.slice(chunkSize);\n\t\t}\n\t}\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9\"\n\t/>\n</svg>\n","// Google Drive Picker API configuration\nlet API_KEY = '';\nlet CLIENT_ID = '';\n\n// Function to fetch credentials from backend config\nasync function getCredentials() {\n\tconst response = await fetch('/api/config');\n\tif (!response.ok) {\n\t\tthrow new Error('Failed to fetch Google Drive credentials');\n\t}\n\tconst config = await response.json();\n\tAPI_KEY = config.google_drive?.api_key;\n\tCLIENT_ID = config.google_drive?.client_id;\n\n\tif (!API_KEY || !CLIENT_ID) {\n\t\tthrow new Error('Google Drive API credentials not configured');\n\t}\n}\nconst SCOPE = [\n\t'https://www.googleapis.com/auth/drive.readonly',\n\t'https://www.googleapis.com/auth/drive.file'\n];\n\n// Validate required credentials\nconst validateCredentials = () => {\n\tif (!API_KEY || !CLIENT_ID) {\n\t\tthrow new Error('Google Drive API credentials not configured');\n\t}\n\tif (API_KEY === '' || CLIENT_ID === '') {\n\t\tthrow new Error('Please configure valid Google Drive API credentials');\n\t}\n};\n\nlet pickerApiLoaded = false;\nlet oauthToken: string | null = null;\nlet initialized = false;\n\nexport const loadGoogleDriveApi = () => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof gapi === 'undefined') {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.src = 'https://apis.google.com/js/api.js';\n\t\t\tscript.onload = () => {\n\t\t\t\tgapi.load('picker', () => {\n\t\t\t\t\tpickerApiLoaded = true;\n\t\t\t\t\tresolve(true);\n\t\t\t\t});\n\t\t\t};\n\t\t\tscript.onerror = reject;\n\t\t\tdocument.body.appendChild(script);\n\t\t} else {\n\t\t\tgapi.load('picker', () => {\n\t\t\t\tpickerApiLoaded = true;\n\t\t\t\tresolve(true);\n\t\t\t});\n\t\t}\n\t});\n};\n\nexport const loadGoogleAuthApi = () => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof google === 'undefined') {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.src = 'https://accounts.google.com/gsi/client';\n\t\t\tscript.onload = resolve;\n\t\t\tscript.onerror = reject;\n\t\t\tdocument.body.appendChild(script);\n\t\t} else {\n\t\t\tresolve(true);\n\t\t}\n\t});\n};\n\nexport const getAuthToken = async () => {\n\tif (!oauthToken) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst tokenClient = google.accounts.oauth2.initTokenClient({\n\t\t\t\tclient_id: CLIENT_ID,\n\t\t\t\tscope: SCOPE.join(' '),\n\t\t\t\tcallback: (response: any) => {\n\t\t\t\t\tif (response.access_token) {\n\t\t\t\t\t\toauthToken = response.access_token;\n\t\t\t\t\t\tresolve(oauthToken);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Failed to get access token'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror_callback: (error: any) => {\n\t\t\t\t\treject(new Error(error.message || 'OAuth error occurred'));\n\t\t\t\t}\n\t\t\t});\n\t\t\ttokenClient.requestAccessToken();\n\t\t});\n\t}\n\treturn oauthToken;\n};\n\nconst initialize = async () => {\n\tif (!initialized) {\n\t\tawait getCredentials();\n\t\tvalidateCredentials();\n\t\tawait Promise.all([loadGoogleDriveApi(), loadGoogleAuthApi()]);\n\t\tinitialized = true;\n\t}\n};\n\nexport const createPicker = () => {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tconsole.log('Initializing Google Drive Picker...');\n\t\t\tawait initialize();\n\t\t\tconsole.log('Getting auth token...');\n\t\t\tconst token = await getAuthToken();\n\t\t\tif (!token) {\n\t\t\t\tconsole.error('Failed to get OAuth token');\n\t\t\t\tthrow new Error('Unable to get OAuth token');\n\t\t\t}\n\t\t\tconsole.log('Auth token obtained successfully');\n\n\t\t\tconst picker = new google.picker.PickerBuilder()\n\t\t\t\t.enableFeature(google.picker.Feature.NAV_HIDDEN)\n\t\t\t\t.enableFeature(google.picker.Feature.MULTISELECT_ENABLED)\n\t\t\t\t.addView(\n\t\t\t\t\tnew google.picker.DocsView()\n\t\t\t\t\t\t.setIncludeFolders(false)\n\t\t\t\t\t\t.setSelectFolderEnabled(false)\n\t\t\t\t\t\t.setMimeTypes(\n\t\t\t\t\t\t\t'application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation'\n\t\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t.setOAuthToken(token)\n\t\t\t\t.setDeveloperKey(API_KEY)\n\t\t\t\t// Remove app ID setting as it's not needed and can cause 404 errors\n\t\t\t\t.setCallback(async (data: any) => {\n\t\t\t\t\tif (data[google.picker.Response.ACTION] === google.picker.Action.PICKED) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst doc = data[google.picker.Response.DOCUMENTS][0];\n\t\t\t\t\t\t\tconst fileId = doc[google.picker.Document.ID];\n\t\t\t\t\t\t\tconst fileName = doc[google.picker.Document.NAME];\n\t\t\t\t\t\t\tconst fileUrl = doc[google.picker.Document.URL];\n\n\t\t\t\t\t\t\tif (!fileId || !fileName) {\n\t\t\t\t\t\t\t\tthrow new Error('Required file details missing');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Construct download URL based on MIME type\n\t\t\t\t\t\t\tconst mimeType = doc[google.picker.Document.MIME_TYPE];\n\n\t\t\t\t\t\t\tlet downloadUrl;\n\t\t\t\t\t\t\tlet exportFormat;\n\n\t\t\t\t\t\t\tif (mimeType.includes('google-apps')) {\n\t\t\t\t\t\t\t\t// Handle Google Workspace files\n\t\t\t\t\t\t\t\tif (mimeType.includes('document')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/plain';\n\t\t\t\t\t\t\t\t} else if (mimeType.includes('spreadsheet')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/csv';\n\t\t\t\t\t\t\t\t} else if (mimeType.includes('presentation')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/plain';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\texportFormat = 'application/pdf';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdownloadUrl = `https://www.googleapis.com/drive/v3/files/${fileId}/export?mimeType=${encodeURIComponent(exportFormat)}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Regular files use direct download URL\n\t\t\t\t\t\t\t\tdownloadUrl = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Create a Blob from the file download\n\t\t\t\t\t\t\tconst response = await fetch(downloadUrl, {\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t\t\t\t\t\tAccept: '*/*'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\t\tconst errorText = await response.text();\n\t\t\t\t\t\t\t\tconsole.error('Download failed:', {\n\t\t\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t\t\t\terror: errorText\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthrow new Error(`Failed to download file (${response.status}): ${errorText}`);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst blob = await response.blob();\n\t\t\t\t\t\t\tconst result = {\n\t\t\t\t\t\t\t\tid: fileId,\n\t\t\t\t\t\t\t\tname: fileName,\n\t\t\t\t\t\t\t\turl: downloadUrl,\n\t\t\t\t\t\t\t\tblob: blob,\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t\t\t\t\t\tAccept: '*/*'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (data[google.picker.Response.ACTION] === google.picker.Action.CANCEL) {\n\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.build();\n\t\t\tpicker.setVisible(true);\n\t\t} catch (error) {\n\t\t\tconsole.error('Google Drive Picker error:', error);\n\t\t\treject(error);\n\t\t}\n\t});\n};\n","import type { PopupRequest, PublicClientApplication } from '@azure/msal-browser';\nimport { v4 as uuidv4 } from 'uuid';\n\nclass OneDriveConfig {\n\tprivate static instance: OneDriveConfig;\n\tprivate clientIdPersonal: string = '';\n\tprivate clientIdBusiness: string = '';\n\tprivate sharepointUrl: string = '';\n\tprivate sharepointTenantId: string = '';\n\tprivate msalInstance: PublicClientApplication | null = null;\n\tprivate currentAuthorityType: 'personal' | 'organizations' = 'personal';\n\n\tprivate constructor() {}\n\n\tpublic static getInstance(): OneDriveConfig {\n\t\tif (!OneDriveConfig.instance) {\n\t\t\tOneDriveConfig.instance = new OneDriveConfig();\n\t\t}\n\t\treturn OneDriveConfig.instance;\n\t}\n\n\tpublic async initialize(authorityType?: 'personal' | 'organizations'): Promise<void> {\n\t\tif (authorityType && this.currentAuthorityType !== authorityType) {\n\t\t\tthis.currentAuthorityType = authorityType;\n\t\t\tthis.msalInstance = null;\n\t\t}\n\t\tawait this.getCredentials();\n\t}\n\n\tpublic async ensureInitialized(authorityType?: 'personal' | 'organizations'): Promise<void> {\n\t\tawait this.initialize(authorityType);\n\t}\n\n\tprivate async getCredentials(): Promise<void> {\n\t\tconst response = await fetch('/api/config', {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tcredentials: 'include'\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error('Failed to fetch OneDrive credentials');\n\t\t}\n\n\t\tconst config = await response.json();\n\n\t\tthis.clientIdPersonal = config.onedrive?.client_id_personal;\n\t\tthis.clientIdBusiness = config.onedrive?.client_id_business;\n\t\tthis.sharepointUrl = config.onedrive?.sharepoint_url;\n\t\tthis.sharepointTenantId = config.onedrive?.sharepoint_tenant_id;\n\n\t\tif (!this.clientIdPersonal && !this.clientIdBusiness) {\n\t\t\tthrow new Error('OneDrive personal or business client ID not configured');\n\t\t}\n\t}\n\n\tpublic async getMsalInstance(\n\t\tauthorityType?: 'personal' | 'organizations'\n\t): Promise<PublicClientApplication> {\n\t\tawait this.ensureInitialized(authorityType);\n\n\t\tif (!this.msalInstance) {\n\t\t\tconst authorityEndpoint =\n\t\t\t\tthis.currentAuthorityType === 'organizations'\n\t\t\t\t\t? this.sharepointTenantId || 'common'\n\t\t\t\t\t: 'consumers';\n\n\t\t\tconst clientId =\n\t\t\t\tthis.currentAuthorityType === 'organizations'\n\t\t\t\t\t? this.clientIdBusiness\n\t\t\t\t\t: this.clientIdPersonal;\n\n\t\t\tif (!clientId) {\n\t\t\t\tthrow new Error('OneDrive client ID not configured');\n\t\t\t}\n\n\t\t\tconst msalParams = {\n\t\t\t\tauth: {\n\t\t\t\t\tauthority: `https://login.microsoftonline.com/${authorityEndpoint}`,\n\t\t\t\t\tclientId: clientId\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst { PublicClientApplication } = await import('@azure/msal-browser');\n\t\t\tthis.msalInstance = new PublicClientApplication(msalParams);\n\t\t\tif (this.msalInstance.initialize) {\n\t\t\t\tawait this.msalInstance.initialize();\n\t\t\t}\n\t\t}\n\n\t\treturn this.msalInstance;\n\t}\n\n\tpublic getAuthorityType(): 'personal' | 'organizations' {\n\t\treturn this.currentAuthorityType;\n\t}\n\n\tpublic getSharepointUrl(): string {\n\t\treturn this.sharepointUrl;\n\t}\n\n\tpublic getSharepointTenantId(): string {\n\t\treturn this.sharepointTenantId;\n\t}\n\n\tpublic getBaseUrl(): string {\n\t\tif (this.currentAuthorityType === 'organizations') {\n\t\t\tif (!this.sharepointUrl || this.sharepointUrl === '') {\n\t\t\t\tthrow new Error('Sharepoint URL not configured');\n\t\t\t}\n\n\t\t\tlet sharePointBaseUrl = this.sharepointUrl.replace(/^https?:\\/\\//, '');\n\t\t\tsharePointBaseUrl = sharePointBaseUrl.replace(/\\/$/, '');\n\n\t\t\treturn `https://${sharePointBaseUrl}`;\n\t\t} else {\n\t\t\treturn 'https://onedrive.live.com/picker';\n\t\t}\n\t}\n}\n\n// Retrieve OneDrive access token\nasync function getToken(\n\tresource?: string,\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<string> {\n\tconst config = OneDriveConfig.getInstance();\n\tawait config.ensureInitialized(authorityType);\n\n\tconst currentAuthorityType = config.getAuthorityType();\n\n\tconst scopes =\n\t\tcurrentAuthorityType === 'organizations'\n\t\t\t? [`${resource || config.getBaseUrl()}/.default`]\n\t\t\t: ['OneDrive.ReadWrite'];\n\n\tconst authParams: PopupRequest = { scopes };\n\tlet accessToken = '';\n\n\ttry {\n\t\tconst msalInstance = await config.getMsalInstance(authorityType);\n\t\tconst resp = await msalInstance.acquireTokenSilent(authParams);\n\t\taccessToken = resp.accessToken;\n\t} catch {\n\t\tconst msalInstance = await config.getMsalInstance(authorityType);\n\t\ttry {\n\t\t\tconst resp = await msalInstance.loginPopup(authParams);\n\t\t\tmsalInstance.setActiveAccount(resp.account);\n\t\t\tif (resp.idToken) {\n\t\t\t\tconst resp2 = await msalInstance.acquireTokenSilent(authParams);\n\t\t\t\taccessToken = resp2.accessToken;\n\t\t\t}\n\t\t} catch (popupError) {\n\t\t\tthrow new Error(\n\t\t\t\t'Failed to login: ' +\n\t\t\t\t\t(popupError instanceof Error ? popupError.message : String(popupError))\n\t\t\t);\n\t\t}\n\t}\n\n\tif (!accessToken) {\n\t\tthrow new Error('Failed to acquire access token');\n\t}\n\n\treturn accessToken;\n}\n\ninterface PickerParams {\n\tsdk: string;\n\tentry: {\n\t\toneDrive: Record<string, unknown>;\n\t};\n\tauthentication: Record<string, unknown>;\n\tmessaging: {\n\t\torigin: string;\n\t\tchannelId: string;\n\t};\n\tsearch: {\n\t\tenabled: boolean;\n\t};\n\ttypesAndSources: {\n\t\tmode: string;\n\t\tpivots: Record<string, boolean>;\n\t};\n}\n\ninterface PickerResult {\n\tcommand?: string;\n\titems?: OneDriveFileInfo[];\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t[key: string]: any;\n}\n\n// Get picker parameters based on account type\nfunction getPickerParams(): PickerParams {\n\tconst channelId = uuidv4();\n\tconst config = OneDriveConfig.getInstance();\n\n\tconst params: PickerParams = {\n\t\tsdk: '8.0',\n\t\tentry: {\n\t\t\toneDrive: {}\n\t\t},\n\t\tauthentication: {},\n\t\tmessaging: {\n\t\t\torigin: window?.location?.origin || '',\n\t\t\tchannelId\n\t\t},\n\t\tsearch: {\n\t\t\tenabled: true\n\t\t},\n\t\ttypesAndSources: {\n\t\t\tmode: 'files',\n\t\t\tpivots: {\n\t\t\t\toneDrive: true,\n\t\t\t\trecent: true,\n\t\t\t\tmyOrganization: config.getAuthorityType() === 'organizations'\n\t\t\t}\n\t\t}\n\t};\n\n\t// For personal accounts, set files object in oneDrive\n\tif (config.getAuthorityType() !== 'organizations') {\n\t\tparams.entry.oneDrive = { files: {} };\n\t}\n\n\treturn params;\n}\n\ninterface OneDriveFileInfo {\n\tid: string;\n\tname: string;\n\tparentReference: {\n\t\tdriveId: string;\n\t};\n\t'@sharePoint.endpoint': string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t[key: string]: any;\n}\n\n// Download file from OneDrive\nasync function downloadOneDriveFile(\n\tfileInfo: OneDriveFileInfo,\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<Blob> {\n\tconst accessToken = await getToken(undefined, authorityType);\n\tif (!accessToken) {\n\t\tthrow new Error('Unable to retrieve OneDrive access token.');\n\t}\n\n\t// The endpoint URL is provided in the file info\n\tconst fileInfoUrl = `${fileInfo['@sharePoint.endpoint']}/drives/${fileInfo.parentReference.driveId}/items/${fileInfo.id}`;\n\n\tconst response = await fetch(fileInfoUrl, {\n\t\theaders: {\n\t\t\tAuthorization: `Bearer ${accessToken}`\n\t\t}\n\t});\n\n\tif (!response.ok) {\n\t\tthrow new Error(`Failed to fetch file information: ${response.status} ${response.statusText}`);\n\t}\n\n\tconst fileData = await response.json();\n\tconst downloadUrl = fileData['@content.downloadUrl'];\n\n\tif (!downloadUrl) {\n\t\tthrow new Error('Download URL not found in file data');\n\t}\n\n\tconst downloadResponse = await fetch(downloadUrl);\n\n\tif (!downloadResponse.ok) {\n\t\tthrow new Error(\n\t\t\t`Failed to download file: ${downloadResponse.status} ${downloadResponse.statusText}`\n\t\t);\n\t}\n\n\treturn await downloadResponse.blob();\n}\n\n// Open OneDrive file picker and return selected file metadata\nexport async function openOneDrivePicker(\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<PickerResult | null> {\n\tif (typeof window === 'undefined') {\n\t\tthrow new Error('Not in browser environment');\n\t}\n\n\t// Initialize OneDrive config with the specified authority type\n\tconst config = OneDriveConfig.getInstance();\n\tawait config.initialize(authorityType);\n\n\treturn new Promise((resolve, reject) => {\n\t\tlet pickerWindow: Window | null = null;\n\t\tlet channelPort: MessagePort | null = null;\n\t\tconst params = getPickerParams();\n\t\tconst baseUrl = config.getBaseUrl();\n\n\t\tconst handleWindowMessage = (event: MessageEvent) => {\n\t\t\tif (event.source !== pickerWindow) return;\n\t\t\tconst message = event.data;\n\t\t\tif (message?.type === 'initialize' && message?.channelId === params.messaging.channelId) {\n\t\t\t\tchannelPort = event.ports?.[0];\n\t\t\t\tif (!channelPort) return;\n\t\t\t\tchannelPort.addEventListener('message', handlePortMessage);\n\t\t\t\tchannelPort.start();\n\t\t\t\tchannelPort.postMessage({ type: 'activate' });\n\t\t\t}\n\t\t};\n\n\t\tconst handlePortMessage = async (portEvent: MessageEvent) => {\n\t\t\tconst portData = portEvent.data;\n\t\t\tswitch (portData.type) {\n\t\t\t\tcase 'notification':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'command': {\n\t\t\t\t\tchannelPort?.postMessage({ type: 'acknowledge', id: portData.id });\n\t\t\t\t\tconst command = portData.data;\n\t\t\t\t\tswitch (command.command) {\n\t\t\t\t\t\tcase 'authenticate': {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t// Pass the resource from the command for org accounts\n\t\t\t\t\t\t\t\tconst resource =\n\t\t\t\t\t\t\t\t\tconfig.getAuthorityType() === 'organizations' ? command.resource : undefined;\n\t\t\t\t\t\t\t\tconst newToken = await getToken(resource, authorityType);\n\t\t\t\t\t\t\t\tif (newToken) {\n\t\t\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\t\t\tdata: { result: 'token', token: newToken }\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthrow new Error('Could not retrieve auth token');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\tresult: 'error',\n\t\t\t\t\t\t\t\t\t\terror: { code: 'tokenError', message: 'Failed to get token' }\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'close': {\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'pick': {\n\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\tdata: { result: 'success' }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tresolve(command);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\tresult: 'error',\n\t\t\t\t\t\t\t\terror: { code: 'unsupportedCommand', message: command.command },\n\t\t\t\t\t\t\t\tisExpected: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfunction cleanup() {\n\t\t\twindow.removeEventListener('message', handleWindowMessage);\n\t\t\tif (channelPort) {\n\t\t\t\tchannelPort.removeEventListener('message', handlePortMessage);\n\t\t\t}\n\t\t\tif (pickerWindow) {\n\t\t\t\tpickerWindow.close();\n\t\t\t\tpickerWindow = null;\n\t\t\t}\n\t\t}\n\n\t\tconst initializePicker = async () => {\n\t\t\ttry {\n\t\t\t\tconst authToken = await getToken(undefined, authorityType);\n\t\t\t\tif (!authToken) {\n\t\t\t\t\treturn reject(new Error('Failed to acquire access token'));\n\t\t\t\t}\n\n\t\t\t\tpickerWindow = window.open('', 'OneDrivePicker', 'width=800,height=600');\n\t\t\t\tif (!pickerWindow) {\n\t\t\t\t\treturn reject(new Error('Failed to open OneDrive picker window'));\n\t\t\t\t}\n\n\t\t\t\tconst queryString = new URLSearchParams({\n\t\t\t\t\tfilePicker: JSON.stringify(params)\n\t\t\t\t});\n\n\t\t\t\tlet url = '';\n\t\t\t\tif (config.getAuthorityType() === 'organizations') {\n\t\t\t\t\turl = baseUrl + `/_layouts/15/FilePicker.aspx?${queryString}`;\n\t\t\t\t} else {\n\t\t\t\t\turl = baseUrl + `?${queryString}`;\n\t\t\t\t}\n\n\t\t\t\tconst form = pickerWindow.document.createElement('form');\n\t\t\t\tform.setAttribute('action', url);\n\t\t\t\tform.setAttribute('method', 'POST');\n\t\t\t\tconst input = pickerWindow.document.createElement('input');\n\t\t\t\tinput.setAttribute('type', 'hidden');\n\t\t\t\tinput.setAttribute('name', 'access_token');\n\t\t\t\tinput.setAttribute('value', authToken);\n\t\t\t\tform.appendChild(input);\n\n\t\t\t\tpickerWindow.document.body.appendChild(form);\n\t\t\t\tform.submit();\n\n\t\t\t\twindow.addEventListener('message', handleWindowMessage);\n\t\t\t} catch (err) {\n\t\t\t\tif (pickerWindow) {\n\t\t\t\t\tpickerWindow.close();\n\t\t\t\t}\n\t\t\t\treject(err);\n\t\t\t}\n\t\t};\n\n\t\tinitializePicker();\n\t});\n}\n\n// Pick and download file from OneDrive\nexport async function pickAndDownloadFile(\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<{ blob: Blob; name: string } | null> {\n\tconst pickerResult = await openOneDrivePicker(authorityType);\n\n\tif (!pickerResult || !pickerResult.items || pickerResult.items.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst selectedFile = pickerResult.items[0];\n\tconst blob = await downloadOneDriveFile(selectedFile, authorityType);\n\n\treturn { blob, name: selectedFile.name };\n}\n\nexport { downloadOneDriveFile };\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\tclass={className}\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\t><path d=\"M12 6L12 12L18 12\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M21.8883 10.5C21.1645 5.68874 17.013 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C16.1006 22 19.6248 19.5318 21.1679 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M17 16H21.4C21.7314 16 22 16.2686 22 16.6V21\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { getChatList } from '$lib/apis/chats';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport { chatId } from '$lib/stores';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tlet page = 1;\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tlet res = await getChatList(localStorage.token, page, true, true).catch(() => {\n\t\t\treturn [];\n\t\t});\n\n\t\tif ((res ?? []).length === 0) {\n\t\t\tallItemsLoaded = true;\n\t\t} else {\n\t\t\tallItemsLoaded = false;\n\t\t}\n\n\t\titems = [\n\t\t\t...items,\n\t\t\t...res\n\t\t\t\t.filter((item) => item?.id !== $chatId)\n\t\t\t\t.map((item) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\ttype: 'chat',\n\t\t\t\t\t\tname: item.title,\n\t\t\t\t\t\tdescription: dayjs(item.updated_at * 1000).fromNow()\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t];\n\n\t\titemsLoading = false;\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait getItemsPage();\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t{#if items.length === 0}\n\t\t<div class=\"text-center text-xs text-gray-500 py-3\">{$i18n.t('No chats found')}</div>\n\t{:else}\n\t\t<div class=\"flex flex-col gap-0.5\">\n\t\t\t{#each items as item, idx}\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSelect(item);\n\t\t\t\t\t}}\n\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t}}\n\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-black dark:text-gray-100 flex items-center gap-1.5\">\n\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { getNoteList } from '$lib/apis/notes';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport PageEdit from '$lib/components/icons/PageEdit.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tlet page = 1;\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tlet res = await getNoteList(localStorage.token, page).catch(() => {\n\t\t\treturn [];\n\t\t});\n\n\t\tif ((res ?? []).length === 0) {\n\t\t\tallItemsLoaded = true;\n\t\t} else {\n\t\t\tallItemsLoaded = false;\n\t\t}\n\n\t\titems = [\n\t\t\t...items,\n\t\t\t...res.map((note) => {\n\t\t\t\treturn {\n\t\t\t\t\t...note,\n\t\t\t\t\ttype: 'note',\n\t\t\t\t\tname: note.title,\n\t\t\t\t\tdescription: dayjs(note.updated_at / 1000000).fromNow()\n\t\t\t\t};\n\t\t\t})\n\t\t];\n\n\t\titemsLoading = false;\n\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait getItemsPage();\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t{#if items.length === 0}\n\t\t<div class=\"text-center text-xs text-gray-500 py-3\">{$i18n.t('No notes found')}</div>\n\t{:else}\n\t\t<div class=\"flex flex-col gap-0.5\">\n\t\t\t{#each items as item, idx}\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSelect(item);\n\t\t\t\t\t}}\n\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t}}\n\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-black dark:text-gray-100 flex items-center gap-1.5\">\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Note')} placement=\"top\">\n\t\t\t\t\t\t\t<PageEdit className=\"size-4\" />\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { knowledge } from '$lib/stores';\n\n\timport { getKnowledgeBases } from '$lib/apis/knowledge';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Database from '$lib/components/icons/Database.svelte';\n\timport DocumentPage from '$lib/components/icons/DocumentPage.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tonMount(async () => {\n\t\tif ($knowledge === null) {\n\t\t\tawait knowledge.set(await getKnowledgeBases(localStorage.token));\n\t\t}\n\n\t\tlet legacy_documents = $knowledge\n\t\t\t.filter((item) => item?.meta?.document)\n\t\t\t.map((item) => ({\n\t\t\t\t...item,\n\t\t\t\ttype: 'file'\n\t\t\t}));\n\n\t\tlet legacy_collections =\n\t\t\tlegacy_documents.length > 0\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: 'All Documents',\n\t\t\t\t\t\t\tlegacy: true,\n\t\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\t\tdescription: 'Deprecated (legacy collection), please create a new knowledge base.',\n\t\t\t\t\t\t\ttitle: $i18n.t('All Documents'),\n\t\t\t\t\t\t\tcollection_names: legacy_documents.map((item) => item.id)\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t...legacy_documents\n\t\t\t\t\t\t\t.reduce((a, item) => {\n\t\t\t\t\t\t\t\treturn [...new Set([...a, ...(item?.meta?.tags ?? []).map((tag) => tag.name)])];\n\t\t\t\t\t\t\t}, [])\n\t\t\t\t\t\t\t.map((tag) => ({\n\t\t\t\t\t\t\t\tname: tag,\n\t\t\t\t\t\t\t\tlegacy: true,\n\t\t\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\t\t\tdescription: 'Deprecated (legacy collection), please create a new knowledge base.',\n\t\t\t\t\t\t\t\tcollection_names: legacy_documents\n\t\t\t\t\t\t\t\t\t.filter((item) => (item?.meta?.tags ?? []).map((tag) => tag.name).includes(tag))\n\t\t\t\t\t\t\t\t\t.map((item) => item.id)\n\t\t\t\t\t\t\t}))\n\t\t\t\t\t]\n\t\t\t\t: [];\n\n\t\tlet collections = $knowledge\n\t\t\t.filter((item) => !item?.meta?.document)\n\t\t\t.map((item) => ({\n\t\t\t\t...item,\n\t\t\t\ttype: 'collection'\n\t\t\t}));\n\t\t``;\n\t\tlet collection_files =\n\t\t\t$knowledge.length > 0\n\t\t\t\t? [\n\t\t\t\t\t\t...$knowledge\n\t\t\t\t\t\t\t.reduce((a, item) => {\n\t\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t\t...new Set([\n\t\t\t\t\t\t\t\t\t\t...a,\n\t\t\t\t\t\t\t\t\t\t...(item?.files ?? []).map((file) => ({\n\t\t\t\t\t\t\t\t\t\t\t...file,\n\t\t\t\t\t\t\t\t\t\t\tcollection: { name: item.name, description: item.description } // DO NOT REMOVE, USED IN FILE DESCRIPTION/ATTACHMENT\n\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t}, [])\n\t\t\t\t\t\t\t.map((file) => ({\n\t\t\t\t\t\t\t\t...file,\n\t\t\t\t\t\t\t\tname: file?.meta?.name,\n\t\t\t\t\t\t\t\tdescription: `${file?.collection?.name} - ${file?.collection?.description}`,\n\t\t\t\t\t\t\t\tknowledge: true, // DO NOT REMOVE, USED TO INDICATE KNOWLEDGE BASE FILE\n\t\t\t\t\t\t\t\ttype: 'file'\n\t\t\t\t\t\t\t}))\n\t\t\t\t\t]\n\t\t\t\t: [];\n\n\t\titems = [...collections, ...collection_files, ...legacy_collections, ...legacy_documents].map(\n\t\t\t(item) => {\n\t\t\t\treturn {\n\t\t\t\t\t...item,\n\t\t\t\t\t...(item?.legacy || item?.meta?.legacy || item?.meta?.document ? { legacy: true } : {})\n\t\t\t\t};\n\t\t\t}\n\t\t);\n\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t<div class=\"flex flex-col gap-0.5\">\n\t\t{#each items as item, idx}\n\t\t\t<button\n\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\tselectedIdx\n\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t: ''}\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tconsole.log(item);\n\t\t\t\t\tonSelect(item);\n\t\t\t\t}}\n\t\t\t\ton:mousemove={() => {\n\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t}}\n\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t>\n\t\t\t\t<div class=\"  text-black dark:text-gray-100 flex items-center gap-1\">\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={item?.legacy\n\t\t\t\t\t\t\t? $i18n.t('Legacy')\n\t\t\t\t\t\t\t: item?.type === 'file'\n\t\t\t\t\t\t\t\t? $i18n.t('File')\n\t\t\t\t\t\t\t\t: item?.type === 'collection'\n\t\t\t\t\t\t\t\t\t? $i18n.t('Collection')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if item?.type === 'collection'}\n\t\t\t\t\t\t\t<Database className=\"size-4\" />\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<DocumentPage className=\"size-4\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t{/each}\n\t</div>\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\timport { settings } from '$lib/stores';\n\n\timport Modal from '$lib/components/common/Modal.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport { isValidHttpUrl, isYoutubeUrl } from '$lib/utils';\n\n\texport let show = false;\n\texport let onSubmit: (e) => void;\n\n\tlet url = '';\n\n\tconst submitHandler = () => {\n\t\tif (isValidHttpUrl(url)) {\n\t\t\tonSubmit({\n\t\t\t\ttype: isYoutubeUrl(url) ? 'youtube' : 'web',\n\t\t\t\tdata: url\n\t\t\t});\n\n\t\t\tshow = false;\n\t\t\turl = '';\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Please enter a valid URL.'));\n\t\t}\n\t};\n</script>\n\n<Modal bind:show size=\"sm\">\n\t<div class=\"flex flex-col h-full\">\n\t\t<div class=\"flex justify-between items-center dark:text-gray-100 px-5 pt-4 pb-1.5\">\n\t\t\t<h1 class=\"text-lg font-medium self-center font-primary\">\n\t\t\t\t{$i18n.t('Attach Webpage')}\n\t\t\t</h1>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\taria-label={$i18n.t('Close modal')}\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className=\"size-5\" />\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"px-5 pb-4\">\n\t\t\t<form\n\t\t\t\ton:submit={(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tsubmitHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\"flex justify-between mb-0.5\">\n\t\t\t\t\t<label\n\t\t\t\t\t\tfor=\"webpage-url\"\n\t\t\t\t\t\tclass={`text-xs ${($settings?.highContrastMode ?? false) ? 'text-gray-800 dark:text-gray-100' : 'text-gray-500'}`}\n\t\t\t\t\t\t>{$i18n.t('Webpage URL')}</label\n\t\t\t\t\t>\n\t\t\t\t</div>\n\n\t\t\t\t<input\n\t\t\t\t\tid=\"webpage-url\"\n\t\t\t\t\tclass={`w-full flex-1 text-sm bg-transparent ${($settings?.highContrastMode ?? false) ? 'placeholder:text-gray-700 dark:placeholder:text-gray-100' : 'outline-hidden placeholder:text-gray-300 dark:placeholder:text-gray-700'}`}\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={url}\n\t\t\t\t\tplaceholder={'https://example.com'}\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\trequired\n\t\t\t\t/>\n\n\t\t\t\t<div class=\"flex justify-end gap-2 pt-3 bg-gray-50 dark:bg-gray-900/50\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-800 text-white dark:bg-white dark:text-black dark:hover:bg-gray-200 transition rounded-full\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{$i18n.t('Add')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { fly } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport { config, user, tools as _tools, mobile, knowledge, chats } from '$lib/stores';\n\timport { getKnowledgeBases } from '$lib/apis/knowledge';\n\n\timport { createPicker } from '$lib/utils/google-drive-picker';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentArrowUp from '$lib/components/icons/DocumentArrowUp.svelte';\n\timport Camera from '$lib/components/icons/Camera.svelte';\n\timport Note from '$lib/components/icons/Note.svelte';\n\timport Clip from '$lib/components/icons/Clip.svelte';\n\timport ChatBubbleOval from '$lib/components/icons/ChatBubbleOval.svelte';\n\timport Refresh from '$lib/components/icons/Refresh.svelte';\n\timport Agile from '$lib/components/icons/Agile.svelte';\n\timport ClockRotateRight from '$lib/components/icons/ClockRotateRight.svelte';\n\timport Database from '$lib/components/icons/Database.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\timport PageEdit from '$lib/components/icons/PageEdit.svelte';\n\timport Chats from './InputMenu/Chats.svelte';\n\timport Notes from './InputMenu/Notes.svelte';\n\timport Knowledge from './InputMenu/Knowledge.svelte';\n\timport AttachWebpageModal from './AttachWebpageModal.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let files = [];\n\n\texport let selectedModels: string[] = [];\n\texport let fileUploadCapableModels: string[] = [];\n\n\texport let screenCaptureHandler: Function;\n\texport let uploadFilesHandler: Function;\n\texport let inputFilesHandler: Function;\n\n\texport let uploadGoogleDriveHandler: Function;\n\texport let uploadOneDriveHandler: Function;\n\n\texport let onUpload: Function;\n\texport let onClose: Function;\n\n\tlet show = false;\n\tlet tab = '';\n\n\tlet showAttachWebpageModal = false;\n\n\tlet fileUploadEnabled = true;\n\t$: fileUploadEnabled =\n\t\tfileUploadCapableModels.length === selectedModels.length &&\n\t\t($user?.role === 'admin' || $user?.permissions?.chat?.file_upload);\n\n\tconst detectMobile = () => {\n\t\tconst userAgent = navigator.userAgent || navigator.vendor || window.opera;\n\t\treturn /android|iphone|ipad|ipod|windows phone/i.test(userAgent);\n\t};\n\n\tconst handleFileChange = (event) => {\n\t\tconst inputFiles = Array.from(event.target?.files);\n\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\tconsole.log(inputFiles);\n\t\t\tinputFilesHandler(inputFiles);\n\t\t}\n\t};\n\n\tconst init = async () => {\n\t\tif ($knowledge === null) {\n\t\t\tawait knowledge.set(await getKnowledgeBases(localStorage.token));\n\t\t}\n\t};\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tconst onSelect = (item) => {\n\t\tif (files.find((f) => f.id === item.id)) {\n\t\t\treturn;\n\t\t}\n\t\tfiles = [\n\t\t\t...files,\n\t\t\t{\n\t\t\t\t...item,\n\t\t\t\tstatus: 'processed'\n\t\t\t}\n\t\t];\n\n\t\tshow = false;\n\t};\n</script>\n\n<AttachWebpageModal\n\tbind:show={showAttachWebpageModal}\n\tonSubmit={(e) => {\n\t\tonUpload(e);\n\t}}\n/>\n\n<!-- Hidden file input used to open the camera on mobile -->\n<input\n\tid=\"camera-input\"\n\ttype=\"file\"\n\taccept=\"image/*\"\n\tcapture=\"environment\"\n\ton:change={handleFileChange}\n\tstyle=\"display: none;\"\n/>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('More')}>\n\t\t<slot />\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin transition\"\n\t\t\tsideOffset={4}\n\t\t\talignOffset={-6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if tab === ''}\n\t\t\t\t<div in:fly={{ x: -20, duration: 150 }}>\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tuploadFilesHandler();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Clip />\n\n\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Upload Files')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50  rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tif (!detectMobile()) {\n\t\t\t\t\t\t\t\t\t\tscreenCaptureHandler();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconst cameraInputElement = document.getElementById('camera-input');\n\n\t\t\t\t\t\t\t\t\t\tif (cameraInputElement) {\n\t\t\t\t\t\t\t\t\t\t\tcameraInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Camera />\n\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Capture')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tshowAttachWebpageModal = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<GlobeAlt />\n\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Attach Webpage')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{#if $config?.features?.enable_notes ?? false}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'notes';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<PageEdit />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Attach Notes')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if ($knowledge ?? []).length > 0}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'knowledge';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Database />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Attach Knowledge')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if ($chats ?? []).length > 0}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'chats';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ClockRotateRight />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Reference Chats')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if fileUploadEnabled}\n\t\t\t\t\t\t{#if $config?.features?.enable_google_drive_integration}\n\t\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tuploadGoogleDriveHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 87.3 78\" class=\"w-4\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#0066da\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#00ac47\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#ea4335\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#00832d\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#2684fc\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#ffba00\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Google Drive')}</div>\n\t\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if $config?.features?.enable_onedrive_integration && ($config?.features?.enable_onedrive_personal || $config?.features?.enable_onedrive_business)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'microsoft_onedrive';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 32 32\"\n\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<mask\n\t\t\t\t\t\t\t\t\t\tid=\"mask0_87_7796\"\n\t\t\t\t\t\t\t\t\t\tstyle=\"mask-type:alpha\"\n\t\t\t\t\t\t\t\t\t\tmaskUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\tx=\"0\"\n\t\t\t\t\t\t\t\t\t\ty=\"6\"\n\t\t\t\t\t\t\t\t\t\twidth=\"32\"\n\t\t\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"#C4C4C4\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</mask>\n\t\t\t\t\t\t\t\t\t<g mask=\"url(#mask0_87_7796)\">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint0_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint1_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint2_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint3_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint0_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"4.42591\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"24.6668\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"27.2309\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"23.2764\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#2086B8\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#46D3F6\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint1_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"23.8302\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"19.6668\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"30.2108\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"15.2082\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#1694DB\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#62C3FE\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint2_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"8.51037\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"7.33333\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"23.3335\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"15.9348\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#0D3D78\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#063B83\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint3_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"-0.340429\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"19.9998\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"14.5634\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"14.4649\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#16589B\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#1464B7\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'knowledge'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Knowledge')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Knowledge {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'notes'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Notes')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Notes {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'chats'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Chats')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Chats {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'microsoft_onedrive'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t{#if $config?.features?.enable_onedrive_personal}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tuploadOneDriveHandler('personal');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Microsoft OneDrive (personal)')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $config?.features?.enable_onedrive_business}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tuploadOneDriveHandler('organizations');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive (work/school)')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">{$i18n.t('Includes SharePoint')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport { models, config, toolServers, tools } from '$lib/stores';\n\n\timport { toast } from 'svelte-sonner';\n\timport { deleteSharedChatById, getChatById, shareChatById } from '$lib/apis/chats';\n\timport { copyToClipboard } from '$lib/utils';\n\n\timport Modal from '../common/Modal.svelte';\n\timport Link from '../icons/Link.svelte';\n\timport Collapsible from '../common/Collapsible.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\texport let show = false;\n\texport let selectedToolIds = [];\n\n\tlet selectedTools = [];\n\n\t$: selectedTools = ($tools ?? []).filter((tool) => selectedToolIds.includes(tool.id));\n\n\tconst i18n = getContext('i18n');\n</script>\n\n<Modal bind:show size=\"md\">\n\t<div>\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4 pb-0.5\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Available Tools')}</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className={'size-5'} />\n\t\t\t</button>\n\t\t</div>\n\n\t\t{#if selectedTools.length > 0}\n\t\t\t{#if $toolServers.length > 0}\n\t\t\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pb-1\">\n\t\t\t\t\t<div class=\" text-base font-medium self-center\">{$i18n.t('Tools')}</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"px-5 pb-3 w-full flex flex-col justify-center\">\n\t\t\t\t<div class=\" text-sm dark:text-gray-300 mb-1\">\n\t\t\t\t\t{#each selectedTools as tool}\n\t\t\t\t\t\t<Collapsible buttonClassName=\"w-full mb-0.5\">\n\t\t\t\t\t\t\t<div class=\"truncate\">\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-100 text-gray-800 truncate\">\n\t\t\t\t\t\t\t\t\t{tool?.name}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{#if tool?.meta?.description}\n\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t{tool?.meta?.description}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- <div slot=\"content\">\n\t\t\t\t\t\t\t{JSON.stringify(tool, null, 2)}\n\t\t\t\t\t\t</div> -->\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if $toolServers.length > 0}\n\t\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pb-0.5\">\n\t\t\t\t<div class=\" text-base font-medium self-center\">{$i18n.t('Tool Servers')}</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"px-5 pb-5 w-full flex flex-col justify-center\">\n\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-300 mb-2\">\n\t\t\t\t\t{$i18n.t('Open WebUI can use tools provided by any OpenAPI server.')} <br /><a\n\t\t\t\t\t\tclass=\"underline\"\n\t\t\t\t\t\thref=\"https://github.com/open-webui/openapi-servers\"\n\t\t\t\t\t\ttarget=\"_blank\">{$i18n.t('Learn more about OpenAPI tool servers.')}</a\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class=\" text-sm dark:text-gray-300 mb-1\">\n\t\t\t\t\t{#each $toolServers as toolServer}\n\t\t\t\t\t\t<Collapsible buttonClassName=\"w-full\" chevron>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-100 text-gray-800\">\n\t\t\t\t\t\t\t\t\t{toolServer?.openapi?.info?.title} - v{toolServer?.openapi?.info?.version}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t{toolServer?.openapi?.info?.description}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t{toolServer?.url}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div slot=\"content\">\n\t\t\t\t\t\t\t\t{#each toolServer?.specs ?? [] as tool_spec}\n\t\t\t\t\t\t\t\t\t<div class=\"my-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-800 dark:text-gray-100\">\n\t\t\t\t\t\t\t\t\t\t\t{tool_spec?.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t{tool_spec?.description}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\taria-hidden=\"true\"\n\t><path\n\t\td=\"M21 7.6V20.4C21 20.7314 20.7314 21 20.4 21H7.6C7.26863 21 7 20.7314 7 20.4V7.6C7 7.26863 7.26863 7 7.6 7H20.4C20.7314 7 21 7.26863 21 7.6Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M18 4H4.6C4.26863 4 4 4.26863 4 4.6V18\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M7 16.8L12.4444 15L21 18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M16.5 13C15.6716 13 15 12.3284 15 11.5C15 10.6716 15.6716 10 16.5 10C17.3284 10 18 10.6716 18 11.5C18 12.3284 17.3284 13 16.5 13Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\taria-hidden=\"true\"\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z\"\n\t/>\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M4.867 19.125h.008v.008h-.008v-.008Z\" />\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M12 4L12 20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M8 9L8 15\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M20 10L20 14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M4 10L4 14\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M16 7L16 17\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\taria-hidden=\"true\"\n\t><path d=\"M13 16H18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M6 8L10 12L6 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M2 18V6C2 4.89543 2.89543 4 4 4H20C21.1046 4 22 4.89543 22 6V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tclass={className}\n\taria-hidden=\"true\"\n\tstroke-width={strokeWidth}\n\tfill=\"none\"\n\tstroke=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { fly } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport { config, user, tools as _tools, mobile, settings, toolServers } from '$lib/stores';\n\n\timport { getOAuthClientAuthorizationUrl } from '$lib/apis/configs';\n\timport { getTools } from '$lib/apis/tools';\n\n\timport Knobs from '$lib/components/icons/Knobs.svelte';\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Switch from '$lib/components/common/Switch.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Wrench from '$lib/components/icons/Wrench.svelte';\n\timport Sparkles from '$lib/components/icons/Sparkles.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\timport Photo from '$lib/components/icons/Photo.svelte';\n\timport Terminal from '$lib/components/icons/Terminal.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let selectedToolIds: string[] = [];\n\n\texport let selectedModels: string[] = [];\n\texport let fileUploadCapableModels: string[] = [];\n\n\texport let toggleFilters: { id: string; name: string; description?: string; icon?: string }[] =\n\t\t[];\n\texport let selectedFilterIds: string[] = [];\n\n\texport let showWebSearchButton = false;\n\texport let webSearchEnabled = false;\n\texport let showImageGenerationButton = false;\n\texport let imageGenerationEnabled = false;\n\texport let showCodeInterpreterButton = false;\n\texport let codeInterpreterEnabled = false;\n\n\texport let onShowValves: Function;\n\texport let onClose: Function;\n\texport let closeOnOutsideClick = true;\n\n\tlet show = false;\n\tlet tab = '';\n\n\tlet tools = null;\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tlet fileUploadEnabled = true;\n\t$: fileUploadEnabled =\n\t\tfileUploadCapableModels.length === selectedModels.length &&\n\t\t($user?.role === 'admin' || $user?.permissions?.chat?.file_upload);\n\n\tconst init = async () => {\n\t\tif ($_tools === null) {\n\t\t\tawait _tools.set(await getTools(localStorage.token));\n\t\t}\n\n\t\tif ($_tools) {\n\t\t\ttools = $_tools.reduce((a, tool, i, arr) => {\n\t\t\t\ta[tool.id] = {\n\t\t\t\t\tname: tool.name,\n\t\t\t\t\tdescription: tool.meta.description,\n\t\t\t\t\tenabled: selectedToolIds.includes(tool.id),\n\t\t\t\t\t...tool\n\t\t\t\t};\n\t\t\t\treturn a;\n\t\t\t}, {});\n\t\t}\n\n\t\tif ($toolServers) {\n\t\t\tfor (const serverIdx in $toolServers) {\n\t\t\t\tconst server = $toolServers[serverIdx];\n\t\t\t\tif (server.info) {\n\t\t\t\t\ttools[`direct_server:${serverIdx}`] = {\n\t\t\t\t\t\tname: server?.info?.title ?? server.url,\n\t\t\t\t\t\tdescription: server.info.description ?? '',\n\t\t\t\t\t\tenabled: selectedToolIds.includes(`direct_server:${serverIdx}`)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselectedToolIds = selectedToolIds.filter((id) => Object.keys(tools).includes(id));\n\t};\n</script>\n\n<Dropdown\n\tbind:show\n\t{closeOnOutsideClick}\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('Integrations')} placement=\"top\">\n\t\t<slot />\n\t</Tooltip>\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin\"\n\t\t\tsideOffset={4}\n\t\t\talignOffset={-6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if tab === ''}\n\t\t\t\t<div in:fly={{ x: -20, duration: 150 }}>\n\t\t\t\t\t{#if tools}\n\t\t\t\t\t\t{#if Object.keys(tools).length > 0}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'tools';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Wrench />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Tools')}\n\t\t\t\t\t\t\t\t\t\t<span class=\"ml-0.5 text-gray-500\">{Object.keys(tools).length}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"py-4\">\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if toggleFilters && toggleFilters.length > 0}\n\t\t\t\t\t\t{#each toggleFilters.sort( (a, b) => a.name.localeCompare( b.name, undefined, { sensitivity: 'base' } ) ) as filter, filterIdx (filter.id)}\n\t\t\t\t\t\t\t<Tooltip content={filter?.description} placement=\"top-start\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tif (selectedFilterIds.includes(filter.id)) {\n\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = selectedFilterIds.filter((id) => id !== filter.id);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = [...selectedFilterIds, filter.id];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t{#if filter?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4 items-center flex justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={filter.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 {filter.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={filter.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{filter?.name}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{#if filter?.has_user_valves}\n\t\t\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonShowValves({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'function',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: filter.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Knobs />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\tstate={selectedFilterIds.includes(filter.id)}\n\t\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showWebSearchButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Search the internet')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\twebSearchEnabled = !webSearchEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<GlobeAlt />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Web Search')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={webSearchEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showImageGenerationButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Generate an image')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\timageGenerationEnabled = !imageGenerationEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Photo className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Image')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={imageGenerationEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showCodeInterpreterButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Execute code for analysis')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\taria-pressed={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\taria-label={codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('Disable Code Interpreter')\n\t\t\t\t\t\t\t\t\t: $i18n.t('Enable Code Interpreter')}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tcodeInterpreterEnabled = !codeInterpreterEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Terminal className=\"size-3.5\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Code Interpreter')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'tools' && tools}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Tools')}\n\t\t\t\t\t\t\t\t<span class=\"ml-0.5 text-gray-500\">{Object.keys(tools).length}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"relative flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\ton:click={async (e) => {\n\t\t\t\t\t\t\t\tif (!(tools[toolId]?.authenticated ?? true)) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\tlet parts = toolId.split(':');\n\t\t\t\t\t\t\t\t\tlet serverId = parts?.at(-1) ?? toolId;\n\n\t\t\t\t\t\t\t\t\tconst authUrl = getOAuthClientAuthorizationUrl(serverId, 'mcp');\n\t\t\t\t\t\t\t\t\twindow.open(authUrl, '_self', 'noopener');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttools[toolId].enabled = !tools[toolId].enabled;\n\n\t\t\t\t\t\t\t\t\tconst state = tools[toolId].enabled;\n\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\t\t\tselectedToolIds = [...selectedToolIds, toolId];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tselectedToolIds = selectedToolIds.filter((id) => id !== toolId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if !(tools[toolId]?.authenticated ?? true)}\n\t\t\t\t\t\t\t\t<!-- make it slighly darker and not clickable -->\n\t\t\t\t\t\t\t\t<div class=\"absolute inset-0 opacity-50 rounded-xl cursor-pointer z-10\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.name ?? ''} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Wrench />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} placement=\"top-start\">\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{tools[toolId].name}</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if tools[toolId]?.has_user_valves}\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')}>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\tonShowValves({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'tool',\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: toolId\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Knobs />\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t<Switch state={tools[toolId].enabled} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path\n\t\td=\"M5.21173 15.1113L2.52473 12.4243C2.29041 12.1899 2.29041 11.8101 2.52473 11.5757L5.21173 8.88873C5.44605 8.65442 5.82595 8.65442 6.06026 8.88873L8.74727 11.5757C8.98158 11.8101 8.98158 12.1899 8.74727 12.4243L6.06026 15.1113C5.82595 15.3456 5.44605 15.3456 5.21173 15.1113Z\"\n\t></path><path\n\t\td=\"M11.5757 21.475L8.88874 18.788C8.65443 18.5537 8.65443 18.1738 8.88874 17.9395L11.5757 15.2525C11.8101 15.0182 12.19 15.0182 12.4243 15.2525L15.1113 17.9395C15.3456 18.1738 15.3456 18.5537 15.1113 18.788L12.4243 21.475C12.19 21.7094 11.8101 21.7094 11.5757 21.475Z\"\n\t></path><path\n\t\td=\"M11.5757 8.7475L8.88874 6.06049C8.65443 5.82618 8.65443 5.44628 8.88874 5.21197L11.5757 2.52496C11.8101 2.29065 12.19 2.29065 12.4243 2.52496L15.1113 5.21197C15.3456 5.44628 15.3456 5.82618 15.1113 6.06049L12.4243 8.7475C12.19 8.98181 11.8101 8.98181 11.5757 8.7475Z\"\n\t></path><path\n\t\td=\"M17.9396 15.1113L15.2526 12.4243C15.0183 12.1899 15.0183 11.8101 15.2526 11.5757L17.9396 8.88873C18.174 8.65442 18.5539 8.65442 18.7882 8.88873L21.4752 11.5757C21.7095 11.8101 21.7095 12.1899 21.4752 12.4243L18.7882 15.1113C18.5539 15.3456 18.174 15.3456 17.9396 15.1113Z\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M6 12H12M18 12H12M12 12V6M12 12V18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport DOMPurify from 'dompurify';\n\timport { marked } from 'marked';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { createPicker, getAuthToken } from '$lib/utils/google-drive-picker';\n\timport { pickAndDownloadFile } from '$lib/utils/onedrive-file-picker';\n\n\timport { onMount, tick, getContext, createEventDispatcher, onDestroy } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\ttype Model,\n\t\tmobile,\n\t\tsettings,\n\t\tmodels,\n\t\tconfig,\n\t\tshowCallOverlay,\n\t\ttools,\n\t\ttoolServers,\n\t\tuser as _user,\n\t\tshowControls,\n\t\tTTSWorker,\n\t\ttemporaryChatEnabled\n\t} from '$lib/stores';\n\n\timport {\n\t\tconvertHeicToJpeg,\n\t\tcompressImage,\n\t\tcreateMessagesList,\n\t\textractContentFromFile,\n\t\textractCurlyBraceWords,\n\t\textractInputVariables,\n\t\tgetAge,\n\t\tgetCurrentDateTime,\n\t\tgetFormattedDate,\n\t\tgetFormattedTime,\n\t\tgetUserPosition,\n\t\tgetUserTimezone,\n\t\tgetWeekday\n\t} from '$lib/utils';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { generateAutoCompletion } from '$lib/apis';\n\timport { deleteFileById } from '$lib/apis/files';\n\timport { getSessionUser } from '$lib/apis/auths';\n\timport { getTools } from '$lib/apis/tools';\n\n\timport { WEBUI_BASE_URL, WEBUI_API_BASE_URL, PASTED_TEXT_CHARACTER_LIMIT } from '$lib/constants';\n\n\timport InputMenu from './MessageInput/InputMenu.svelte';\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\n\timport FilesOverlay from './MessageInput/FilesOverlay.svelte';\n\timport ToolServersModal from './ToolServersModal.svelte';\n\n\timport RichTextInput from '../common/RichTextInput.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport FileItem from '../common/FileItem.svelte';\n\timport Image from '../common/Image.svelte';\n\n\timport XMark from '../icons/XMark.svelte';\n\timport Headphone from '../icons/Headphone.svelte';\n\timport GlobeAlt from '../icons/GlobeAlt.svelte';\n\timport Photo from '../icons/Photo.svelte';\n\timport Wrench from '../icons/Wrench.svelte';\n\timport CommandLine from '../icons/CommandLine.svelte';\n\timport Sparkles from '../icons/Sparkles.svelte';\n\n\timport InputVariablesModal from './MessageInput/InputVariablesModal.svelte';\n\timport Voice from '../icons/Voice.svelte';\n\timport Terminal from '../icons/Terminal.svelte';\n\timport IntegrationsMenu from './MessageInput/IntegrationsMenu.svelte';\n\timport Component from '../icons/Component.svelte';\n\timport PlusAlt from '../icons/PlusAlt.svelte';\n\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\n\timport { getSuggestionRenderer } from '../common/RichTextInput/suggestions';\n\timport CommandSuggestionList from './MessageInput/CommandSuggestionList.svelte';\n\timport Knobs from '../icons/Knobs.svelte';\n\timport ValvesModal from '../workspace/common/ValvesModal.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onChange: Function = () => {};\n\texport let createMessagePair: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\texport let generating = false;\n\n\texport let atSelectedModel: Model | undefined = undefined;\n\texport let selectedModels: [''];\n\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\texport let history;\n\texport let taskIds = null;\n\n\texport let prompt = '';\n\texport let files = [];\n\n\texport let selectedToolIds = [];\n\texport let selectedFilterIds = [];\n\n\texport let imageGenerationEnabled = false;\n\texport let webSearchEnabled = false;\n\texport let codeInterpreterEnabled = false;\n\n\tlet showInputVariablesModal = false;\n\tlet inputVariablesModalCallback = (variableValues) => {};\n\tlet inputVariables = {};\n\tlet inputVariableValues = {};\n\n\tlet showValvesModal = false;\n\tlet selectedValvesType = 'tool'; // 'tool' or 'function'\n\tlet selectedValvesItemId = null;\n\tlet integrationsMenuCloseOnOutsideClick = true;\n\n\t$: if (!showValvesModal) {\n\t\tintegrationsMenuCloseOnOutsideClick = true;\n\t}\n\n\t$: onChange({\n\t\tprompt,\n\t\tfiles: files\n\t\t\t.filter((file) => file.type !== 'image')\n\t\t\t.map((file) => {\n\t\t\t\treturn {\n\t\t\t\t\t...file,\n\t\t\t\t\tuser: undefined,\n\t\t\t\t\taccess_control: undefined\n\t\t\t\t};\n\t\t\t}),\n\t\tselectedToolIds,\n\t\tselectedFilterIds,\n\t\timageGenerationEnabled,\n\t\twebSearchEnabled,\n\t\tcodeInterpreterEnabled\n\t});\n\n\tconst inputVariableHandler = async (text: string): Promise<string> => {\n\t\tinputVariables = extractInputVariables(text);\n\n\t\t// No variables? return the original text immediately.\n\t\tif (Object.keys(inputVariables).length === 0) {\n\t\t\treturn text;\n\t\t}\n\n\t\t// Show modal and wait for the user's input.\n\t\tshowInputVariablesModal = true;\n\t\treturn await new Promise<string>((resolve) => {\n\t\t\tinputVariablesModalCallback = (variableValues) => {\n\t\t\t\tinputVariableValues = { ...inputVariableValues, ...variableValues };\n\t\t\t\treplaceVariables(inputVariableValues);\n\t\t\t\tshowInputVariablesModal = false;\n\t\t\t\tresolve(text);\n\t\t\t};\n\t\t});\n\t};\n\n\tconst textVariableHandler = async (text: string) => {\n\t\tif (text.includes('{{CLIPBOARD}}')) {\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t});\n\n\t\t\tconst clipboardItems = await navigator.clipboard.read();\n\n\t\t\tlet imageUrl = null;\n\t\t\tfor (const item of clipboardItems) {\n\t\t\t\t// Check for known image types\n\t\t\t\tfor (const type of item.types) {\n\t\t\t\t\tif (type.startsWith('image/')) {\n\t\t\t\t\t\tconst blob = await item.getType(type);\n\t\t\t\t\t\timageUrl = URL.createObjectURL(blob);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (imageUrl) {\n\t\t\t\tfiles = [\n\t\t\t\t\t...files,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\ttext = text.replaceAll('{{CLIPBOARD}}', clipboardText);\n\t\t}\n\n\t\tif (text.includes('{{USER_LOCATION}}')) {\n\t\t\tlet location;\n\t\t\ttry {\n\t\t\t\tlocation = await getUserPosition();\n\t\t\t} catch (error) {\n\t\t\t\ttoast.error($i18n.t('Location access not allowed'));\n\t\t\t\tlocation = 'LOCATION_UNKNOWN';\n\t\t\t}\n\t\t\ttext = text.replaceAll('{{USER_LOCATION}}', String(location));\n\t\t}\n\n\t\tconst sessionUser = await getSessionUser(localStorage.token);\n\n\t\tif (text.includes('{{USER_NAME}}')) {\n\t\t\tconst name = sessionUser?.name || 'User';\n\t\t\ttext = text.replaceAll('{{USER_NAME}}', name);\n\t\t}\n\n\t\tif (text.includes('{{USER_BIO}}')) {\n\t\t\tconst bio = sessionUser?.bio || '';\n\n\t\t\tif (bio) {\n\t\t\t\ttext = text.replaceAll('{{USER_BIO}}', bio);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_GENDER}}')) {\n\t\t\tconst gender = sessionUser?.gender || '';\n\n\t\t\tif (gender) {\n\t\t\t\ttext = text.replaceAll('{{USER_GENDER}}', gender);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_BIRTH_DATE}}')) {\n\t\t\tconst birthDate = sessionUser?.date_of_birth || '';\n\n\t\t\tif (birthDate) {\n\t\t\t\ttext = text.replaceAll('{{USER_BIRTH_DATE}}', birthDate);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_AGE}}')) {\n\t\t\tconst birthDate = sessionUser?.date_of_birth || '';\n\n\t\t\tif (birthDate) {\n\t\t\t\t// calculate age using date\n\t\t\t\tconst age = getAge(birthDate);\n\t\t\t\ttext = text.replaceAll('{{USER_AGE}}', age);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_LANGUAGE}}')) {\n\t\t\tconst language = localStorage.getItem('locale') || 'en-US';\n\t\t\ttext = text.replaceAll('{{USER_LANGUAGE}}', language);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_DATE}}')) {\n\t\t\tconst date = getFormattedDate();\n\t\t\ttext = text.replaceAll('{{CURRENT_DATE}}', date);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_TIME}}')) {\n\t\t\tconst time = getFormattedTime();\n\t\t\ttext = text.replaceAll('{{CURRENT_TIME}}', time);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_DATETIME}}')) {\n\t\t\tconst dateTime = getCurrentDateTime();\n\t\t\ttext = text.replaceAll('{{CURRENT_DATETIME}}', dateTime);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_TIMEZONE}}')) {\n\t\t\tconst timezone = getUserTimezone();\n\t\t\ttext = text.replaceAll('{{CURRENT_TIMEZONE}}', timezone);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_WEEKDAY}}')) {\n\t\t\tconst weekday = getWeekday();\n\t\t\ttext = text.replaceAll('{{CURRENT_WEEKDAY}}', weekday);\n\t\t}\n\n\t\treturn text;\n\t};\n\n\tconst replaceVariables = (variables: Record<string, any>) => {\n\t\tconsole.log('Replacing variables:', variables);\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\n\t\tif (chatInput) {\n\t\t\tchatInputElement.replaceVariables(variables);\n\t\t\tchatInputElement.focus();\n\t\t}\n\t};\n\n\texport const setText = async (text?: string, cb?: (text: string) => void) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\n\t\tif (chatInput) {\n\t\t\tif (text !== '') {\n\t\t\t\ttext = await textVariableHandler(text || '');\n\t\t\t}\n\n\t\t\tchatInputElement?.setText(text);\n\t\t\tchatInputElement?.focus();\n\n\t\t\tif (text !== '') {\n\t\t\t\ttext = await inputVariableHandler(text);\n\t\t\t}\n\n\t\t\tawait tick();\n\t\t\tif (cb) await cb(text);\n\t\t}\n\t};\n\n\tconst getCommand = () => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tlet word = '';\n\n\t\tif (chatInput) {\n\t\t\tword = chatInputElement?.getWordAtDocPos();\n\t\t}\n\n\t\treturn word;\n\t};\n\n\tconst replaceCommandWithText = (text) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tif (!chatInput) return;\n\n\t\tchatInputElement?.replaceCommandWithText(text);\n\t};\n\n\tconst insertTextAtCursor = async (text: string) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tif (!chatInput) return;\n\n\t\ttext = await textVariableHandler(text);\n\n\t\tif (command) {\n\t\t\treplaceCommandWithText(text);\n\t\t} else {\n\t\t\tchatInputElement?.insertContent(text);\n\t\t}\n\n\t\tawait tick();\n\t\ttext = await inputVariableHandler(text);\n\t\tawait tick();\n\n\t\tconst chatInputContainer = document.getElementById('chat-input-container');\n\t\tif (chatInputContainer) {\n\t\t\tchatInputContainer.scrollTop = chatInputContainer.scrollHeight;\n\t\t}\n\n\t\tawait tick();\n\t\tif (chatInput) {\n\t\t\tchatInput.focus();\n\t\t\tchatInput.dispatchEvent(new Event('input'));\n\n\t\t\tconst words = extractCurlyBraceWords(prompt);\n\n\t\t\tif (words.length > 0) {\n\t\t\t\tconst word = words.at(0);\n\t\t\t\tawait tick();\n\t\t\t} else {\n\t\t\t\tchatInput.scrollTop = chatInput.scrollHeight;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet command = '';\n\texport let showCommands = false;\n\t$: showCommands = ['/', '#', '@'].includes(command?.charAt(0)) || '\\\\#' === command?.slice(0, 2);\n\tlet suggestions = null;\n\n\tlet showTools = false;\n\n\tlet loaded = false;\n\tlet recording = false;\n\n\tlet isComposing = false;\n\t// Safari has a bug where compositionend is not triggered correctly #16615\n\t// when using the virtual keyboard on iOS.\n\tlet compositionEndedAt = -2e8;\n\tconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\tfunction inOrNearComposition(event: Event) {\n\t\tif (isComposing) {\n\t\t\treturn true;\n\t\t}\n\t\t// See https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/.\n\t\t// On Japanese input method editors (IMEs), the Enter key is used to confirm character\n\t\t// selection. On Safari, when Enter is pressed, compositionend and keydown events are\n\t\t// emitted. The keydown event triggers newline insertion, which we don't want.\n\t\t// This method returns true if the keydown event should be ignored.\n\t\t// We only ignore it once, as pressing Enter a second time *should* insert a newline.\n\t\t// Furthermore, the keydown event timestamp must be close to the compositionEndedAt timestamp.\n\t\t// This guards against the case where compositionend is triggered without the keyboard\n\t\t// (e.g. character confirmation may be done with the mouse), and keydown is triggered\n\t\t// afterwards- we wouldn't want to ignore the keydown event in this case.\n\t\tif (isSafari && Math.abs(event.timeStamp - compositionEndedAt) < 500) {\n\t\t\tcompositionEndedAt = -2e8;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlet chatInputContainerElement;\n\tlet chatInputElement;\n\n\tlet filesInputElement;\n\tlet commandsElement;\n\n\tlet inputFiles;\n\n\tlet dragged = false;\n\tlet shiftKey = false;\n\n\tlet user = null;\n\texport let placeholder = '';\n\n\tlet visionCapableModels = [];\n\t$: visionCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\n\t);\n\n\tlet fileUploadCapableModels = [];\n\t$: fileUploadCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.file_upload ?? true\n\t);\n\n\tlet webSearchCapableModels = [];\n\t$: webSearchCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.web_search ?? true\n\t);\n\n\tlet imageGenerationCapableModels = [];\n\t$: imageGenerationCapableModels = (\n\t\tatSelectedModel?.id ? [atSelectedModel.id] : selectedModels\n\t).filter(\n\t\t(model) =>\n\t\t\t$models.find((m) => m.id === model)?.info?.meta?.capabilities?.image_generation ?? true\n\t);\n\n\tlet codeInterpreterCapableModels = [];\n\t$: codeInterpreterCapableModels = (\n\t\tatSelectedModel?.id ? [atSelectedModel.id] : selectedModels\n\t).filter(\n\t\t(model) =>\n\t\t\t$models.find((m) => m.id === model)?.info?.meta?.capabilities?.code_interpreter ?? true\n\t);\n\n\tlet toggleFilters = [];\n\t$: toggleFilters = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels)\n\t\t.map((id) => ($models.find((model) => model.id === id) || {})?.filters ?? [])\n\t\t.reduce((acc, filters) => acc.filter((f1) => filters.some((f2) => f2.id === f1.id)));\n\n\tlet showToolsButton = false;\n\t$: showToolsButton = ($tools ?? []).length > 0 || ($toolServers ?? []).length > 0;\n\n\tlet showWebSearchButton = false;\n\t$: showWebSearchButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\twebSearchCapableModels.length &&\n\t\t$config?.features?.enable_web_search &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.web_search);\n\n\tlet showImageGenerationButton = false;\n\t$: showImageGenerationButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\timageGenerationCapableModels.length &&\n\t\t$config?.features?.enable_image_generation &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.image_generation);\n\n\tlet showCodeInterpreterButton = false;\n\t$: showCodeInterpreterButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\tcodeInterpreterCapableModels.length &&\n\t\t$config?.features?.enable_code_interpreter &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.code_interpreter);\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTo({\n\t\t\ttop: element.scrollHeight,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t};\n\n\tconst screenCaptureHandler = async () => {\n\t\ttry {\n\t\t\t// Request screen media\n\t\t\tconst mediaStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\tvideo: { cursor: 'never' },\n\t\t\t\taudio: false\n\t\t\t});\n\t\t\t// Once the user selects a screen, temporarily create a video element\n\t\t\tconst video = document.createElement('video');\n\t\t\tvideo.srcObject = mediaStream;\n\t\t\t// Ensure the video loads without affecting user experience or tab switching\n\t\t\tawait video.play();\n\t\t\t// Set up the canvas to match the video dimensions\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = video.videoWidth;\n\t\t\tcanvas.height = video.videoHeight;\n\t\t\t// Grab a single frame from the video stream using the canvas\n\t\t\tconst context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(video, 0, 0, canvas.width, canvas.height);\n\t\t\t// Stop all video tracks (stop screen sharing) after capturing the image\n\t\t\tmediaStream.getTracks().forEach((track) => track.stop());\n\n\t\t\t// bring back focus to this current tab, so that the user can see the screen capture\n\t\t\twindow.focus();\n\n\t\t\t// Convert the canvas to a Base64 image URL\n\t\t\tconst imageUrl = canvas.toDataURL('image/png');\n\t\t\t// Add the captured image to the files array to render it\n\t\t\tfiles = [...files, { type: 'image', url: imageUrl }];\n\t\t\t// Clean memory: Clear video srcObject\n\t\t\tvideo.srcObject = null;\n\t\t} catch (error) {\n\t\t\t// Handle any errors (e.g., user cancels screen sharing)\n\t\t\tconsole.error('Error capturing screen:', error);\n\t\t}\n\t};\n\n\tconst uploadFileHandler = async (file, fullContext: boolean = false) => {\n\t\tif ($_user?.role !== 'admin' && !($_user?.permissions?.chat?.file_upload ?? true)) {\n\t\t\ttoast.error($i18n.t('You do not have permission to upload files.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tif (fileUploadCapableModels.length !== selectedModels.length) {\n\t\t\ttoast.error($i18n.t('Model(s) do not support file upload'));\n\t\t\treturn null;\n\t\t}\n\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tsize: file.size,\n\t\t\terror: '',\n\t\t\titemId: tempItemId,\n\t\t\t...(fullContext ? { context: 'full' } : {})\n\t\t};\n\n\t\tif (fileItem.size == 0) {\n\t\t\ttoast.error($i18n.t('You cannot upload an empty file.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tfiles = [...files, fileItem];\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\ttry {\n\t\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\t\tlet metadata = null;\n\t\t\t\tif (\n\t\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t\t) {\n\t\t\t\t\tmetadata = {\n\t\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// During the file upload, file content is automatically extracted.\n\t\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata);\n\n\t\t\t\tif (uploadedFile) {\n\t\t\t\t\tconsole.log('File upload completed:', {\n\t\t\t\t\t\tid: uploadedFile.id,\n\t\t\t\t\t\tname: fileItem.name,\n\t\t\t\t\t\tcollection: uploadedFile?.meta?.collection_name\n\t\t\t\t\t});\n\n\t\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t\t}\n\n\t\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\t\tfileItem.file = uploadedFile;\n\t\t\t\t\tfileItem.id = uploadedFile.id;\n\t\t\t\t\tfileItem.collection_name =\n\t\t\t\t\t\tuploadedFile?.meta?.collection_name || uploadedFile?.collection_name;\n\t\t\t\t\tfileItem.url = `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`;\n\n\t\t\t\t\tfiles = files;\n\t\t\t\t} else {\n\t\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t}\n\t\t} else {\n\t\t\t// If temporary chat is enabled, we just add the file to the list without uploading it.\n\n\t\t\tconst content = await extractContentFromFile(file).catch((error) => {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t('Failed to extract content from the file: {{error}}', { error: error })\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (content === null) {\n\t\t\t\ttoast.error($i18n.t('Failed to extract content from the file.'));\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\tconsole.log('Extracted content from file:', {\n\t\t\t\t\tname: file.name,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\tcontent: content\n\t\t\t\t});\n\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.type = 'text';\n\t\t\t\tfileItem.content = content;\n\t\t\t\tfileItem.id = uuidv4(); // Temporary ID for the file\n\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst inputFilesHandler = async (inputFiles) => {\n\t\tconsole.log('Input files handler called with:', inputFiles);\n\n\t\tif (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + inputFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tinputFiles.forEach(async (file) => {\n\t\t\tconsole.log('Processing file:', {\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t\tsize: file.size,\n\t\t\t\textension: file.name.split('.').at(-1)\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t) {\n\t\t\t\tconsole.log('File exceeds max size limit:', {\n\t\t\t\t\tfileSize: file.size,\n\t\t\t\t\tmaxSize: ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t\t});\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file['type'].startsWith('image/')) {\n\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst compressImageHandler = async (imageUrl, settings = {}, config = {}) => {\n\t\t\t\t\t// Quick shortcut so we dont do unnecessary work.\n\t\t\t\t\tconst settingsCompression = settings?.imageCompression ?? false;\n\t\t\t\t\tconst configWidth = config?.file?.image_compression?.width ?? null;\n\t\t\t\t\tconst configHeight = config?.file?.image_compression?.height ?? null;\n\n\t\t\t\t\t// If neither settings nor config wants compression, return original URL.\n\t\t\t\t\tif (!settingsCompression && !configWidth && !configHeight) {\n\t\t\t\t\t\treturn imageUrl;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Default to null (no compression unless set)\n\t\t\t\t\tlet width = null;\n\t\t\t\t\tlet height = null;\n\n\t\t\t\t\t// If user/settings want compression, pick their preferred size.\n\t\t\t\t\tif (settingsCompression) {\n\t\t\t\t\t\twidth = settings?.imageCompressionSize?.width ?? null;\n\t\t\t\t\t\theight = settings?.imageCompressionSize?.height ?? null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply config limits as an upper bound if any\n\t\t\t\t\tif (configWidth && (width === null || width > configWidth)) {\n\t\t\t\t\t\twidth = configWidth;\n\t\t\t\t\t}\n\t\t\t\t\tif (configHeight && (height === null || height > configHeight)) {\n\t\t\t\t\t\theight = configHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do the compression if required\n\t\t\t\t\tif (width || height) {\n\t\t\t\t\t\treturn await compressImage(imageUrl, width, height);\n\t\t\t\t\t}\n\t\t\t\t\treturn imageUrl;\n\t\t\t\t};\n\n\t\t\t\tlet reader = new FileReader();\n\t\t\t\treader.onload = async (event) => {\n\t\t\t\t\tlet imageUrl = event.target.result;\n\n\t\t\t\t\timageUrl = await compressImageHandler(imageUrl, $settings, $config);\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t...files,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: `${imageUrl}`\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t};\n\t\t\t\treader.readAsDataURL(file['type'] === 'image/heic' ? await convertHeicToJpeg(file) : file);\n\t\t\t} else {\n\t\t\t\tuploadFileHandler(file);\n\t\t\t}\n\t\t});\n\t};\n\n\tconst onDragOver = (e) => {\n\t\te.preventDefault();\n\n\t\t// Check if a file is being dragged.\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tdragged = true;\n\t\t} else {\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onDragLeave = () => {\n\t\tdragged = false;\n\t};\n\n\tconst onDrop = async (e) => {\n\t\te.preventDefault();\n\t\tconsole.log(e);\n\n\t\tif (e.dataTransfer?.files) {\n\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\tconsole.log(inputFiles);\n\t\t\t\tinputFilesHandler(inputFiles);\n\t\t\t}\n\t\t}\n\n\t\tdragged = false;\n\t};\n\n\tconst onKeyDown = (e) => {\n\t\tif (e.key === 'Shift') {\n\t\t\tshiftKey = true;\n\t\t}\n\n\t\tif (e.key === 'Escape') {\n\t\t\tconsole.log('Escape');\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onKeyUp = (e) => {\n\t\tif (e.key === 'Shift') {\n\t\t\tshiftKey = false;\n\t\t}\n\t};\n\n\tconst onFocus = () => {};\n\n\tconst onBlur = () => {\n\t\tshiftKey = false;\n\t};\n\n\tonMount(async () => {\n\t\tsuggestions = [\n\t\t\t{\n\t\t\t\tchar: '@',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdispatch('upload', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t{\n\t\t\t\tchar: '/',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdispatch('upload', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t{\n\t\t\t\tchar: '#',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdispatch('upload', e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t];\n\t\tloaded = true;\n\n\t\twindow.setTimeout(() => {\n\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\tchatInput?.focus();\n\t\t}, 0);\n\n\t\twindow.addEventListener('keydown', onKeyDown);\n\t\twindow.addEventListener('keyup', onKeyUp);\n\n\t\twindow.addEventListener('focus', onFocus);\n\t\twindow.addEventListener('blur', onBlur);\n\n\t\tawait tick();\n\n\t\tconst dropzoneElement = document.getElementById('chat-container');\n\n\t\tdropzoneElement?.addEventListener('dragover', onDragOver);\n\t\tdropzoneElement?.addEventListener('drop', onDrop);\n\t\tdropzoneElement?.addEventListener('dragleave', onDragLeave);\n\n\t\tawait tools.set(await getTools(localStorage.token));\n\t});\n\n\tonDestroy(() => {\n\t\tconsole.log('destroy');\n\t\twindow.removeEventListener('keydown', onKeyDown);\n\t\twindow.removeEventListener('keyup', onKeyUp);\n\n\t\twindow.removeEventListener('focus', onFocus);\n\t\twindow.removeEventListener('blur', onBlur);\n\n\t\tconst dropzoneElement = document.getElementById('chat-container');\n\n\t\tif (dropzoneElement) {\n\t\t\tdropzoneElement?.removeEventListener('dragover', onDragOver);\n\t\t\tdropzoneElement?.removeEventListener('drop', onDrop);\n\t\t\tdropzoneElement?.removeEventListener('dragleave', onDragLeave);\n\t\t}\n\t});\n</script>\n\n<FilesOverlay show={dragged} />\n<ToolServersModal bind:show={showTools} {selectedToolIds} />\n\n<InputVariablesModal\n\tbind:show={showInputVariablesModal}\n\tvariables={inputVariables}\n\tonSave={inputVariablesModalCallback}\n/>\n\n<ValvesModal\n\tbind:show={showValvesModal}\n\tuserValves={true}\n\ttype={selectedValvesType}\n\tid={selectedValvesItemId ?? null}\n\ton:save={async () => {\n\t\tawait tick();\n\t}}\n\ton:close={() => {\n\t\tintegrationsMenuCloseOnOutsideClick = true;\n\t}}\n/>\n\n{#if loaded}\n\t<div class=\"w-full font-primary\">\n\t\t<div class=\" mx-auto inset-x-0 bg-transparent flex justify-center\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col px-3 {($settings?.widescreenMode ?? null)\n\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t: 'max-w-6xl'} w-full\"\n\t\t\t>\n\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t{#if autoScroll === false && history?.currentId}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tautoScroll = true;\n\t\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"bg-transparent\">\n\t\t\t<div\n\t\t\t\tclass=\"{($settings?.widescreenMode ?? null)\n\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t: 'max-w-6xl'} px-2.5 mx-auto inset-x-0\"\n\t\t\t>\n\t\t\t\t<div class=\"\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tbind:this={filesInputElement}\n\t\t\t\t\t\tbind:files={inputFiles}\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\thidden\n\t\t\t\t\t\tmultiple\n\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\n\t\t\t\t\t\t\t\tinputFilesHandler(_inputFiles);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{#if recording}\n\t\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\t\tonCancel={async () => {\n\t\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonConfirm={async (data) => {\n\t\t\t\t\t\t\t\tconst { text, filename } = data;\n\n\t\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tinsertTextAtCursor(text);\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\n\t\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<form\n\t\t\t\t\t\t\tclass=\"w-full flex flex-col gap-1.5\"\n\t\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\t\t// check if selectedModels support image input\n\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tid=\"message-input-container\"\n\t\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border {$temporaryChatEnabled\n\t\t\t\t\t\t\t\t\t? 'border-dashed border-gray-100 dark:border-gray-800 hover:border-gray-200 focus-within:border-gray-200 hover:dark:border-gray-700 focus-within:dark:border-gray-700'\n\t\t\t\t\t\t\t\t\t: ' border-gray-100 dark:border-gray-850 hover:border-gray-200 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800'}  transition px-1 bg-white/5 dark:bg-gray-500/5 backdrop-blur-sm dark:text-gray-100\"\n\t\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if atSelectedModel !== undefined}\n\t\t\t\t\t\t\t\t\t<div class=\"px-3 pt-3 text-left w-full flex flex-col z-10\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between w-full\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"model profile\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 max-w-[28px] object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={$models.find((model) => model.id === atSelectedModel.id)?.info?.meta\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.profile_image_url ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `${WEBUI_BASE_URL}/doge.png`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/favicon.png`)}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"translate-y-[0.5px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"\">{atSelectedModel.name}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"flex items-center dark:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if files.length > 0}\n\t\t\t\t\t\t\t\t\t<div class=\"mx-2 mt-2.5 pb-1.5 flex items-center flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timageClassName=\" size-10 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...(atSelectedModel ? [atSelectedModel] : selectedModels)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-white text-black border border-white rounded-full {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'outline-hidden focus:outline-hidden group-hover:visible invisible transition'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Remove file')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\t\t\t\tloading={file.status === 'uploading'}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodal={['file', 'collection'].includes(file?.type)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove from UI state\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<div class=\"px-2.5\">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pb-1 px-1 resize-none h-fit max-h-96 overflow-auto {files.length ===\n\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t? atSelectedModel !== undefined\n\t\t\t\t\t\t\t\t\t\t\t\t? 'pt-1.5'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'pt-2.5'\n\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\tid=\"chat-input-container\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{#if suggestions}\n\t\t\t\t\t\t\t\t\t\t\t{#key $settings?.richTextInput ?? true}\n\t\t\t\t\t\t\t\t\t\t\t\t{#key $settings?.showFormattingToolbar ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<RichTextInput\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbind:this={chatInputElement}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"chat-input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprompt = e.md;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommand = getCommand();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjson={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trichText={$settings?.richTextInput ?? true}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessageInput={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowFormattingToolbar={$settings?.showFormattingToolbar ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfloatingMenuPlacement={'top-start'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tinsertPromptAsRichText={$settings?.insertPromptAsRichText ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshiftEnter={!($settings?.ctrlEnterToSend ?? false) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!$mobile &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder={placeholder ? placeholder : $i18n.t('Send a Message')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlargeTextAsFile={($settings?.largeTextAsFile ?? false) && !shiftKey}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tautocomplete={$config?.features?.enable_autocomplete_generation &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.promptAutocomplete ?? false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgenerateAutoCompletion={async (text) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModelIds.length === 0 || !selectedModelIds.at(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Please select a model first.'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst res = await generateAutoCompletion(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedModelIds.at(0),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thistory?.currentId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? createMessagesList(history, history.currentId)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(error);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestions}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toncompositionstart={() => (isComposing = true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toncompositionend={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompositionEndedAt = e.timeStamp;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisComposing = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te = e.detail.event;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst suggestionsContainerElement =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('suggestions-container');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Command/Ctrl + Shift + Enter to submit a message pair\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (isCtrlPressed && e.key === 'Enter' && e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreateMessagePair(prompt);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Check if Ctrl + R is pressed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt === '' && isCtrlPressed && e.key.toLowerCase() === 'r') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('regenerate');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst regenerateButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('regenerate-response-button')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tregenerateButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (userMessageElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!suggestionsContainerElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (inOrNearComposition(e)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Uses keyCode '13' for Enter key for chinese/japanese keyboards.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Depending on the user's settings, it will send the message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// either when Enter is pressed or when Ctrl+Enter is pressed.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst enterPressed =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.ctrlEnterToSend ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? (e.key === 'Enter' || e.keyCode === 13) && isCtrlPressed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (e.key === 'Enter' || e.keyCode === 13) && !e.shiftKey;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (enterPressed) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedToolIds = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = [];\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twebSearchEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timageGenerationEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcodeInterpreterEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:paste={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te = e.detail.event;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (item.type.indexOf('image') !== -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst reader = new FileReader();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treader.onload = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: `${e.target.result}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (item?.kind === 'file') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst _files = [file];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait inputFilesHandler(_files);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (item.type === 'text/plain') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (($settings?.largeTextAsFile ?? false) && !shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst text = clipboardData.getData('text/plain');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (text.length > PASTED_TEXT_CHARACTER_LIMIT) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = new Blob([text], { type: 'text/plain' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[blob],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Pasted_Text_${Date.now()}.txt`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text/plain'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file, true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" flex justify-between mt-0.5 mb-2.5 mx-0.5 max-w-full\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t<div class=\"ml-1 self-end flex items-center flex-1 max-w-[80%]\">\n\t\t\t\t\t\t\t\t\t\t<InputMenu\n\t\t\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\t\t\tselectedModels={atSelectedModel ? [atSelectedModel.id] : selectedModels}\n\t\t\t\t\t\t\t\t\t\t\t{fileUploadCapableModels}\n\t\t\t\t\t\t\t\t\t\t\t{screenCaptureHandler}\n\t\t\t\t\t\t\t\t\t\t\t{inputFilesHandler}\n\t\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tuploadGoogleDriveHandler={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst fileData = await createPicker();\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (fileData) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File([fileData.blob], fileData.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: fileData.blob.type\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('No file was selected from Google Drive');\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('Google Drive Error:', error);\n\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Error accessing Google Drive: {{error}}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: error.message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tuploadOneDriveHandler={async (authorityType) => {\n\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst fileData = await pickAndDownloadFile(authorityType);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (fileData) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File([fileData.blob], fileData.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: fileData.blob.type || 'application/octet-stream'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('No file was selected from OneDrive');\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('OneDrive Error:', error);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonUpload={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tdispatch('upload', e);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\t\t\t\t\t\t\t\t\t\tchatInput?.focus();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"input-menu-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<PlusAlt className=\"size-5.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</InputMenu>\n\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"flex self-center w-[1px] h-4 mx-1 bg-gray-200/50 dark:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t{#if showWebSearchButton || showImageGenerationButton || showCodeInterpreterButton || showToolsButton || (toggleFilters && toggleFilters.length > 0)}\n\t\t\t\t\t\t\t\t\t\t\t<IntegrationsMenu\n\t\t\t\t\t\t\t\t\t\t\t\tselectedModels={atSelectedModel ? [atSelectedModel.id] : selectedModels}\n\t\t\t\t\t\t\t\t\t\t\t\t{toggleFilters}\n\t\t\t\t\t\t\t\t\t\t\t\t{showWebSearchButton}\n\t\t\t\t\t\t\t\t\t\t\t\t{showImageGenerationButton}\n\t\t\t\t\t\t\t\t\t\t\t\t{showCodeInterpreterButton}\n\t\t\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\tcloseOnOutsideClick={integrationsMenuCloseOnOutsideClick}\n\t\t\t\t\t\t\t\t\t\t\t\tonShowValves={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst { type, id } = e;\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesType = type;\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesItemId = id;\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowValvesModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\tintegrationsMenuCloseOnOutsideClick = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\t\t\t\t\t\t\t\t\t\t\tchatInput?.focus();\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"integration-menu-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Component className=\"size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</IntegrationsMenu>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if selectedModelIds.length === 1 && $models.find((m) => m.id === selectedModelIds[0])?.has_user_valves}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ml-1 flex gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"model-valves-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesType = 'function';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesItemId = selectedModelIds[0]?.split('.')[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowValvesModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Knobs className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"ml-1 flex gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t{#if (selectedToolIds ?? []).length > 0}\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{COUNT}} Available Tools', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tCOUNT: selectedToolIds.length\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"translate-y-[0.5px] px-1 flex gap-1 items-center text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 rounded-lg self-center transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Available Tools\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowTools = !showTools;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"size-4\" strokeWidth=\"1.75\" />\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedToolIds.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t\t{#each selectedFilterIds as filterId}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const filter = toggleFilters.find((f) => f.id === filterId)}\n\t\t\t\t\t\t\t\t\t\t\t\t{#if filter}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={filter?.name} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = selectedFilterIds.filter(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(id) => id !== filterId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {selectedFilterIds.includes(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfilterId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '} capitalize\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#if filter?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4 items-center flex justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={filter.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 {filter.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={filter.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t\t\t\t\t{#if webSearchEnabled}\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Web Search')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => (webSearchEnabled = !webSearchEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {webSearchEnabled ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.webSearch ?? false) === 'always'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<GlobeAlt className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t\t{#if imageGenerationEnabled}\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Image')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(imageGenerationEnabled = !imageGenerationEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {imageGenerationEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Photo className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t\t{#if codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Code Interpreter')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? $i18n.t('Disable Code Interpreter')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: $i18n.t('Enable Code Interpreter')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-pressed={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(codeInterpreterEnabled = !codeInterpreterEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" group p-[7px] flex gap-1.5 items-center text-sm transition-colors duration-300 max-w-full overflow-hidden {codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '} {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'm-1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'focus:outline-hidden rounded-full'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Terminal className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"self-end flex space-x-1 mr-1 shrink-0\">\n\t\t\t\t\t\t\t\t\t\t{#if (!history?.currentId || history.messages[history.currentId]?.done == true) && ($_user?.role === 'admin' || ($_user?.permissions?.chat?.stt ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Record voice')} -->\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Dictate')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 mr-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Voice Input\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if (taskIds && taskIds.length > 0) || (history.currentId && history.messages[history.currentId]?.done != true) || generating}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Stop')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else if prompt === '' && files.length === 0 && ($_user?.role === 'admin' || ($_user?.permissions?.chat?.call ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Call')} -->\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Voice mode')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taudio: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user has not initialized the TTS worker, initialize it\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!$TTSWorker) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait TTSWorker.set(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew KokoroWorker({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdtype: $settings.audio?.tts?.engineConfig?.dtype ?? 'fp32'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait $TTSWorker.init();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowControls.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Permission denied when accessing media devices')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Voice mode')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Voice className=\"size-5\" strokeWidth=\"2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{!(prompt === '' && files.length === 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === '' && files.length === 0}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if $config?.license_metadata?.input_footer}\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-500 text-center line-clamp-1 marked\">\n\t\t\t\t\t\t\t\t\t{@html DOMPurify.sanitize(marked($config?.license_metadata?.input_footer))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\"mb-1\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</form>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { models, showSettings, settings, user, mobile, config } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Selector from './ModelSelector/Selector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\timport { updateUserSettings } from '$lib/apis/users';\n\tconst i18n = getContext('i18n');\n\n\texport let selectedModels = [''];\n\texport let disabled = false;\n\n\texport let showSetDefault = true;\n\n\tconst saveDefaultModel = async () => {\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\n\t\tif (hasEmptyModel.length) {\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\n\t\t\treturn;\n\t\t}\n\t\tsettings.set({ ...$settings, models: selectedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\n\t\ttoast.success($i18n.t('Default model updated'));\n\t};\n\n\tconst pinModelHandler = async (modelId) => {\n\t\tlet pinnedModels = $settings?.pinnedModels ?? [];\n\n\t\tif (pinnedModels.includes(modelId)) {\n\t\t\tpinnedModels = pinnedModels.filter((id) => id !== modelId);\n\t\t} else {\n\t\t\tpinnedModels = [...new Set([...pinnedModels, modelId])];\n\t\t}\n\n\t\tsettings.set({ ...$settings, pinnedModels: pinnedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\t};\n\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\n\t\tconst _selectedModels = selectedModels.map((model) =>\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\n\t\t);\n\n\t\tif (JSON.stringify(_selectedModels) !== JSON.stringify(selectedModels)) {\n\t\t\tselectedModels = _selectedModels;\n\t\t}\n\t}\n</script>\n\n<div class=\"flex flex-col w-full items-start\">\n\t{#each selectedModels as selectedModel, selectedModelIdx}\n\t\t<div class=\"flex w-full max-w-fit\">\n\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t<div class=\"max-w-full {($settings?.highContrastMode ?? false) ? 'm-1' : 'mr-1'}\">\n\t\t\t\t\t<Selector\n\t\t\t\t\t\tid={`${selectedModelIdx}`}\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t}))}\n\t\t\t\t\t\t{pinModelHandler}\n\t\t\t\t\t\tbind:value={selectedModel}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions?.chat?.multiple_models ?? true)}\n\t\t\t\t{#if selectedModelIdx === 0}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" \"\n\t\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Add Model\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\n\t\t\t\t\t\t\t\t\tselectedModels = selectedModels;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Remove Model\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n\n{#if showSetDefault}\n\t<div\n\t\tclass=\"relative text-left mt-[1px] ml-1 text-[0.7rem] text-gray-600 dark:text-gray-400 font-primary\"\n\t>\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tviewBox=\"0 0 24 24\"\n\tstroke=\"currentColor\"\n\tfill=\"currentColor\"\n\tclass={className}\n\tstroke-width={strokeWidth}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, tick } from 'svelte';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\n\timport { copyToClipboard, createMessagesList } from '$lib/utils';\n\n\timport {\n\t\tshowOverview,\n\t\tshowControls,\n\t\tshowArtifacts,\n\t\tmobile,\n\t\ttemporaryChatEnabled,\n\t\ttheme,\n\t\tuser,\n\t\tsettings,\n\t\tfolders,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getChatById } from '$lib/apis/chats';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tags from '$lib/components/chat/Tags.svelte';\n\timport Map from '$lib/components/icons/Map.svelte';\n\timport Clipboard from '$lib/components/icons/Clipboard.svelte';\n\timport AdjustmentsHorizontal from '$lib/components/icons/AdjustmentsHorizontal.svelte';\n\timport Cube from '$lib/components/icons/Cube.svelte';\n\timport Folder from '$lib/components/icons/Folder.svelte';\n\timport Share from '$lib/components/icons/Share.svelte';\n\timport ArchiveBox from '$lib/components/icons/ArchiveBox.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Download from '$lib/components/icons/Download.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let shareEnabled: boolean = false;\n\n\texport let shareHandler: Function;\n\texport let moveChatHandler: Function;\n\n\texport let archiveChatHandler: Function;\n\n\t// export let tagHandler: Function;\n\n\texport let chat;\n\texport let onClose: Function = () => {};\n\n\tlet showFullMessages = false;\n\n\tconst getChatAsText = async () => {\n\t\tconst history = chat.chat.history;\n\t\tconst messages = createMessagesList(history, history.currentId);\n\t\tconst chatText = messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\treturn chatText.trim();\n\t};\n\n\tconst downloadTxt = async () => {\n\t\tconst chatText = await getChatAsText();\n\n\t\tlet blob = new Blob([chatText], {\n\t\t\ttype: 'text/plain'\n\t\t});\n\n\t\tsaveAs(blob, `chat-${chat.chat.title}.txt`);\n\t};\n\n\tconst downloadPdf = async () => {\n\t\tconst [{ default: jsPDF }, { default: html2canvas }] = await Promise.all([\n\t\t\timport('jspdf'),\n\t\t\timport('html2canvas-pro')\n\t\t]);\n\n\t\tif ($settings?.stylizedPdfExport ?? true) {\n\t\t\tshowFullMessages = true;\n\t\t\tawait tick();\n\n\t\t\tconst containerElement = document.getElementById('full-messages-container');\n\t\t\tif (containerElement) {\n\t\t\t\ttry {\n\t\t\t\t\tconst isDarkMode = document.documentElement.classList.contains('dark');\n\t\t\t\t\tconst virtualWidth = 800; // px, fixed width for cloned element\n\n\t\t\t\t\t// Clone and style\n\t\t\t\t\tconst clonedElement = containerElement.cloneNode(true);\n\t\t\t\t\tclonedElement.classList.add('text-black');\n\t\t\t\t\tclonedElement.classList.add('dark:text-white');\n\t\t\t\t\tclonedElement.style.width = `${virtualWidth}px`;\n\t\t\t\t\tclonedElement.style.position = 'absolute';\n\t\t\t\t\tclonedElement.style.left = '-9999px';\n\t\t\t\t\tclonedElement.style.height = 'auto';\n\t\t\t\t\tdocument.body.appendChild(clonedElement);\n\n\t\t\t\t\t// Wait for DOM update/layout\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\n\t\t\t\t\t// Render entire content once\n\t\t\t\t\tconst canvas = await html2canvas(clonedElement, {\n\t\t\t\t\t\tbackgroundColor: isDarkMode ? '#000' : '#fff',\n\t\t\t\t\t\tuseCORS: true,\n\t\t\t\t\t\tscale: 2, // increase resolution\n\t\t\t\t\t\twidth: virtualWidth\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.body.removeChild(clonedElement);\n\n\t\t\t\t\tconst pdf = new jsPDF('p', 'mm', 'a4');\n\t\t\t\t\tconst pageWidthMM = 210;\n\t\t\t\t\tconst pageHeightMM = 297;\n\n\t\t\t\t\t// Convert page height in mm to px on canvas scale for cropping\n\t\t\t\t\t// Get canvas DPI scale:\n\t\t\t\t\tconst pxPerMM = canvas.width / virtualWidth; // width in px / width in px?\n\t\t\t\t\t// Since 1 page width is 210 mm, but canvas width is 800 px at scale 2\n\t\t\t\t\t// Assume 1 mm = px / (pageWidthMM scaled)\n\t\t\t\t\t// Actually better: Calculate scale factor from px/mm:\n\t\t\t\t\t// virtualWidth px corresponds directly to 210mm in PDF, so pxPerMM:\n\t\t\t\t\tconst pxPerPDFMM = canvas.width / pageWidthMM; // canvas px per PDF mm\n\n\t\t\t\t\t// Height in px for one page slice:\n\t\t\t\t\tconst pagePixelHeight = Math.floor(pxPerPDFMM * pageHeightMM);\n\n\t\t\t\t\tlet offsetY = 0;\n\t\t\t\t\tlet page = 0;\n\n\t\t\t\t\twhile (offsetY < canvas.height) {\n\t\t\t\t\t\t// Height of slice\n\t\t\t\t\t\tconst sliceHeight = Math.min(pagePixelHeight, canvas.height - offsetY);\n\n\t\t\t\t\t\t// Create temp canvas for slice\n\t\t\t\t\t\tconst pageCanvas = document.createElement('canvas');\n\t\t\t\t\t\tpageCanvas.width = canvas.width;\n\t\t\t\t\t\tpageCanvas.height = sliceHeight;\n\n\t\t\t\t\t\tconst ctx = pageCanvas.getContext('2d');\n\n\t\t\t\t\t\t// Draw the slice of original canvas onto pageCanvas\n\t\t\t\t\t\tctx.drawImage(\n\t\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\toffsetY,\n\t\t\t\t\t\t\tcanvas.width,\n\t\t\t\t\t\t\tsliceHeight,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\tcanvas.width,\n\t\t\t\t\t\t\tsliceHeight\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst imgData = pageCanvas.toDataURL('image/jpeg', 0.7);\n\n\t\t\t\t\t\t// Calculate image height in PDF units keeping aspect ratio\n\t\t\t\t\t\tconst imgHeightMM = (sliceHeight * pageWidthMM) / canvas.width;\n\n\t\t\t\t\t\tif (page > 0) pdf.addPage();\n\n\t\t\t\t\t\tif (isDarkMode) {\n\t\t\t\t\t\t\tpdf.setFillColor(0, 0, 0);\n\t\t\t\t\t\t\tpdf.rect(0, 0, pageWidthMM, pageHeightMM, 'F'); // black bg\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpdf.addImage(imgData, 'JPEG', 0, 0, pageWidthMM, imgHeightMM);\n\n\t\t\t\t\t\toffsetY += sliceHeight;\n\t\t\t\t\t\tpage++;\n\t\t\t\t\t}\n\n\t\t\t\t\tpdf.save(`chat-${chat.chat.title}.pdf`);\n\n\t\t\t\t\tshowFullMessages = false;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Error generating PDF', error);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('Downloading PDF');\n\n\t\t\tconst chatText = await getChatAsText();\n\n\t\t\tconst doc = new jsPDF();\n\n\t\t\t// Margins\n\t\t\tconst left = 15;\n\t\t\tconst top = 20;\n\t\t\tconst right = 15;\n\t\t\tconst bottom = 20;\n\n\t\t\tconst pageWidth = doc.internal.pageSize.getWidth();\n\t\t\tconst pageHeight = doc.internal.pageSize.getHeight();\n\t\t\tconst usableWidth = pageWidth - left - right;\n\t\t\tconst usableHeight = pageHeight - top - bottom;\n\n\t\t\t// Font size and line height\n\t\t\tconst fontSize = 8;\n\t\t\tdoc.setFontSize(fontSize);\n\t\t\tconst lineHeight = fontSize * 1; // adjust if needed\n\n\t\t\t// Split the markdown into lines (handles \\n)\n\t\t\tconst paragraphs = chatText.split('\\n');\n\n\t\t\tlet y = top;\n\n\t\t\tfor (let paragraph of paragraphs) {\n\t\t\t\t// Wrap each paragraph to fit the width\n\t\t\t\tconst lines = doc.splitTextToSize(paragraph, usableWidth);\n\n\t\t\t\tfor (let line of lines) {\n\t\t\t\t\t// If the line would overflow the bottom, add a new page\n\t\t\t\t\tif (y + lineHeight > pageHeight - bottom) {\n\t\t\t\t\t\tdoc.addPage();\n\t\t\t\t\t\ty = top;\n\t\t\t\t\t}\n\t\t\t\t\tdoc.text(line, left, y);\n\t\t\t\t\ty += lineHeight * 0.5;\n\t\t\t\t}\n\t\t\t\t// Add empty line at paragraph breaks\n\t\t\t\ty += lineHeight * 0.1;\n\t\t\t}\n\n\t\t\tdoc.save(`chat-${chat.chat.title}.pdf`);\n\t\t}\n\t};\n\n\tconst downloadJSONExport = async () => {\n\t\tif (chat.id) {\n\t\t\tlet chatObj = null;\n\n\t\t\tif ((chat?.id ?? '').startsWith('local') || $temporaryChatEnabled) {\n\t\t\t\tchatObj = chat;\n\t\t\t} else {\n\t\t\t\tchatObj = await getChatById(localStorage.token, chat.id);\n\t\t\t}\n\n\t\t\tlet blob = new Blob([JSON.stringify([chatObj])], {\n\t\t\t\ttype: 'application/json'\n\t\t\t});\n\t\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\n\t\t}\n\t};\n</script>\n\n{#if showFullMessages}\n\t<div class=\"hidden w-full h-full flex-col\">\n\t\t<div id=\"full-messages-container\">\n\t\t\t<Messages\n\t\t\t\tclassName=\"h-full flex pt-4 pb-8 w-full\"\n\t\t\t\tchatId={`chat-preview-${chat?.id ?? ''}`}\n\t\t\t\tuser={$user}\n\t\t\t\treadOnly={true}\n\t\t\t\thistory={chat.chat.history}\n\t\t\t\tmessages={chat.chat.messages}\n\t\t\t\tautoScroll={true}\n\t\t\t\tsendMessage={() => {}}\n\t\t\t\tcontinueResponse={() => {}}\n\t\t\t\tregenerateResponse={() => {}}\n\t\t\t\tmessagesCount={null}\n\t\t\t\teditCodeBlock={false}\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/if}\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showSettings.set(!$showSettings);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\n\t\t\t</DropdownMenu.Item> -->\n\n\t\t\t{#if $mobile}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-controls-button\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\t\tawait showOverview.set(false);\n\t\t\t\t\t\tawait showArtifacts.set(false);\n\t\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<AdjustmentsHorizontal className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Controls')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-overview-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\tawait showOverview.set(true);\n\t\t\t\t\tawait showArtifacts.set(false);\n\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Map className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Overview')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-overview-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\tawait showArtifacts.set(true);\n\t\t\t\t\tawait showOverview.set(false);\n\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Cube className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Artifacts')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<hr class=\"border-gray-50 dark:border-gray-800 my-1\" />\n\n\t\t\t{#if !$temporaryChatEnabled && ($user?.role === 'admin' || ($user.permissions?.chat?.share ?? true))}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-share-button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshareHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Share strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t>\n\t\t\t\t\t<Download strokeWidth=\"1.5\" />\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t{#if $user?.role === 'admin' || ($user.permissions?.chat?.export ?? true)}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tdownloadJSONExport();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadTxt();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadPdf();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-copy-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tconst res = await copyToClipboard(await getChatAsText()).catch((e) => {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\ttoast.success($i18n.t('Copied to clipboard'));\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Clipboard className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Copy')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t{#if !$temporaryChatEnabled && chat?.id}\n\t\t\t\t<hr class=\"border-gray-50 dark:border-gray-800 my-1\" />\n\n\t\t\t\t<DropdownMenu.Sub>\n\t\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Folder strokeWidth=\"1.5\" />\n\n\t\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Move')}</div>\n\t\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\t\tclass=\"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\t\tsideOffset={8}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#each $folders.sort((a, b) => b.updated_at - a.updated_at) as folder}\n\t\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tmoveChatHandler(chat?.id, folder?.id);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Folder strokeWidth=\"1.5\" />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center\">{folder?.name ?? 'Folder'}</div>\n\t\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t\t</DropdownMenu.Sub>\n\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tarchiveChatHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ArchiveBox className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Archive')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t<hr class=\"border-gray-50 dark:border-gray-800 my-1\" />\n\n\t\t\t\t<div class=\"flex p-1\">\n\t\t\t\t\t<Tags chatId={chat.id} />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\tstroke-dasharray=\"2.5 3.5\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path d=\"M8 12L11 15L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n\t<path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\tstroke-dasharray=\"2.5 3.5\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M9 12H12M15 12H12M12 12V9M12 12V15\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M8 12L11 15L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\timport {\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tchatId,\n\t\tconfig,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArchivedChats,\n\t\tshowControls,\n\t\tshowSidebar,\n\t\ttemporaryChatEnabled,\n\t\tuser\n\t} from '$lib/stores';\n\n\timport { slide } from 'svelte/transition';\n\timport { page } from '$app/stores';\n\timport { goto } from '$app/navigation';\n\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\n\timport ModelSelector from '../chat/ModelSelector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Menu from '$lib/components/layout/Navbar/Menu.svelte';\n\timport UserMenu from '$lib/components/layout/Sidebar/UserMenu.svelte';\n\timport AdjustmentsHorizontal from '../icons/AdjustmentsHorizontal.svelte';\n\n\timport PencilSquare from '../icons/PencilSquare.svelte';\n\timport Banner from '../common/Banner.svelte';\n\timport Sidebar from '../icons/Sidebar.svelte';\n\n\timport ChatBubbleDotted from '../icons/ChatBubbleDotted.svelte';\n\timport ChatBubbleDottedChecked from '../icons/ChatBubbleDottedChecked.svelte';\n\n\timport EllipsisHorizontal from '../icons/EllipsisHorizontal.svelte';\n\timport ChatPlus from '../icons/ChatPlus.svelte';\n\timport ChatCheck from '../icons/ChatCheck.svelte';\n\timport Knobs from '../icons/Knobs.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let initNewChat: Function;\n\texport let shareEnabled: boolean = false;\n\n\texport let chat;\n\texport let history;\n\texport let selectedModels;\n\texport let showModelSelector = true;\n\n\texport let onSaveTempChat: () => {};\n\texport let archiveChatHandler: (id: string) => void;\n\texport let moveChatHandler: (id: string, folderId: string) => void;\n\n\tlet closedBannerIds = [];\n\n\tlet showShareChatModal = false;\n\tlet showDownloadChatModal = false;\n</script>\n\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\n\n<button\n\tid=\"new-chat-button\"\n\tclass=\"hidden\"\n\ton:click={() => {\n\t\tinitNewChat();\n\t}}\n\taria-label=\"New Chat\"\n/>\n\n<nav class=\"sticky top-0 z-30 w-full py-1 -mb-8 flex flex-col items-center drag-region\">\n\t<div class=\"flex items-center w-full pl-1.5 pr-1\">\n\t\t<div\n\t\t\tclass=\" bg-linear-to-b via-40% to-97% from-white via-white to-transparent dark:from-gray-900 dark:via-gray-900 dark:to-transparent pointer-events-none absolute inset-0 -bottom-7 z-[-1]\"\n\t\t></div>\n\n\t\t<div class=\" flex max-w-full w-full mx-auto px-1.5 md:px-2 pt-0.5 bg-transparent\">\n\t\t\t<div class=\"flex items-center w-full max-w-full\">\n\t\t\t\t{#if $mobile && !$showSidebar}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"-translate-x-0.5 mr-1 mt-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$showSidebar ? $i18n.t('Close Sidebar') : $i18n.t('Open Sidebar')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" cursor-pointer flex rounded-lg hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" self-center p-1.5\">\n\t\t\t\t\t\t\t\t\t<Sidebar />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex-1 overflow-hidden max-w-full py-0.5\n\t\t\t{$showSidebar ? 'ml-1' : ''}\n\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t{#if showModelSelector}\n\t\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\n\n\t\t\t\t\t{#if $user?.role === 'user' ? ($user?.permissions?.chat?.temporary ?? true) && !($user?.permissions?.chat?.temporary_enforced ?? false) : true}\n\t\t\t\t\t\t{#if !chat?.id}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t(`Temporary Chat`)}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\tid=\"temporary-chat-button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tif (($settings?.temporaryChatByDefault ?? false) && $temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\t// for proper initNewChat handling\n\t\t\t\t\t\t\t\t\t\t\tawait temporaryChatEnabled.set(null);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tawait temporaryChatEnabled.set(!$temporaryChatEnabled);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tawait goto('/');\n\n\t\t\t\t\t\t\t\t\t\t// add 'temporary-chat=true' to the URL\n\t\t\t\t\t\t\t\t\t\tif ($temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\twindow.history.replaceState(null, '', '?temporary-chat=true');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\twindow.history.replaceState(null, '', location.pathname);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t{#if $temporaryChatEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<ChatBubbleDottedChecked className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<ChatBubbleDotted className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{:else if $temporaryChatEnabled}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t(`Save Chat`)}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\tid=\"save-temporary-chat-button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tonSaveTempChat();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t<ChatCheck className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $mobile && !$temporaryChatEnabled && chat && chat.id}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" flex {$showSidebar\n\t\t\t\t\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tinitNewChat();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"New Chat\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<ChatPlus className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if shareEnabled && chat && (chat.id || $temporaryChatEnabled)}\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{chat}\n\t\t\t\t\t\t\t{shareEnabled}\n\t\t\t\t\t\t\tshareHandler={() => {\n\t\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tarchiveChatHandler={() => {\n\t\t\t\t\t\t\t\tarchiveChatHandler(chat.id);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t{moveChatHandler}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<EllipsisHorizontal className=\" size-5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true)}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Controls')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\tawait showControls.set(!$showControls);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Controls\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<Knobs className=\" size-5\" strokeWidth=\"1\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $user !== undefined && $user !== null}\n\t\t\t\t\t\t<UserMenu\n\t\t\t\t\t\t\tclassName=\"max-w-[240px]\"\n\t\t\t\t\t\t\trole={$user?.role}\n\t\t\t\t\t\t\thelp={true}\n\t\t\t\t\t\t\ton:show={(e) => {\n\t\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\n\t\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" self-center\">\n\t\t\t\t\t\t\t\t\t<span class=\"sr-only\">{$i18n.t('User menu')}</span>\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tsrc={$user?.profile_image_url}\n\t\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</UserMenu>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if $temporaryChatEnabled && ($chatId ?? '').startsWith('local:')}\n\t\t<div class=\" w-full z-30 text-center\">\n\t\t\t<div class=\"text-xs text-gray-500\">{$i18n.t('Temporary Chat')}</div>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"absolute top-[100%] left-0 right-0 h-fit\">\n\t\t{#if !history.currentId && !$chatId && ($banners.length > 0 || ($config?.license_metadata?.type ?? null) === 'trial' || (($config?.license_metadata?.seats ?? null) !== null && $config?.user_count > $config?.license_metadata?.seats))}\n\t\t\t<div class=\" w-full z-30\">\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\n\t\t\t\t\t{#if ($config?.license_metadata?.type ?? null) === 'trial'}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\tbanner={{\n\t\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\t\ttitle: 'Trial License',\n\t\t\t\t\t\t\t\tcontent: $i18n.t(\n\t\t\t\t\t\t\t\t\t'You are currently using a trial license. Please contact support to upgrade your license.'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if ($config?.license_metadata?.seats ?? null) !== null && $config?.user_count > $config?.license_metadata?.seats}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\tbanner={{\n\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\ttitle: 'License Error',\n\t\t\t\t\t\t\t\tcontent: $i18n.t(\n\t\t\t\t\t\t\t\t\t'Exceeded the number of seats in your license. Please contact support to increase the number of seats.'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#each $banners.filter((b) => ![...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]'), ...closedBannerIds].includes(b.id)) as banner (banner.id)}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\t{banner}\n\t\t\t\t\t\t\ton:dismiss={(e) => {\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\n\n\t\t\t\t\t\t\t\tif (banner.dismissible) {\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\n\t\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\t\tbannerId,\n\t\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\n\t\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tclosedBannerIds = [...closedBannerIds, bannerId];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</nav>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { config, functions, models, settings, tools, user } from '$lib/stores';\n\timport { createEventDispatcher, onMount, getContext, tick } from 'svelte';\n\n\timport {\n\t\tgetUserValvesSpecById as getToolUserValvesSpecById,\n\t\tgetUserValvesById as getToolUserValvesById,\n\t\tupdateUserValvesById as updateToolUserValvesById,\n\t\tgetTools\n\t} from '$lib/apis/tools';\n\timport {\n\t\tgetUserValvesSpecById as getFunctionUserValvesSpecById,\n\t\tgetUserValvesById as getFunctionUserValvesById,\n\t\tupdateUserValvesById as updateFunctionUserValvesById,\n\t\tgetFunctions\n\t} from '$lib/apis/functions';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Valves from '$lib/components/common/Valves.svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\n\tlet tab = 'tools';\n\tlet selectedId = '';\n\n\tlet loading = false;\n\n\tlet valvesSpec = null;\n\tlet valves = {};\n\n\tlet debounceTimer;\n\n\tconst debounceSubmitHandler = async () => {\n\t\tif (debounceTimer) {\n\t\t\tclearTimeout(debounceTimer);\n\t\t}\n\n\t\t// Set a new timer\n\t\tdebounceTimer = setTimeout(() => {\n\t\t\tsubmitHandler();\n\t\t}, 500); // 0.5 second debounce\n\t};\n\n\tconst getUserValves = async () => {\n\t\tloading = true;\n\t\tif (tab === 'tools') {\n\t\t\tvalves = await getToolUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getToolUserValvesSpecById(localStorage.token, selectedId);\n\t\t} else if (tab === 'functions') {\n\t\t\tvalves = await getFunctionUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getFunctionUserValvesSpecById(localStorage.token, selectedId);\n\t\t}\n\n\t\tif (valvesSpec) {\n\t\t\t// Convert array to string\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? []).join(',');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (valvesSpec) {\n\t\t\t// Convert string to array\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? '').split(',').map((v) => v.trim());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (tab === 'tools') {\n\t\t\t\tconst res = await updateToolUserValvesById(localStorage.token, selectedId, valves).catch(\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t} else if (tab === 'functions') {\n\t\t\t\tconst res = await updateFunctionUserValvesById(\n\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\tselectedId,\n\t\t\t\t\tvalves\n\t\t\t\t).catch((error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$: if (tab) {\n\t\tselectedId = '';\n\t}\n\n\t$: if (selectedId) {\n\t\tgetUserValves();\n\t}\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tconst init = async () => {\n\t\tloading = true;\n\n\t\tif ($functions === null) {\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t}\n\t\tif ($tools === null) {\n\t\t\ttools.set(await getTools(localStorage.token));\n\t\t}\n\n\t\tloading = false;\n\t};\n</script>\n\n{#if show && !loading}\n\t<form\n\t\tclass=\"flex flex-col h-full justify-between space-y-3 text-sm\"\n\t\ton:submit|preventDefault={() => {\n\t\t\tsubmitHandler();\n\t\t\tdispatch('save');\n\t\t}}\n\t>\n\t\t<div class=\"flex flex-col\">\n\t\t\t<div class=\"space-y-1\">\n\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"  w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={tab}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Select')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"tools\" class=\"bg-gray-100 dark:bg-gray-800\">{$i18n.t('Tools')}</option>\n\t\t\t\t\t\t\t<option value=\"functions\" class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t>{$i18n.t('Functions')}</option\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={selectedId}\n\t\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if tab === 'tools'}\n\t\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t('Select a tool')}</option\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t{#each $tools.filter((tool) => !tool?.id?.startsWith('server:')) as tool, toolIdx}\n\t\t\t\t\t\t\t\t\t<option value={tool.id} class=\"bg-gray-100 dark:bg-gray-800\">{tool.name}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{:else if tab === 'functions'}\n\t\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t('Select a function')}</option\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t{#each $functions as func, funcIdx}\n\t\t\t\t\t\t\t\t\t<option value={func.id} class=\"bg-gray-100 dark:bg-gray-800\">{func.name}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if selectedId}\n\t\t\t\t<hr class=\"border-gray-50 dark:border-gray-800 my-1 w-full\" />\n\n\t\t\t\t<div class=\"my-2 text-xs\">\n\t\t\t\t\t{#if !loading}\n\t\t\t\t\t\t<Valves\n\t\t\t\t\t\t\t{valvesSpec}\n\t\t\t\t\t\t\tbind:valves\n\t\t\t\t\t\t\ton:change={() => {\n\t\t\t\t\t\t\t\tdebounceSubmitHandler();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</form>\n{:else}\n\t<Spinner className=\"size-4\" />\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher, getContext } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport AdvancedParams from '../Settings/Advanced/AdvancedParams.svelte';\n\timport Valves from '$lib/components/chat/Controls/Valves.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\n\timport { user, settings } from '$lib/stores';\n\texport let models = [];\n\texport let chatFiles = [];\n\texport let params = {};\n\n\tlet showValves = false;\n</script>\n\n<div class=\" dark:text-white\">\n\t<div class=\" flex items-center justify-between dark:text-gray-100 mb-2\">\n\t\t<div class=\" text-lg font-medium self-center font-primary\">{$i18n.t('Chat Controls')}</div>\n\t\t<button\n\t\t\tclass=\"self-center\"\n\t\t\ton:click={() => {\n\t\t\t\tdispatch('close');\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-3.5\" />\n\t\t</button>\n\t</div>\n\n\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true)}\n\t\t<div class=\" dark:text-gray-200 text-sm font-primary py-0.5 px-0.5\">\n\t\t\t{#if chatFiles.length > 0}\n\t\t\t\t<Collapsible title={$i18n.t('Files')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"flex flex-col gap-1 mt-1.5\" slot=\"content\">\n\t\t\t\t\t\t{#each chatFiles as file, fileIdx}\n\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\turl={file?.url ? file.url : null}\n\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t// Remove the file from the chatFiles array\n\n\t\t\t\t\t\t\t\t\tchatFiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\tchatFiles = chatFiles;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.valves ?? true)}\n\t\t\t\t<Collapsible bind:open={showValves} title={$i18n.t('Valves')} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"text-sm\" slot=\"content\">\n\t\t\t\t\t\t<Valves show={showValves} />\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.system_prompt ?? true)}\n\t\t\t\t<Collapsible title={$i18n.t('System Prompt')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"\" slot=\"content\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tbind:value={params.system}\n\t\t\t\t\t\t\tclass=\"w-full text-xs outline-hidden resize-vertical {$settings.highContrastMode\n\t\t\t\t\t\t\t\t? 'border-2 border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 p-2.5'\n\t\t\t\t\t\t\t\t: 'py-1.5 bg-transparent'}\"\n\t\t\t\t\t\t\trows=\"4\"\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Enter system prompt')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"mt-2 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 rounded-lg transition\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tdispatch('generateUserTurn');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{$i18n.t('Generate User Turn')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.params ?? true)}\n\t\t\t\t<Collapsible title={$i18n.t('Advanced Params')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<AdvancedParams admin={$user?.role === 'admin'} custom={true} bind:params />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\n\texport let onClose: Function = () => {};\n\texport let devices: any;\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg p-1 border border-gray-100  dark:border-gray-800 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#each devices as device}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('change', device.deviceId);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/each}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { config, models, settings, showCallOverlay, TTSWorker } from '$lib/stores';\n\timport { onMount, tick, getContext, onDestroy, createEventDispatcher } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { blobToFile } from '$lib/utils';\n\timport { generateEmoji } from '$lib/apis';\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\n\tconst i18n = getContext('i18n');\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let files;\n\texport let chatId;\n\texport let modelId;\n\n\tlet wakeLock = null;\n\n\tlet model = null;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\tlet interrupted = false;\n\tlet assistantSpeaking = false;\n\n\tlet emoji = null;\n\tlet camera = false;\n\tlet cameraStream = null;\n\n\tlet chatStreaming = false;\n\tlet rmsLevel = 0;\n\tlet hasStartedSpeaking = false;\n\tlet mediaRecorder;\n\tlet audioStream = null;\n\tlet audioChunks = [];\n\n\tlet videoInputDevices = [];\n\tlet selectedVideoInputDeviceId = null;\n\n\tconst getVideoInputDevices = async () => {\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\n\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\n\t\t\tvideoInputDevices = [\n\t\t\t\t...videoInputDevices,\n\t\t\t\t{\n\t\t\t\t\tdeviceId: 'screen',\n\t\t\t\t\tlabel: 'Screen Share'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconsole.log(videoInputDevices);\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\n\t\t}\n\t};\n\n\tconst startCamera = async () => {\n\t\tawait getVideoInputDevices();\n\n\t\tif (cameraStream === null) {\n\t\t\tcamera = true;\n\t\t\tawait tick();\n\t\t\ttry {\n\t\t\t\tawait startVideoStream();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst startVideoStream = async () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tif (video) {\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always'\n\t\t\t\t\t},\n\t\t\t\t\taudio: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (cameraStream) {\n\t\t\t\tawait getVideoInputDevices();\n\t\t\t\tvideo.srcObject = cameraStream;\n\t\t\t\tawait video.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopVideoStream = async () => {\n\t\tif (cameraStream) {\n\t\t\tconst tracks = cameraStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tcameraStream = null;\n\t};\n\n\tconst takeScreenshot = () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tconst canvas = document.getElementById('camera-canvas');\n\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = canvas.getContext('2d');\n\n\t\t// Make the canvas match the video dimensions\n\t\tcanvas.width = video.videoWidth;\n\t\tcanvas.height = video.videoHeight;\n\n\t\t// Draw the image from the video onto the canvas\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n\n\t\t// Convert the canvas to a data base64 URL and console log it\n\t\tconst dataURL = canvas.toDataURL('image/png');\n\t\tconsole.log(dataURL);\n\n\t\treturn dataURL;\n\t};\n\n\tconst stopCamera = async () => {\n\t\tawait stopVideoStream();\n\t\tcamera = false;\n\t};\n\n\tconst MIN_DECIBELS = -55;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(\n\t\t\tlocalStorage.token,\n\t\t\tfile,\n\t\t\t$settings?.audio?.stt?.language\n\t\t).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\n\t\t\tif (res.text !== '') {\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\n\t\t\t\tconsole.log(_responses);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecordingCallback = async (_continue = true) => {\n\t\tif ($showCallOverlay) {\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' stopRecordingCallback ');\n\n\t\t\t// deep copy the audioChunks array\n\t\t\tconst _audioChunks = audioChunks.slice(0);\n\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (_continue) {\n\t\t\t\tstartRecording();\n\t\t\t}\n\n\t\t\tif (confirmed) {\n\t\t\t\tloading = true;\n\t\t\t\temoji = null;\n\n\t\t\t\tif (cameraStream) {\n\t\t\t\t\tconst imageUrl = takeScreenshot();\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\n\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t} else {\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (audioStream) {\n\t\t\t\tconst tracks = audioStream.getTracks();\n\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t}\n\t\t\taudioStream = null;\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\tif ($showCallOverlay) {\n\t\t\tif (!audioStream) {\n\t\t\t\taudioStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: {\n\t\t\t\t\t\techoCancellation: true,\n\t\t\t\t\t\tnoiseSuppression: true,\n\t\t\t\t\t\tautoGainControl: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tmediaRecorder = new MediaRecorder(audioStream);\n\n\t\t\tmediaRecorder.onstart = () => {\n\t\t\t\tconsole.log('Recording started');\n\t\t\t\taudioChunks = [];\n\t\t\t};\n\n\t\t\tmediaRecorder.ondataavailable = (event) => {\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\taudioChunks.push(event.data);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tmediaRecorder.onstop = (e) => {\n\t\t\t\tconsole.log('Recording stopped', audioStream, e);\n\t\t\t\tstopRecordingCallback();\n\t\t\t};\n\n\t\t\tanalyseAudio(audioStream);\n\t\t}\n\t};\n\n\tconst stopAudioStream = async () => {\n\t\ttry {\n\t\t\tif (mediaRecorder) {\n\t\t\t\tmediaRecorder.stop();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('Error stopping audio stream:', error);\n\t\t}\n\n\t\tif (!audioStream) return;\n\n\t\taudioStream.getAudioTracks().forEach(function (track) {\n\t\t\ttrack.stop();\n\t\t});\n\n\t\taudioStream = null;\n\t};\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\t\thasStartedSpeaking = false;\n\n\t\tconsole.log(' Sound detection started', lastSoundTime, hasStartedSpeaking);\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (assistantSpeaking && !($settings?.voiceInterruption ?? false)) {\n\t\t\t\t\t// Mute the audio if the assistant is speaking\n\t\t\t\t\tanalyser.maxDecibels = 0;\n\t\t\t\t\tanalyser.minDecibels = -1;\n\t\t\t\t} else {\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\t\t\t\tanalyser.maxDecibels = -30;\n\t\t\t\t}\n\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\n\n\t\t\t\t// Check if initial speech/noise has started\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\n\t\t\t\tif (hasSound) {\n\t\t\t\t\t// BIG RED TEXT\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Sound detected');\n\t\t\t\t\tif (mediaRecorder && mediaRecorder.state !== 'recording') {\n\t\t\t\t\t\tmediaRecorder.start();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!hasStartedSpeaking) {\n\t\t\t\t\t\thasStartedSpeaking = true;\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\n\t\t\t\t\tlastSoundTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\n\t\t\t\t\t\tconfirmed = true;\n\n\t\t\t\t\t\tif (mediaRecorder) {\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Silence detected');\n\t\t\t\t\t\t\tmediaRecorder.stop();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tlet finishedMessages = {};\n\tlet currentMessageId = null;\n\tlet currentUtterance = null;\n\n\tconst speakSpeechSynthesisHandler = (content) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tlet voices = [];\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\n\t\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\t\tconst voice =\n\t\t\t\t\t\t\tvoices\n\t\t\t\t\t\t\t\t?.filter(\n\t\t\t\t\t\t\t\t\t(v) => v.voiceURI === ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t?.at(0) ?? undefined;\n\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\n\t\t\t\t\t\tcurrentUtterance.rate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\t\tif (voice) {\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\n\t\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst playAudio = (audio) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst audioElement = document.getElementById('audioElement') as HTMLAudioElement;\n\n\t\t\t\tif (audioElement) {\n\t\t\t\t\taudioElement.src = audio.src;\n\t\t\t\t\taudioElement.muted = true;\n\t\t\t\t\taudioElement.playbackRate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\taudioElement\n\t\t\t\t\t\t.play()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t});\n\n\t\t\t\t\taudioElement.onended = async (e) => {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst stopAllAudio = async () => {\n\t\tassistantSpeaking = false;\n\t\tinterrupted = true;\n\n\t\tif (chatStreaming) {\n\t\t\tstopResponse();\n\t\t}\n\n\t\tif (currentUtterance) {\n\t\t\tspeechSynthesis.cancel();\n\t\t\tcurrentUtterance = null;\n\t\t}\n\n\t\tconst audioElement = document.getElementById('audioElement');\n\t\tif (audioElement) {\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.pause();\n\t\t\taudioElement.currentTime = 0;\n\t\t}\n\t};\n\n\tlet audioAbortController = new AbortController();\n\n\t// Audio cache map where key is the content and value is the Audio object.\n\tconst audioCache = new Map();\n\tconst emojiCache = new Map();\n\n\tconst fetchAudio = async (content) => {\n\t\tif (!audioCache.has(content)) {\n\t\t\ttry {\n\t\t\t\t// Set the emoji for the content if needed\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\n\t\t\t\t\tif (emoji) {\n\t\t\t\t\t\temojiCache.set(content, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\t\tconst blob = await $TTSWorker\n\t\t\t\t\t\t.generate({\n\t\t\t\t\t\t\ttext: content,\n\t\t\t\t\t\t\tvoice: $settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (blob) {\n\t\t\t\t\t\taudioCache.set(content, new Audio(blob));\n\t\t\t\t\t}\n\t\t\t\t} else if ($config.audio.tts.engine !== '') {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t$settings?.audio?.tts?.defaultVoice === $config.audio.tts.voice\n\t\t\t\t\t\t\t? ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t: $config?.audio?.tts?.voice,\n\t\t\t\t\t\tcontent\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taudioCache.set(content, true);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\n\t\t\t}\n\t\t}\n\n\t\treturn audioCache.get(content);\n\t};\n\n\tlet messages = {};\n\n\tconst monitorAndPlayAudio = async (id, signal) => {\n\t\twhile (!signal.aborted) {\n\t\t\tif (messages[id] && messages[id].length > 0) {\n\t\t\t\t// Retrieve the next content string from the queue\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\n\n\t\t\t\tif (audioCache.has(content)) {\n\t\t\t\t\t// If content is available in the cache, play it\n\n\t\t\t\t\t// Set the emoji for the content if available\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\n\t\t\t\t\t\temoji = emojiCache.get(content);\n\t\t\t\t\t} else {\n\t\t\t\t\t\temoji = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'%c%s',\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t}\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\n\t\t\t\tassistantSpeaking = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\t// No messages to process, sleep for a bit\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\n\t\t\t}\n\t\t}\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\n\t};\n\n\tconst chatStartHandler = async (e) => {\n\t\tconst { id } = e.detail;\n\n\t\tchatStreaming = true;\n\n\t\tif (currentMessageId !== id) {\n\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\n\n\t\t\tcurrentMessageId = id;\n\t\t\tif (audioAbortController) {\n\t\t\t\taudioAbortController.abort();\n\t\t\t}\n\t\t\taudioAbortController = new AbortController();\n\n\t\t\tassistantSpeaking = true;\n\t\t\t// Start monitoring and playing audio for the message ID\n\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\n\t\t}\n\t};\n\n\tconst chatEventHandler = async (e) => {\n\t\tconst { id, content } = e.detail;\n\t\t// \"id\" here is message id\n\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\n\t\t// \"content\" here is a sentence from the assistant,\n\t\t// there will be many sentences for the same \"id\"\n\n\t\tif (currentMessageId === id) {\n\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\n\n\t\t\ttry {\n\t\t\t\tif (messages[id] === undefined) {\n\t\t\t\t\tmessages[id] = [content];\n\t\t\t\t} else {\n\t\t\t\t\tmessages[id].push(content);\n\t\t\t\t}\n\n\t\t\t\tconsole.log(content);\n\n\t\t\t\tfetchAudio(content);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst chatFinishHandler = async (e) => {\n\t\tconst { id, content } = e.detail;\n\t\t// \"content\" here is the entire message from the assistant\n\t\tfinishedMessages[id] = true;\n\n\t\tchatStreaming = false;\n\t};\n\n\tonMount(async () => {\n\t\tconst setWakeLock = async () => {\n\t\t\ttry {\n\t\t\t\twakeLock = await navigator.wakeLock.request('screen');\n\t\t\t} catch (err) {\n\t\t\t\t// The Wake Lock request has failed - usually system related, such as battery.\n\t\t\t\tconsole.log(err);\n\t\t\t}\n\n\t\t\tif (wakeLock) {\n\t\t\t\t// Add a listener to release the wake lock when the page is unloaded\n\t\t\t\twakeLock.addEventListener('release', () => {\n\t\t\t\t\t// the wake lock has been released\n\t\t\t\t\tconsole.log('Wake Lock released');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif ('wakeLock' in navigator) {\n\t\t\tawait setWakeLock();\n\n\t\t\tdocument.addEventListener('visibilitychange', async () => {\n\t\t\t\t// Re-request the wake lock if the document becomes visible\n\t\t\t\tif (wakeLock !== null && document.visibilityState === 'visible') {\n\t\t\t\t\tawait setWakeLock();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tmodel = $models.find((m) => m.id === modelId);\n\n\t\tstartRecording();\n\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\n\t\teventTarget.addEventListener('chat', chatEventHandler);\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\n\n\t\treturn async () => {\n\t\t\tawait stopAllAudio();\n\n\t\t\tstopAudioStream();\n\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\n\t\t\taudioAbortController.abort();\n\t\t\tawait tick();\n\n\t\t\tawait stopAllAudio();\n\n\t\t\tawait stopRecordingCallback(false);\n\t\t\tawait stopCamera();\n\t\t};\n\t});\n\n\tonDestroy(async () => {\n\t\tawait stopAllAudio();\n\t\tawait stopRecordingCallback(false);\n\t\tawait stopCamera();\n\n\t\tawait stopAudioStream();\n\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\t\taudioAbortController.abort();\n\n\t\tawait tick();\n\n\t\tawait stopAllAudio();\n\t});\n</script>\n\n{#if $showCallOverlay}\n\t<div class=\"max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\n\t\t{#if camera}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{#if emoji}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? '4.5'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? '4.25'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? '3.75'\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{emoji}\n\t\t\t\t\t</div>\n\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? ' size-[4.5rem]'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? ' size-16'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? 'size-14'\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all rounded-full {(model?.info?.meta\n\t\t\t\t\t\t\t?.profile_image_url ?? '/static/favicon.png') !== '/static/favicon.png'\n\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\n\t\t\t\t\t\t\t: 'bg-black dark:bg-white'}  bg-black dark:bg-white\"\n\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/favicon.png') !==\n\t\t\t\t\t\t'/static/favicon.png'\n\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t\t<!-- navbar -->\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\n\t\t\t{#if !camera}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? '13'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? '12'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? '11.5'\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? ' size-52'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? 'size-48'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? 'size-44'\n\t\t\t\t\t\t\t\t\t\t: 'size-40'}  transition-all rounded-full {(model?.info?.meta\n\t\t\t\t\t\t\t\t?.profile_image_url ?? '/static/favicon.png') !== '/static/favicon.png'\n\t\t\t\t\t\t\t\t? ' bg-cover bg-center bg-no-repeat'\n\t\t\t\t\t\t\t\t: 'bg-black dark:bg-white'} \"\n\t\t\t\t\t\t\tstyle={(model?.info?.meta?.profile_image_url ?? '/static/favicon.png') !==\n\t\t\t\t\t\t\t'/static/favicon.png'\n\t\t\t\t\t\t\t\t? `background-image: url('${model?.info?.meta?.profile_image_url}');`\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<div class=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\">\n\t\t\t\t\t<!-- svelte-ignore a11y-media-has-caption -->\n\t\t\t\t\t<video\n\t\t\t\t\t\tid=\"camera-feed\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t/>\n\n\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\n\n\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tstopCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\n\t\t\t<div>\n\t\t\t\t{#if camera}\n\t\t\t\t\t<VideoInputMenu\n\t\t\t\t\t\tdevices={videoInputDevices}\n\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\tconsole.log(e.detail);\n\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\n\t\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\t\tawait startVideoStream();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</VideoInputMenu>\n\t\t\t\t{:else}\n\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\n\t\t\t\t\t\t\t\tstartCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\n\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\n\t\t\t\t\t\t{:else if assistantSpeaking}\n\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Listening...')}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait stopAudioStream();\n\t\t\t\t\t\tawait stopVideoStream();\n\n\t\t\t\t\t\tconsole.log(audioStream);\n\t\t\t\t\t\tconsole.log(cameraStream);\n\n\t\t\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, getContext, createEventDispatcher } from 'svelte';\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport { artifactCode, chatId, settings, showArtifacts, showControls } from '$lib/stores';\n\timport { copyToClipboard, createMessagesList } from '$lib/utils';\n\n\timport XMark from '../icons/XMark.svelte';\n\timport ArrowsPointingOut from '../icons/ArrowsPointingOut.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport SvgPanZoom from '../common/SVGPanZoom.svelte';\n\timport ArrowLeft from '../icons/ArrowLeft.svelte';\n\timport Download from '../icons/Download.svelte';\n\n\texport let overlay = false;\n\texport let history;\n\tlet messages = [];\n\n\tlet contents: Array<{ type: string; content: string }> = [];\n\tlet selectedContentIdx = 0;\n\n\tlet copied = false;\n\tlet iframeElement: HTMLIFrameElement;\n\n\t$: if (history) {\n\t\tmessages = createMessagesList(history, history.currentId);\n\t\tgetContents();\n\t} else {\n\t\tmessages = [];\n\t\tgetContents();\n\t}\n\n\tconst getContents = () => {\n\t\tcontents = [];\n\t\tmessages.forEach((message) => {\n\t\t\tif (message?.role !== 'user' && message?.content) {\n\t\t\t\tconst codeBlockContents = message.content.match(/```[\\s\\S]*?```/g);\n\t\t\t\tlet codeBlocks = [];\n\n\t\t\t\tlet htmlContent = '';\n\t\t\t\tlet cssContent = '';\n\t\t\t\tlet jsContent = '';\n\n\t\t\t\tif (codeBlockContents) {\n\t\t\t\t\tcodeBlockContents.forEach((block) => {\n\t\t\t\t\t\tconst lang = block.split('\\n')[0].replace('```', '').trim().toLowerCase();\n\t\t\t\t\t\tconst code = block.replace(/```[\\s\\S]*?\\n/, '').replace(/```$/, '');\n\t\t\t\t\t\tcodeBlocks.push({ lang, code });\n\t\t\t\t\t});\n\n\t\t\t\t\tcodeBlocks.forEach((block) => {\n\t\t\t\t\t\tconst { lang, code } = block;\n\n\t\t\t\t\t\tif (lang === 'html') {\n\t\t\t\t\t\t\thtmlContent += code + '\\n';\n\t\t\t\t\t\t} else if (lang === 'css') {\n\t\t\t\t\t\t\tcssContent += code + '\\n';\n\t\t\t\t\t\t} else if (lang === 'javascript' || lang === 'js') {\n\t\t\t\t\t\t\tjsContent += code + '\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst inlineHtml = message.content.match(/<html>[\\s\\S]*?<\\/html>/gi);\n\t\t\t\t\tconst inlineCss = message.content.match(/<style>[\\s\\S]*?<\\/style>/gi);\n\t\t\t\t\tconst inlineJs = message.content.match(/<script>[\\s\\S]*?<\\/script>/gi);\n\n\t\t\t\t\tif (inlineHtml) {\n\t\t\t\t\t\tinlineHtml.forEach((block) => {\n\t\t\t\t\t\t\tconst content = block.replace(/<\\/?html>/gi, ''); // Remove <html> tags\n\t\t\t\t\t\t\thtmlContent += content + '\\n';\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (inlineCss) {\n\t\t\t\t\t\tinlineCss.forEach((block) => {\n\t\t\t\t\t\t\tconst content = block.replace(/<\\/?style>/gi, ''); // Remove <style> tags\n\t\t\t\t\t\t\tcssContent += content + '\\n';\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (inlineJs) {\n\t\t\t\t\t\tinlineJs.forEach((block) => {\n\t\t\t\t\t\t\tconst content = block.replace(/<\\/?script>/gi, ''); // Remove <script> tags\n\t\t\t\t\t\t\tjsContent += content + '\\n';\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (htmlContent || cssContent || jsContent) {\n\t\t\t\t\tconst renderedContent = `\n                        <!DOCTYPE html>\n                        <html lang=\"en\">\n                        <head>\n                            <meta charset=\"UTF-8\">\n                            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t\t\t\t\t\t\t<${''}style>\n\t\t\t\t\t\t\t\tbody {\n\t\t\t\t\t\t\t\t\tbackground-color: white; /* Ensure the iframe has a white background */\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t${cssContent}\n\t\t\t\t\t\t\t</${''}style>\n                        </head>\n                        <body>\n                            ${htmlContent}\n\n\t\t\t\t\t\t\t<${''}script>\n                            \t${jsContent}\n\t\t\t\t\t\t\t</${''}script>\n                        </body>\n                        </html>\n                    `;\n\t\t\t\t\tcontents = [...contents, { type: 'iframe', content: renderedContent }];\n\t\t\t\t} else {\n\t\t\t\t\t// Check for SVG content\n\t\t\t\t\tfor (const block of codeBlocks) {\n\t\t\t\t\t\tif (block.lang === 'svg' || (block.lang === 'xml' && block.code.includes('<svg'))) {\n\t\t\t\t\t\t\tcontents = [...contents, { type: 'svg', content: block.code }];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (contents.length === 0) {\n\t\t\tshowControls.set(false);\n\t\t\tshowArtifacts.set(false);\n\t\t}\n\n\t\tselectedContentIdx = contents ? contents.length - 1 : 0;\n\t};\n\n\tfunction navigateContent(direction: 'prev' | 'next') {\n\t\tconsole.log(selectedContentIdx);\n\n\t\tselectedContentIdx =\n\t\t\tdirection === 'prev'\n\t\t\t\t? Math.max(selectedContentIdx - 1, 0)\n\t\t\t\t: Math.min(selectedContentIdx + 1, contents.length - 1);\n\n\t\tconsole.log(selectedContentIdx);\n\t}\n\n\tconst iframeLoadHandler = () => {\n\t\tiframeElement.contentWindow.addEventListener(\n\t\t\t'click',\n\t\t\tfunction (e) {\n\t\t\t\tconst target = e.target.closest('a');\n\t\t\t\tif (target && target.href) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconst url = new URL(target.href, iframeElement.baseURI);\n\t\t\t\t\tif (url.origin === window.location.origin) {\n\t\t\t\t\t\tiframeElement.contentWindow.history.pushState(\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\turl.pathname + url.search + url.hash\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.info('External navigation blocked:', url.href);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// Cancel drag when hovering over iframe\n\t\tiframeElement.contentWindow.addEventListener('mouseenter', function (e) {\n\t\t\te.preventDefault();\n\t\t\tiframeElement.contentWindow.addEventListener('dragstart', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t});\n\t};\n\n\tconst showFullScreen = () => {\n\t\tif (iframeElement.requestFullscreen) {\n\t\t\tiframeElement.requestFullscreen();\n\t\t} else if (iframeElement.webkitRequestFullscreen) {\n\t\t\tiframeElement.webkitRequestFullscreen();\n\t\t} else if (iframeElement.msRequestFullscreen) {\n\t\t\tiframeElement.msRequestFullscreen();\n\t\t}\n\t};\n\n\tconst downloadArtifact = () => {\n\t\tconst blob = new Blob([contents[selectedContentIdx].content], { type: 'text/html' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `artifact-${$chatId}-${selectedContentIdx}.html`;\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tdocument.body.removeChild(a);\n\t\tURL.revokeObjectURL(url);\n\t};\n\n\tonMount(() => {\n\t\tartifactCode.subscribe((value) => {\n\t\t\tif (contents) {\n\t\t\t\tconst codeIdx = contents.findIndex((content) => content.content.includes(value));\n\t\t\t\tselectedContentIdx = codeIdx !== -1 ? codeIdx : 0;\n\t\t\t}\n\t\t});\n\t});\n</script>\n\n<div\n\tclass=\" w-full h-full relative flex flex-col bg-white dark:bg-gray-850\"\n\tid=\"artifacts-container\"\n>\n\t<div class=\"w-full h-full flex flex-col flex-1 relative\">\n\t\t{#if contents.length > 0}\n\t\t\t<div\n\t\t\t\tclass=\"pointer-events-auto z-20 flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white\"\n\t\t\t>\n\t\t\t\t<div class=\"flex-1 flex items-center justify-between pr-1\">\n\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t<div class=\"flex items-center gap-0.5 self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\ton:click={() => navigateContent('prev')}\n\t\t\t\t\t\t\t\tdisabled={contents.length <= 1}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<div class=\"text-xs self-center dark:text-gray-100 min-w-fit\">\n\t\t\t\t\t\t\t\t{$i18n.t('Version {{selectedVersion}} of {{totalVersions}}', {\n\t\t\t\t\t\t\t\t\tselectedVersion: selectedContentIdx + 1,\n\t\t\t\t\t\t\t\t\ttotalVersions: contents.length\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\ton:click={() => navigateContent('next')}\n\t\t\t\t\t\t\t\tdisabled={contents.length <= 1}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tcopyToClipboard(contents[selectedContentIdx].content);\n\t\t\t\t\t\t\t\tcopied = true;\n\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tcopied = false;\n\t\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t\t}}>{copied ? $i18n.t('Copied') : $i18n.t('Copy')}</button\n\t\t\t\t\t\t>\n\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Download')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5\"\n\t\t\t\t\t\t\t\ton:click={downloadArtifact}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Download className=\"size-3.5\" />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{#if contents[selectedContentIdx].type === 'iframe'}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Open in full screen')}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5\"\n\t\t\t\t\t\t\t\t\ton:click={showFullScreen}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ArrowsPointingOut className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<button\n\t\t\t\t\tclass=\"self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\tshowArtifacts.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<XMark className=\"size-3.5 text-gray-900 dark:text-white\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if overlay}\n\t\t\t<div class=\" absolute top-0 left-0 right-0 bottom-0 z-10\"></div>\n\t\t{/if}\n\n\t\t<div class=\"flex-1 w-full h-full\">\n\t\t\t<div class=\" h-full flex flex-col\">\n\t\t\t\t{#if contents.length > 0}\n\t\t\t\t\t<div class=\"max-w-full w-full h-full\">\n\t\t\t\t\t\t{#if contents[selectedContentIdx].type === 'iframe'}\n\t\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\t\tbind:this={iframeElement}\n\t\t\t\t\t\t\t\ttitle=\"Content\"\n\t\t\t\t\t\t\t\tsrcdoc={contents[selectedContentIdx].content}\n\t\t\t\t\t\t\t\tclass=\"w-full border-0 h-full rounded-none\"\n\t\t\t\t\t\t\t\tsandbox=\"allow-scripts allow-downloads{($settings?.iframeSandboxAllowForms ?? false)\n\t\t\t\t\t\t\t\t\t? ' allow-forms'\n\t\t\t\t\t\t\t\t\t: ''}{($settings?.iframeSandboxAllowSameOrigin ?? false)\n\t\t\t\t\t\t\t\t\t? ' allow-same-origin'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:load={iframeLoadHandler}\n\t\t\t\t\t\t\t></iframe>\n\t\t\t\t\t\t{:else if contents[selectedContentIdx].type === 'svg'}\n\t\t\t\t\t\t\t<SvgPanZoom\n\t\t\t\t\t\t\t\tclassName=\" w-full h-full max-h-full overflow-hidden\"\n\t\t\t\t\t\t\t\tsvg={contents[selectedContentIdx].content}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"m-auto font-medium text-xs text-gray-900 dark:text-white\">\n\t\t\t\t\t\t{$i18n.t('No HTML, CSS, or JavaScript content found.')}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n","<script>\n\timport { embed, showControls, showEmbeds } from '$lib/stores';\n\n\timport FullHeightIframe from '$lib/components/common/FullHeightIframe.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\texport let overlay = false;\n</script>\n\n{#if $embed}\n\t<div class=\"h-full w-full\">\n\t\t<div\n\t\t\tclass=\"pointer-events-auto z-20 flex justify-between items-center py-3 px-2 font-primar text-gray-900 dark:text-white\"\n\t\t>\n\t\t\t<div class=\"flex-1 flex items-center justify-between pl-2\">\n\t\t\t\t<a\n\t\t\t\t\tclass=\"flex items-center space-x-2 hover:underline\"\n\t\t\t\t\thref={$embed?.url}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t>\n\t\t\t\t\t{$embed?.title ?? 'Embedded Content'}\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<button\n\t\t\t\tclass=\"self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\tshowEmbeds.set(false);\n\t\t\t\t\tembed.set(null);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className=\"size-3.5 text-gray-900 dark:text-white\" />\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\" w-full h-full relative\">\n\t\t\t{#if overlay}\n\t\t\t\t<div class=\" absolute top-0 left-0 right-0 bottom-0 z-10\"></div>\n\t\t\t{/if}\n\n\t\t\t<FullHeightIframe src={$embed?.url} iframeClassName=\"w-full h-full\" />\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { SvelteFlowProvider } from '@xyflow/svelte';\n\timport { slide } from 'svelte/transition';\n\timport { Pane, PaneResizer } from 'paneforge';\n\n\timport { onDestroy, onMount, tick } from 'svelte';\n\timport {\n\t\tmobile,\n\t\tshowControls,\n\t\tshowCallOverlay,\n\t\tshowOverview,\n\t\tshowArtifacts,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\n\timport Controls from './Controls/Controls.svelte';\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\n\timport Drawer from '../common/Drawer.svelte';\n\timport Artifacts from './Artifacts.svelte';\n\timport Embeds from './ChatControls/Embeds.svelte';\n\n\texport let history;\n\texport let models = [];\n\n\texport let chatId = null;\n\n\texport let chatFiles = [];\n\texport let params = {};\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let showMessage: Function;\n\texport let generateUserTurn: Function;\n\texport let files;\n\texport let modelId;\n\n\texport let pane;\n\n\tlet mediaQuery;\n\tlet largeScreen = false;\n\tlet dragged = false;\n\n\tlet minSize = 0;\n\n\texport const openPane = () => {\n\t\tif (parseInt(localStorage?.chatControlsSize)) {\n\t\t\tconst container = document.getElementById('chat-container');\n\t\t\tlet size = Math.floor(\n\t\t\t\t(parseInt(localStorage?.chatControlsSize) / container.clientWidth) * 100\n\t\t\t);\n\t\t\tpane.resize(size);\n\t\t} else {\n\t\t\tpane.resize(minSize);\n\t\t}\n\t};\n\n\tconst handleMediaQuery = async (e) => {\n\t\tif (e.matches) {\n\t\t\tlargeScreen = true;\n\n\t\t\tif ($showCallOverlay) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tawait tick();\n\t\t\t\tshowCallOverlay.set(true);\n\t\t\t}\n\t\t} else {\n\t\t\tlargeScreen = false;\n\n\t\t\tif ($showCallOverlay) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tawait tick();\n\t\t\t\tshowCallOverlay.set(true);\n\t\t\t}\n\t\t\tpane = null;\n\t\t}\n\t};\n\n\tconst onMouseDown = (event) => {\n\t\tdragged = true;\n\t};\n\n\tconst onMouseUp = (event) => {\n\t\tdragged = false;\n\t};\n\n\tonMount(() => {\n\t\t// listen to resize 1024px\n\t\tmediaQuery = window.matchMedia('(min-width: 1024px)');\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\t\thandleMediaQuery(mediaQuery);\n\n\t\t// Select the container element you want to observe\n\t\tconst container = document.getElementById('chat-container');\n\n\t\t// initialize the minSize based on the container width\n\t\tminSize = Math.floor((350 / container.clientWidth) * 100);\n\n\t\t// Create a new ResizeObserver instance\n\t\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (let entry of entries) {\n\t\t\t\tconst width = entry.contentRect.width;\n\t\t\t\t// calculate the percentage of 350px\n\t\t\t\tconst percentage = (350 / width) * 100;\n\t\t\t\t// set the minSize to the percentage, must be an integer\n\t\t\t\tminSize = Math.floor(percentage);\n\n\t\t\t\tif ($showControls) {\n\t\t\t\t\tif (pane && pane.isExpanded() && pane.getSize() < minSize) {\n\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet size = Math.floor(\n\t\t\t\t\t\t\t(parseInt(localStorage?.chatControlsSize) / container.clientWidth) * 100\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (size < minSize) {\n\t\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Start observing the container's size changes\n\t\tresizeObserver.observe(container);\n\n\t\tdocument.addEventListener('mousedown', onMouseDown);\n\t\tdocument.addEventListener('mouseup', onMouseUp);\n\t});\n\n\tonDestroy(() => {\n\t\tshowControls.set(false);\n\n\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\n\t\tdocument.removeEventListener('mousedown', onMouseDown);\n\t\tdocument.removeEventListener('mouseup', onMouseUp);\n\t});\n\n\tconst closeHandler = () => {\n\t\tshowControls.set(false);\n\t\tshowOverview.set(false);\n\t\tshowArtifacts.set(false);\n\t\tshowEmbeds.set(false);\n\n\t\tif ($showCallOverlay) {\n\t\t\tshowCallOverlay.set(false);\n\t\t}\n\t};\n\n\t$: if (!chatId) {\n\t\tcloseHandler();\n\t}\n</script>\n\n{#if !largeScreen}\n\t{#if $showControls}\n\t\t<Drawer\n\t\t\tshow={$showControls}\n\t\t\tonClose={() => {\n\t\t\t\tshowControls.set(false);\n\t\t\t}}\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\" {$showCallOverlay || $showOverview || $showArtifacts || $showEmbeds\n\t\t\t\t\t? ' h-screen  w-full'\n\t\t\t\t\t: 'px-4 py-3'} h-full\"\n\t\t\t>\n\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t{:else if $showEmbeds}\n\t\t\t\t\t<Embeds />\n\t\t\t\t{:else if $showArtifacts}\n\t\t\t\t\t<Artifacts {history} />\n\t\t\t\t{:else if $showOverview}\n\t\t\t\t\t{#await import('./Overview.svelte') then { default: Overview }}\n\t\t\t\t\t\t<Overview\n\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\tonNodeClick={(e) => {\n\t\t\t\t\t\t\t\tconst node = e.node;\n\t\t\t\t\t\t\t\tshowMessage(node.data.message, true);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/await}\n\t\t\t\t{:else}\n\t\t\t\t\t<Controls\n\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:generateUserTurn={generateUserTurn}\n\t\t\t\t\t\t{models}\n\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\tbind:params\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</Drawer>\n\t{/if}\n{:else}\n\t<!-- if $showControls -->\n\n\t{#if $showControls}\n\t\t<PaneResizer\n\t\t\tclass=\"relative flex items-center justify-center group border-l border-gray-50 dark:border-gray-850 hover:border-gray-200 dark:hover:border-gray-800  transition z-20\"\n\t\t\tid=\"controls-resizer\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\" absolute -left-1.5 -right-1.5 -top-0 -bottom-0 z-20 cursor-col-resize bg-transparent\"\n\t\t\t/>\n\t\t</PaneResizer>\n\t{/if}\n\n\t<Pane\n\t\tbind:pane\n\t\tdefaultSize={0}\n\t\tonResize={(size) => {\n\t\t\tif ($showControls && pane.isExpanded()) {\n\t\t\t\tif (size < minSize) {\n\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t}\n\n\t\t\t\tif (size < minSize) {\n\t\t\t\t\tlocalStorage.chatControlsSize = 0;\n\t\t\t\t} else {\n\t\t\t\t\t// save the size in  pixels to localStorage\n\t\t\t\t\tconst container = document.getElementById('chat-container');\n\t\t\t\t\tlocalStorage.chatControlsSize = Math.floor((size / 100) * container.clientWidth);\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\tonCollapse={() => {\n\t\t\tshowControls.set(false);\n\t\t}}\n\t\tcollapsible={true}\n\t\tclass=\" z-10 bg-white dark:bg-gray-850\"\n\t>\n\t\t{#if $showControls}\n\t\t\t<div class=\"flex max-h-full min-h-full\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full {($showOverview || $showArtifacts || $showEmbeds) && !$showCallOverlay\n\t\t\t\t\t\t? ' '\n\t\t\t\t\t\t: 'px-4 py-3 bg-white dark:shadow-lg dark:bg-gray-850 '} z-40 pointer-events-auto overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\tid=\"controls-container\"\n\t\t\t\t>\n\t\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t\t<div class=\"w-full h-full flex justify-center\">\n\t\t\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if $showEmbeds}\n\t\t\t\t\t\t<Embeds overlay={dragged} />\n\t\t\t\t\t{:else if $showArtifacts}\n\t\t\t\t\t\t<Artifacts {history} overlay={dragged} />\n\t\t\t\t\t{:else if $showOverview}\n\t\t\t\t\t\t{#await import('./Overview.svelte') then { default: Overview }}\n\t\t\t\t\t\t\t<Overview\n\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\tonNodeClick={(e) => {\n\t\t\t\t\t\t\t\t\tconst node = e.node;\n\t\t\t\t\t\t\t\t\tif (node?.data?.message?.favorite) {\n\t\t\t\t\t\t\t\t\t\thistory.messages[node.data.message.id].favorite = true;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\thistory.messages[node.data.message.id].favorite = null;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tshowMessage(node.data.message, true);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/await}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Controls\n\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:generateUserTurn={generateUserTurn}\n\t\t\t\t\t\t\t{models}\n\t\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\t\tbind:params\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</Pane>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport dayjs from 'dayjs';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\timport { getTimeRange } from '$lib/utils';\n\timport ChevronUp from '$lib/components/icons/ChevronUp.svelte';\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\n\tdayjs.extend(localizedFormat);\n\n\texport let chats = [];\n\n\tlet chatList = null;\n\n\tconst init = async () => {\n\t\tif (chats.length === 0) {\n\t\t\tchatList = [];\n\t\t} else {\n\t\t\tchatList = chats.map((chat) => ({\n\t\t\t\t...chat,\n\t\t\t\ttime_range: getTimeRange(chat.updated_at)\n\t\t\t}));\n\n\t\t\tchatList.sort((a, b) => {\n\t\t\t\tif (direction === 'asc') {\n\t\t\t\t\treturn a[orderBy] > b[orderBy] ? 1 : -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn a[orderBy] < b[orderBy] ? 1 : -1;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\tconst setSortKey = (key) => {\n\t\tif (orderBy === key) {\n\t\t\tdirection = direction === 'asc' ? 'desc' : 'asc';\n\t\t} else {\n\t\t\torderBy = key;\n\t\t\tdirection = 'asc';\n\t\t}\n\n\t\tinit();\n\t};\n\n\tlet orderBy = 'updated_at';\n\tlet direction = 'desc'; // 'asc' or 'desc'\n\n\t$: if (chats) {\n\t\tinit();\n\t}\n</script>\n\n{#if chatList}\n\t{#if chatList.length > 0}\n\t\t<div class=\"flex text-xs font-medium mb-1 items-center -mr-0.5\">\n\t\t\t<button\n\t\t\t\tclass=\"px-1.5 py-1 cursor-pointer select-none basis-3/5\"\n\t\t\t\ton:click={() => setSortKey('title')}\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-1.5 items-center\">\n\t\t\t\t\t{$i18n.t('Title')}\n\n\t\t\t\t\t{#if orderBy === 'title'}\n\t\t\t\t\t\t<span class=\"font-normal\"\n\t\t\t\t\t\t\t>{#if direction === 'asc'}\n\t\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-2\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"invisible\">\n\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tclass=\"px-1.5 py-1 cursor-pointer select-none hidden sm:flex sm:basis-2/5 justify-end\"\n\t\t\t\ton:click={() => setSortKey('updated_at')}\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-1.5 items-center\">\n\t\t\t\t\t{$i18n.t('Updated at')}\n\n\t\t\t\t\t{#if orderBy === 'updated_at'}\n\t\t\t\t\t\t<span class=\"font-normal\"\n\t\t\t\t\t\t\t>{#if direction === 'asc'}\n\t\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-2\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"invisible\">\n\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"text-left text-sm w-full mb-3\">\n\t\t{#if chatList.length === 0}\n\t\t\t<div\n\t\t\t\tclass=\"text-xs text-gray-500 dark:text-gray-400 text-center px-5 min-h-20 w-full h-full flex justify-center items-center\"\n\t\t\t>\n\t\t\t\t{$i18n.t('No chats found')}\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#each chatList as chat, idx (chat.id)}\n\t\t\t{#if (idx === 0 || (idx > 0 && chat.time_range !== chatList[idx - 1].time_range)) && chat?.time_range}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full text-xs text-gray-500 dark:text-gray-500 font-medium {idx === 0\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: 'pt-5'} pb-2 px-2\"\n\t\t\t\t>\n\t\t\t\t\t{$i18n.t(chat.time_range)}\n\t\t\t\t\t<!-- localisation keys for time_range to be recognized from the i18next parser (so they don't get automatically removed):\n\t\t\t\t\t\t\t{$i18n.t('Today')}\n\t\t\t\t\t\t\t{$i18n.t('Yesterday')}\n\t\t\t\t\t\t\t{$i18n.t('Previous 7 days')}\n\t\t\t\t\t\t\t{$i18n.t('Previous 30 days')}\n\t\t\t\t\t\t\t{$i18n.t('January')}\n\t\t\t\t\t\t\t{$i18n.t('February')}\n\t\t\t\t\t\t\t{$i18n.t('March')}\n\t\t\t\t\t\t\t{$i18n.t('April')}\n\t\t\t\t\t\t\t{$i18n.t('May')}\n\t\t\t\t\t\t\t{$i18n.t('June')}\n\t\t\t\t\t\t\t{$i18n.t('July')}\n\t\t\t\t\t\t\t{$i18n.t('August')}\n\t\t\t\t\t\t\t{$i18n.t('September')}\n\t\t\t\t\t\t\t{$i18n.t('October')}\n\t\t\t\t\t\t\t{$i18n.t('November')}\n\t\t\t\t\t\t\t{$i18n.t('December')}\n\t\t\t\t\t\t\t-->\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<a\n\t\t\t\tclass=\" w-full flex justify-between items-center rounded-lg text-sm py-2 px-3 hover:bg-gray-50 dark:hover:bg-gray-850\"\n\t\t\t\tdraggable=\"false\"\n\t\t\t\thref={`/c/${chat.id}`}\n\t\t\t\ton:click={() => (show = false)}\n\t\t\t>\n\t\t\t\t<div class=\"text-ellipsis line-clamp-1 w-full sm:basis-3/5\">\n\t\t\t\t\t{chat?.title}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"hidden sm:flex sm:basis-2/5 items-center justify-end\">\n\t\t\t\t\t<div class=\" text-gray-500 dark:text-gray-400 text-xs\">\n\t\t\t\t\t\t{dayjs(chat?.updated_at * 1000).calendar()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t{/each}\n\n\t\t<!-- {#if !allChatsLoaded && loadHandler}\n\t\t<Loader\n\t\t\ton:visible={(e) => {\n\t\t\t\tif (!chatListLoading) {\n\t\t\t\t\tloadHandler();\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t<div class=\"w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t<div class=\" \">Loading...</div>\n\t\t\t</div>\n\t\t</Loader>\n\t{/if} -->\n\t</div>\n{/if}\n","<script>\n\timport { getContext, onMount } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport { fade } from 'svelte/transition';\n\n\timport ChatList from './ChatList.svelte';\n\timport FolderKnowledge from './FolderKnowledge.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport { getChatListByFolderId } from '$lib/apis/chats';\n\n\texport let folder = null;\n\n\tlet selectedTab = 'chats';\n\n\tlet chats = null;\n\tlet page = 1;\n\n\tconst setChatList = async () => {\n\t\tchats = null;\n\n\t\tif (folder && folder.id) {\n\t\t\tconst res = await getChatListByFolderId(localStorage.token, folder.id, page);\n\n\t\t\tif (res) {\n\t\t\t\tchats = res;\n\t\t\t} else {\n\t\t\t\tchats = [];\n\t\t\t}\n\t\t} else {\n\t\t\tchats = [];\n\t\t}\n\t};\n\n\t$: if (folder) {\n\t\tsetChatList();\n\t}\n</script>\n\n<div>\n\t<!-- <div class=\"mb-1\">\n\t\t<div\n\t\t\tclass=\"flex gap-1 scrollbar-none overflow-x-auto w-fit text-center text-sm font-medium rounded-full bg-transparent py-1 touch-auto pointer-events-auto\"\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"min-w-fit p-1.5 {selectedTab === 'knowledge'\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white'} transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tselectedTab = 'knowledge';\n\t\t\t\t}}>{$i18n.t('Knowledge')}</button\n\t\t\t>\n\n\t\t\t<button\n\t\t\t\tclass=\"min-w-fit p-1.5 {selectedTab === 'chats'\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white'} transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tselectedTab = 'chats';\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{$i18n.t('Chats')}\n\t\t\t</button>\n\t\t</div>\n\t</div> -->\n\n\t<div class=\"\">\n\t\t{#if selectedTab === 'knowledge'}\n\t\t\t<FolderKnowledge />\n\t\t{:else if selectedTab === 'chats'}\n\t\t\t{#if chats !== null}\n\t\t\t\t<ChatList {chats} />\n\t\t\t{:else}\n\t\t\t\t<div class=\"py-10\">\n\t\t\t\t\t<Spinner />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport DOMPurify from 'dompurify';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { toast } from 'svelte-sonner';\n\n\timport { selectedFolder } from '$lib/stores';\n\n\timport { deleteFolderById, getFolderById, updateFolderById } from '$lib/apis/folders';\n\timport { getChatsByFolderId } from '$lib/apis/chats';\n\n\timport FolderModal from '$lib/components/layout/Sidebar/Folders/FolderModal.svelte';\n\n\timport Folder from '$lib/components/icons/Folder.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport FolderMenu from '$lib/components/layout/Sidebar/Folders/FolderMenu.svelte';\n\timport EllipsisHorizontal from '$lib/components/icons/EllipsisHorizontal.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\timport Emoji from '$lib/components/common/Emoji.svelte';\n\timport EmojiPicker from '$lib/components/common/EmojiPicker.svelte';\n\n\texport let folder = null;\n\n\texport let onUpdate: Function = (folderId) => {};\n\texport let onDelete: Function = (folderId) => {};\n\n\tlet showFolderModal = false;\n\tlet showDeleteConfirm = false;\n\n\tconst updateHandler = async ({ name, meta, data }) => {\n\t\tif (name === '') {\n\t\t\ttoast.error($i18n.t('Folder name cannot be empty.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentName = folder.name;\n\n\t\tname = name.trim();\n\t\tfolder.name = name;\n\n\t\tconst res = await updateFolderById(localStorage.token, folder.id, {\n\t\t\tname,\n\t\t\t...(meta ? { meta } : {}),\n\t\t\t...(data ? { data } : {})\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\n\t\t\tfolder.name = currentName;\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfolder.name = name;\n\t\t\tif (data) {\n\t\t\t\tfolder.data = data;\n\t\t\t}\n\n\t\t\ttoast.success($i18n.t('Folder updated successfully'));\n\n\t\t\tconst _folder = await getFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tawait selectedFolder.set(_folder);\n\t\t\tonUpdate(_folder);\n\t\t}\n\t};\n\n\tconst updateIconHandler = async (iconName) => {\n\t\tconst res = await updateFolderById(localStorage.token, folder.id, {\n\t\t\tmeta: {\n\t\t\t\ticon: iconName\n\t\t\t}\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfolder.meta = { ...folder.meta, icon: iconName };\n\n\t\t\ttoast.success($i18n.t('Folder updated successfully'));\n\n\t\t\tconst _folder = await getFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tawait selectedFolder.set(_folder);\n\t\t\tonUpdate(_folder);\n\t\t}\n\t};\n\n\tconst deleteHandler = async () => {\n\t\tconst res = await deleteFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Folder deleted successfully'));\n\t\t\tonDelete(folder);\n\t\t}\n\t};\n\n\tconst exportHandler = async () => {\n\t\tconst chats = await getChatsByFolderId(localStorage.token, folder.id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\t\tif (!chats) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst blob = new Blob([JSON.stringify(chats)], {\n\t\t\ttype: 'application/json'\n\t\t});\n\n\t\tsaveAs(blob, `folder-${folder.name}-export-${Date.now()}.json`);\n\t};\n</script>\n\n{#if folder}\n\t<FolderModal\n\t\tbind:show={showFolderModal}\n\t\tedit={true}\n\t\tfolderId={folder.id}\n\t\tonSubmit={updateHandler}\n\t/>\n\n\t<DeleteConfirmDialog\n\t\tbind:show={showDeleteConfirm}\n\t\ttitle={$i18n.t('Delete folder?')}\n\t\ton:confirm={() => {\n\t\t\tdeleteHandler();\n\t\t}}\n\t>\n\t\t<div class=\" text-sm text-gray-700 dark:text-gray-300 flex-1 line-clamp-3\">\n\t\t\t{@html DOMPurify.sanitize(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t'This will delete <strong>{{NAME}}</strong> and <strong>all its contents</strong>.',\n\t\t\t\t\t{\n\t\t\t\t\t\tNAME: folder.name\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t)}\n\t\t</div>\n\t</DeleteConfirmDialog>\n\n\t<div class=\"mb-3 px-6 @md:max-w-3xl justify-between w-full flex relative group items-center\">\n\t\t<div class=\"text-center flex gap-3.5 items-center\">\n\t\t\t<EmojiPicker\n\t\t\t\tonClose={() => {}}\n\t\t\t\tonSubmit={(name) => {\n\t\t\t\t\tconsole.log(name);\n\t\t\t\t\tupdateIconHandler(name);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" rounded-full bg-gray-50 dark:bg-gray-800 size-11 flex justify-center items-center\"\n\t\t\t\t>\n\t\t\t\t\t{#if folder?.meta?.icon}\n\t\t\t\t\t\t<Emoji className=\"size-6\" shortCode={folder.meta.icon} />\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Folder className=\"size-4.5\" strokeWidth=\"2\" />\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</EmojiPicker>\n\n\t\t\t<div class=\"text-3xl\">\n\t\t\t\t{folder.name}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex items-center translate-x-2.5\">\n\t\t\t<FolderMenu\n\t\t\t\talign=\"end\"\n\t\t\t\tonEdit={() => {\n\t\t\t\t\tshowFolderModal = true;\n\t\t\t\t}}\n\t\t\t\tonDelete={() => {\n\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t}}\n\t\t\t\tonExport={() => {\n\t\t\t\t\texportHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<button class=\"p-1.5 dark:hover:bg-gray-850 rounded-full touch-auto\" on:click={(e) => {}}>\n\t\t\t\t\t<EllipsisHorizontal className=\"size-4\" strokeWidth=\"2.5\" />\n\t\t\t\t</button>\n\t\t\t</FolderMenu>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { marked } from 'marked';\n\n\timport { onMount, getContext, tick, createEventDispatcher } from 'svelte';\n\timport { blur, fade } from 'svelte/transition';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { getChatList } from '$lib/apis/chats';\n\timport { updateFolderById } from '$lib/apis/folders';\n\n\timport {\n\t\tconfig,\n\t\tuser,\n\t\tmodels as _models,\n\t\ttemporaryChatEnabled,\n\t\tselectedFolder,\n\t\tchats,\n\t\tcurrentChatPage\n\t} from '$lib/stores';\n\timport { sanitizeResponseContent, extractCurlyBraceWords } from '$lib/utils';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Suggestions from './Suggestions.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport EyeSlash from '$lib/components/icons/EyeSlash.svelte';\n\timport MessageInput from './MessageInput.svelte';\n\timport FolderPlaceholder from './Placeholder/FolderPlaceholder.svelte';\n\timport FolderTitle from './Placeholder/FolderTitle.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let createMessagePair: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\n\texport let atSelectedModel: Model | undefined;\n\texport let selectedModels: [''];\n\n\texport let history;\n\n\texport let prompt = '';\n\texport let files = [];\n\texport let messageInput = null;\n\n\texport let selectedToolIds = [];\n\texport let selectedFilterIds = [];\n\n\texport let showCommands = false;\n\n\texport let imageGenerationEnabled = false;\n\texport let codeInterpreterEnabled = false;\n\texport let webSearchEnabled = false;\n\n\texport let onSelect = (e) => {};\n\texport let onChange = (e) => {};\n\n\texport let toolServers = [];\n\n\tlet models = [];\n\tlet selectedModelIdx = 0;\n\n\t$: if (selectedModels.length > 0) {\n\t\tselectedModelIdx = models.length - 1;\n\t}\n\n\t$: models = selectedModels.map((id) => $_models.find((m) => m.id === id));\n</script>\n\n<div class=\"m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center\">\n\t{#if $temporaryChatEnabled}\n\t\t<Tooltip\n\t\t\tcontent={$i18n.t(\"This chat won't appear in history and your messages will not be saved.\")}\n\t\t\tclassName=\"w-full flex justify-center mb-0.5\"\n\t\t\tplacement=\"top\"\n\t\t>\n\t\t\t<div class=\"flex items-center gap-2 text-gray-500 text-base my-2 w-fit\">\n\t\t\t\t<EyeSlash strokeWidth=\"2.5\" className=\"size-4\" />{$i18n.t('Temporary Chat')}\n\t\t\t</div>\n\t\t</Tooltip>\n\t{/if}\n\n\t<div\n\t\tclass=\"w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary\"\n\t>\n\t\t<div class=\"w-full flex flex-col justify-center items-center\">\n\t\t\t{#if $selectedFolder}\n\t\t\t\t<FolderTitle\n\t\t\t\t\tfolder={$selectedFolder}\n\t\t\t\t\tonUpdate={async (folder) => {\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\t\t}}\n\t\t\t\t\tonDelete={async () => {\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t\t\tcurrentChatPage.set(1);\n\n\t\t\t\t\t\tselectedFolder.set(null);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t{:else}\n\t\t\t\t<div class=\"flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5 max-w-xl\">\n\t\t\t\t\t<div class=\"flex shrink-0 justify-center\">\n\t\t\t\t\t\t<div class=\"flex -space-x-4 mb-0.5\" in:fade={{ duration: 100 }}>\n\t\t\t\t\t\t\t{#each models as model, modelIdx}\n\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\tcontent={(models[modelIdx]?.info?.meta?.tags ?? [])\n\t\t\t\t\t\t\t\t\t\t.map((tag) => tag.name.toUpperCase())\n\t\t\t\t\t\t\t\t\t\t.join(', ')}\n\t\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\taria-hidden={models.length <= 1}\n\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Get information on {{name}} in the UI', {\n\t\t\t\t\t\t\t\t\t\t\tname: models[modelIdx]?.name\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tselectedModelIdx = modelIdx;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\t\t\t\t\t\t\tsrc={model?.info?.meta?.profile_image_url ??\n\t\t\t\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\n\t\t\t\t\t\t\t\t\t\t\t\t\t? `${WEBUI_BASE_URL}/doge.png`\n\t\t\t\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/favicon.png`)}\n\t\t\t\t\t\t\t\t\t\t\tclass=\" size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" text-3xl @sm:text-3xl line-clamp-1 flex items-center\"\n\t\t\t\t\t\tin:fade={{ duration: 100 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tcontent={models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t\tclassName=\" flex items-center \"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Hello, {{name}}', { name: $user?.name })}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex mt-1 mb-2\">\n\t\t\t\t\t<div in:fade={{ duration: 100, delay: 50 }}>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.description ?? null}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tclassName=\" w-fit\"\n\t\t\t\t\t\t\t\tcontent={marked.parse(\n\t\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{@html marked.parse(\n\t\t\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user}\n\t\t\t\t\t\t\t\t<div class=\"mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\tBy\n\t\t\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user.community}\n\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\thref=\"https://openwebui.com/m/{models[selectedModelIdx]?.info?.meta?.user\n\t\t\t\t\t\t\t\t\t\t\t\t.username}\"\n\t\t\t\t\t\t\t\t\t\t\t>{models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t\t? models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t\t: `@${models[selectedModelIdx]?.info?.meta?.user.username}`}</a\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.info?.meta?.user.name}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"text-base font-normal @md:max-w-3xl w-full py-3 {atSelectedModel ? 'mt-2' : ''}\">\n\t\t\t\t<MessageInput\n\t\t\t\t\tbind:this={messageInput}\n\t\t\t\t\t{history}\n\t\t\t\t\t{selectedModels}\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:autoScroll\n\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\tbind:showCommands\n\t\t\t\t\t{toolServers}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{createMessagePair}\n\t\t\t\t\tplaceholder={$i18n.t('How can I help you today?')}\n\t\t\t\t\t{onChange}\n\t\t\t\t\ton:upload={(e) => {\n\t\t\t\t\t\tdispatch('upload', e.detail);\n\t\t\t\t\t}}\n\t\t\t\t\ton:submit={(e) => {\n\t\t\t\t\t\tdispatch('submit', e.detail);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if $selectedFolder}\n\t\t<div\n\t\t\tclass=\"mx-auto px-4 md:max-w-3xl md:px-6 font-primary min-h-62\"\n\t\t\tin:fade={{ duration: 200, delay: 200 }}\n\t\t>\n\t\t\t<FolderPlaceholder folder={$selectedFolder} />\n\t\t</div>\n\t{:else}\n\t\t<div class=\"mx-auto max-w-2xl font-primary mt-2\" in:fade={{ duration: 200, delay: 200 }}>\n\t\t\t<div class=\"mx-5\">\n\t\t\t\t<Suggestions\n\t\t\t\t\tsuggestionPrompts={atSelectedModel?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t\t$config?.default_prompt_suggestions ??\n\t\t\t\t\t\t[]}\n\t\t\t\t\tinputValue={prompt}\n\t\t\t\t\t{onSelect}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { toast } from 'svelte-sonner';\n\timport { PaneGroup, Pane, PaneResizer } from 'paneforge';\n\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\n\tconst i18n: Writable<i18nType> = getContext('i18n');\n\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport { get, type Unsubscriber, type Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\n\timport {\n\t\tchatId,\n\t\tchats,\n\t\tconfig,\n\t\ttype Model,\n\t\tmodels,\n\t\ttags as allTags,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tuser,\n\t\tsocket,\n\t\tshowControls,\n\t\tshowCallOverlay,\n\t\tcurrentChatPage,\n\t\ttemporaryChatEnabled,\n\t\tmobile,\n\t\tshowOverview,\n\t\tchatTitle,\n\t\tshowArtifacts,\n\t\ttools,\n\t\ttoolServers,\n\t\tfunctions,\n\t\tselectedFolder,\n\t\tpinnedChats,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\timport {\n\t\tconvertMessagesToHistory,\n\t\tcopyToClipboard,\n\t\tgetMessageContentParts,\n\t\tcreateMessagesList,\n\t\tgetPromptVariables,\n\t\tprocessDetails,\n\t\tremoveAllDetails\n\t} from '$lib/utils';\n\n\timport {\n\t\tcreateNewChat,\n\t\tgetAllTags,\n\t\tgetChatById,\n\t\tgetChatList,\n\t\tgetPinnedChatList,\n\t\tgetTagsById,\n\t\tupdateChatById,\n\t\tupdateChatFolderIdById\n\t} from '$lib/apis/chats';\n\timport { generateOpenAIChatCompletion, generateOpenAICompletion } from '$lib/apis/openai';\n\timport { processWeb, processWebSearch, processYoutubeVideo } from '$lib/apis/retrieval';\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\n\timport {\n\t\tchatCompleted,\n\t\tgenerateQueries,\n\t\tchatAction,\n\t\tgenerateMoACompletion,\n\t\tstopTask,\n\t\tgetTaskIdsByChatId\n\t} from '$lib/apis';\n\timport { getTools } from '$lib/apis/tools';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\n\timport { fade } from 'svelte/transition';\n\n\timport Banner from '../common/Banner.svelte';\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/chat/Navbar.svelte';\n\timport ChatControls from './ChatControls.svelte';\n\timport EventConfirmDialog from '../common/ConfirmDialog.svelte';\n\timport Placeholder from './Placeholder.svelte';\n\timport NotificationToast from '../NotificationToast.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Sidebar from '../icons/Sidebar.svelte';\n\timport { getFunctions } from '$lib/apis/functions';\n\timport Image from '../common/Image.svelte';\n\timport { updateFolderById } from '$lib/apis/folders';\n\n\texport let chatIdProp = '';\n\n\tlet loading = true;\n\n\tconst eventTarget = new EventTarget();\n\tlet controlPane;\n\tlet controlPaneComponent;\n\n\tlet messageInput;\n\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet navbarElement;\n\n\tlet showEventConfirmation = false;\n\tlet eventConfirmationTitle = '';\n\tlet eventConfirmationMessage = '';\n\tlet eventConfirmationInput = false;\n\tlet eventConfirmationInputPlaceholder = '';\n\tlet eventConfirmationInputValue = '';\n\tlet eventCallback = null;\n\n\tlet chatIdUnsubscriber: Unsubscriber | undefined;\n\n\tlet selectedModels = [''];\n\tlet atSelectedModel: Model | undefined;\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\tlet selectedToolIds = [];\n\tlet selectedFilterIds = [];\n\tlet imageGenerationEnabled = false;\n\tlet webSearchEnabled = false;\n\tlet codeInterpreterEnabled = false;\n\n\tlet showCommands = false;\n\n\tlet generating = false;\n\tlet generationController = null;\n\n\tlet chat = null;\n\tlet tags = [];\n\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\tlet taskIds = null;\n\n\t// Chat Input\n\tlet prompt = '';\n\tlet chatFiles = [];\n\tlet files = [];\n\tlet params = {};\n\n\t$: if (chatIdProp) {\n\t\tnavigateHandler();\n\t}\n\n\tconst navigateHandler = async () => {\n\t\tloading = true;\n\n\t\tprompt = '';\n\t\tmessageInput?.setText('');\n\n\t\tfiles = [];\n\t\tselectedToolIds = [];\n\t\tselectedFilterIds = [];\n\t\twebSearchEnabled = false;\n\t\timageGenerationEnabled = false;\n\n\t\tconst storageChatInput = sessionStorage.getItem(\n\t\t\t`chat-input${chatIdProp ? `-${chatIdProp}` : ''}`\n\t\t);\n\n\t\tif (chatIdProp && (await loadChat())) {\n\t\t\tawait tick();\n\t\t\tloading = false;\n\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\n\n\t\t\tawait tick();\n\n\t\t\tif (storageChatInput) {\n\t\t\t\ttry {\n\t\t\t\t\tconst input = JSON.parse(storageChatInput);\n\n\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\tmessageInput?.setText(input.prompt);\n\t\t\t\t\t\tfiles = input.files;\n\t\t\t\t\t\tselectedToolIds = input.selectedToolIds;\n\t\t\t\t\t\tselectedFilterIds = input.selectedFilterIds;\n\t\t\t\t\t\twebSearchEnabled = input.webSearchEnabled;\n\t\t\t\t\t\timageGenerationEnabled = input.imageGenerationEnabled;\n\t\t\t\t\t\tcodeInterpreterEnabled = input.codeInterpreterEnabled;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\tchatInput?.focus();\n\t\t} else {\n\t\t\tawait goto('/');\n\t\t}\n\t};\n\n\tconst onSelect = async (e) => {\n\t\tconst { type, data } = e;\n\n\t\tif (type === 'prompt') {\n\t\t\t// Handle prompt selection\n\t\t\tmessageInput?.setText(data, async () => {\n\t\t\t\tif (!($settings?.insertSuggestionPrompt ?? false)) {\n\t\t\t\t\tawait tick();\n\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t$: if (selectedModels && chatIdProp !== '') {\n\t\tsaveSessionSelectedModels();\n\t}\n\n\tconst saveSessionSelectedModels = () => {\n\t\tconst selectedModelsString = JSON.stringify(selectedModels);\n\t\tif (\n\t\t\tselectedModels.length === 0 ||\n\t\t\t(selectedModels.length === 1 && selectedModels[0] === '') ||\n\t\t\tsessionStorage.selectedModels === selectedModelsString\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tsessionStorage.selectedModels = selectedModelsString;\n\t\tconsole.log('saveSessionSelectedModels', selectedModels, sessionStorage.selectedModels);\n\t};\n\n\tlet oldSelectedModelIds = [''];\n\t$: if (JSON.stringify(selectedModelIds) !== JSON.stringify(oldSelectedModelIds)) {\n\t\tonSelectedModelIdsChange();\n\t}\n\n\tconst onSelectedModelIdsChange = () => {\n\t\tif (oldSelectedModelIds.filter((id) => id).length > 0) {\n\t\t\tresetInput();\n\t\t}\n\t\toldSelectedModelIds = selectedModelIds;\n\t};\n\n\tconst resetInput = () => {\n\t\tselectedToolIds = [];\n\t\tselectedFilterIds = [];\n\t\twebSearchEnabled = false;\n\t\timageGenerationEnabled = false;\n\t\tcodeInterpreterEnabled = false;\n\n\t\tsetDefaults();\n\t};\n\n\tconst setDefaults = async () => {\n\t\tif (!$tools) {\n\t\t\ttools.set(await getTools(localStorage.token));\n\t\t}\n\t\tif (!$functions) {\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t}\n\t\tif (selectedModels.length !== 1 && !atSelectedModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = atSelectedModel ?? $models.find((m) => m.id === selectedModels[0]);\n\t\tif (model) {\n\t\t\t// Set Default Tools\n\t\t\tif (model?.info?.meta?.toolIds) {\n\t\t\t\tselectedToolIds = [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...(model?.info?.meta?.toolIds ?? [])].filter((id) => $tools.find((t) => t.id === id))\n\t\t\t\t\t)\n\t\t\t\t];\n\t\t\t}\n\n\t\t\t// Set Default Filters (Toggleable only)\n\t\t\tif (model?.info?.meta?.defaultFilterIds) {\n\t\t\t\tselectedFilterIds = model.info.meta.defaultFilterIds.filter((id) =>\n\t\t\t\t\tmodel?.filters?.find((f) => f.id === id)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Set Default Features\n\t\t\tif (model?.info?.meta?.defaultFeatureIds) {\n\t\t\t\tif (model.info?.meta?.capabilities?.['image_generation']) {\n\t\t\t\t\timageGenerationEnabled = model.info.meta.defaultFeatureIds.includes('image_generation');\n\t\t\t\t}\n\n\t\t\t\tif (model.info?.meta?.capabilities?.['web_search']) {\n\t\t\t\t\twebSearchEnabled = model.info.meta.defaultFeatureIds.includes('web_search');\n\t\t\t\t}\n\n\t\t\t\tif (model.info?.meta?.capabilities?.['code_interpreter']) {\n\t\t\t\t\tcodeInterpreterEnabled = model.info.meta.defaultFeatureIds.includes('code_interpreter');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst showMessage = async (message, ignoreSettings = false) => {\n\t\tawait tick();\n\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\t\tlet _messageId = JSON.parse(JSON.stringify(message.id));\n\n\t\tlet messageChildrenIds = [];\n\t\tif (_messageId === null) {\n\t\t\tmessageChildrenIds = Object.keys(history.messages).filter(\n\t\t\t\t(id) => history.messages[id].parentId === null\n\t\t\t);\n\t\t} else {\n\t\t\tmessageChildrenIds = history.messages[_messageId].childrenIds;\n\t\t}\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t_messageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[_messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = _messageId;\n\n\t\tawait tick();\n\t\tawait tick();\n\t\tawait tick();\n\n\t\tif (($settings?.scrollOnBranchChange ?? true) || ignoreSettings) {\n\t\t\tconst messageElement = document.getElementById(`message-${message.id}`);\n\t\t\tif (messageElement) {\n\t\t\t\tmessageElement.scrollIntoView({ behavior: 'smooth' });\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\t\tsaveChatHandler(_chatId, history);\n\t};\n\n\tconst chatEventHandler = async (event, cb) => {\n\t\tconsole.log(event);\n\n\t\tif (event.chat_id === $chatId) {\n\t\t\tawait tick();\n\t\t\tlet message = history.messages[event.message_id];\n\n\t\t\tif (message) {\n\t\t\t\tconst type = event?.data?.type ?? null;\n\t\t\t\tconst data = event?.data?.data ?? null;\n\n\t\t\t\tif (type === 'status') {\n\t\t\t\t\tif (message?.statusHistory) {\n\t\t\t\t\t\tmessage.statusHistory.push(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessage.statusHistory = [data];\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:completion') {\n\t\t\t\t\tchatCompletionEventHandler(data, message, event.chat_id);\n\t\t\t\t} else if (type === 'chat:tasks:cancel') {\n\t\t\t\t\ttaskIds = null;\n\t\t\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\t\t\t// Set all response messages to done\n\t\t\t\t\tfor (const messageId of history.messages[responseMessage.parentId].childrenIds) {\n\t\t\t\t\t\thistory.messages[messageId].done = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:message:delta' || type === 'message') {\n\t\t\t\t\tmessage.content += data.content;\n\t\t\t\t} else if (type === 'chat:message' || type === 'replace') {\n\t\t\t\t\tmessage.content = data.content;\n\t\t\t\t} else if (type === 'chat:message:files' || type === 'files') {\n\t\t\t\t\tmessage.files = data.files;\n\t\t\t\t} else if (type === 'chat:message:embeds' || type === 'embeds') {\n\t\t\t\t\tmessage.embeds = data.embeds;\n\t\t\t\t} else if (type === 'chat:message:error') {\n\t\t\t\t\tmessage.error = data.error;\n\t\t\t\t} else if (type === 'chat:message:follow_ups') {\n\t\t\t\t\tmessage.followUps = data.follow_ups;\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom('smooth');\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:title') {\n\t\t\t\t\tchatTitle.set(data);\n\t\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t} else if (type === 'chat:tags') {\n\t\t\t\t\tchat = await getChatById(localStorage.token, $chatId);\n\t\t\t\t\tallTags.set(await getAllTags(localStorage.token));\n\t\t\t\t} else if (type === 'source' || type === 'citation') {\n\t\t\t\t\tif (data?.type === 'code_execution') {\n\t\t\t\t\t\t// Code execution; update existing code execution by ID, or add new one.\n\t\t\t\t\t\tif (!message?.code_executions) {\n\t\t\t\t\t\t\tmessage.code_executions = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst existingCodeExecutionIndex = message.code_executions.findIndex(\n\t\t\t\t\t\t\t(execution) => execution.id === data.id\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (existingCodeExecutionIndex !== -1) {\n\t\t\t\t\t\t\tmessage.code_executions[existingCodeExecutionIndex] = data;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessage.code_executions.push(data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.code_executions = message.code_executions;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Regular source.\n\t\t\t\t\t\tif (message?.sources) {\n\t\t\t\t\t\t\tmessage.sources.push(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessage.sources = [data];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'notification') {\n\t\t\t\t\tconst toastType = data?.type ?? 'info';\n\t\t\t\t\tconst toastContent = data?.content ?? '';\n\n\t\t\t\t\tif (toastType === 'success') {\n\t\t\t\t\t\ttoast.success(toastContent);\n\t\t\t\t\t} else if (toastType === 'error') {\n\t\t\t\t\t\ttoast.error(toastContent);\n\t\t\t\t\t} else if (toastType === 'warning') {\n\t\t\t\t\t\ttoast.warning(toastContent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.info(toastContent);\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'confirmation') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\teventConfirmationInput = false;\n\t\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\t} else if (type === 'execute') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Use Function constructor to evaluate code in a safer way\n\t\t\t\t\t\tconst asyncFunction = new Function(`return (async () => { ${data.code} })()`);\n\t\t\t\t\t\tconst result = await asyncFunction(); // Await the result of the async function\n\n\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\tcb(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error executing code:', error);\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'input') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\teventConfirmationInput = true;\n\t\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\t\teventConfirmationInputPlaceholder = data.placeholder;\n\t\t\t\t\teventConfirmationInputValue = data?.value ?? '';\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Unknown message type', data);\n\t\t\t\t}\n\n\t\t\t\thistory.messages[event.message_id] = message;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onMessageHandler = async (event: {\n\t\torigin: string;\n\t\tdata: { type: string; text: string };\n\t}) => {\n\t\tif (event.origin !== window.origin) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.data.type === 'action:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (prompt !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\t// Replace with your iframe's origin\n\t\tif (event.data.type === 'input:prompt') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tconst inputElement = document.getElementById('chat-input');\n\n\t\t\tif (inputElement) {\n\t\t\t\tmessageInput?.setText(event.data.text);\n\t\t\t\tinputElement.focus();\n\t\t\t}\n\t\t}\n\n\t\tif (event.data.type === 'input:prompt:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (event.data.text !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(event.data.text);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst savedModelIds = async () => {\n\t\tif (\n\t\t\t$selectedFolder &&\n\t\t\tselectedModels.filter((modelId) => modelId !== '').length > 0 &&\n\t\t\tJSON.stringify($selectedFolder?.data?.model_ids) !== JSON.stringify(selectedModels)\n\t\t) {\n\t\t\tconst res = await updateFolderById(localStorage.token, $selectedFolder.id, {\n\t\t\t\tdata: {\n\t\t\t\t\tmodel_ids: selectedModels\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t$: if (selectedModels !== null) {\n\t\tsavedModelIds();\n\t}\n\n\tlet pageSubscribe = null;\n\tlet showControlsSubscribe = null;\n\tlet selectedFolderSubscribe = null;\n\n\tonMount(async () => {\n\t\tloading = true;\n\t\tconsole.log('mounted');\n\t\twindow.addEventListener('message', onMessageHandler);\n\t\t$socket?.on('events', chatEventHandler);\n\n\t\tpageSubscribe = page.subscribe(async (p) => {\n\t\t\tif (p.url.pathname === '/') {\n\t\t\t\tawait tick();\n\t\t\t\tinitNewChat();\n\t\t\t}\n\t\t});\n\n\t\tconst storageChatInput = sessionStorage.getItem(\n\t\t\t`chat-input${chatIdProp ? `-${chatIdProp}` : ''}`\n\t\t);\n\n\t\tif (!chatIdProp) {\n\t\t\tloading = false;\n\t\t\tawait tick();\n\t\t}\n\n\t\tif (storageChatInput) {\n\t\t\tprompt = '';\n\t\t\tmessageInput?.setText('');\n\n\t\t\tfiles = [];\n\t\t\tselectedToolIds = [];\n\t\t\tselectedFilterIds = [];\n\t\t\twebSearchEnabled = false;\n\t\t\timageGenerationEnabled = false;\n\t\t\tcodeInterpreterEnabled = false;\n\n\t\t\ttry {\n\t\t\t\tconst input = JSON.parse(storageChatInput);\n\n\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\tmessageInput?.setText(input.prompt);\n\t\t\t\t\tfiles = input.files;\n\t\t\t\t\tselectedToolIds = input.selectedToolIds;\n\t\t\t\t\tselectedFilterIds = input.selectedFilterIds;\n\t\t\t\t\twebSearchEnabled = input.webSearchEnabled;\n\t\t\t\t\timageGenerationEnabled = input.imageGenerationEnabled;\n\t\t\t\t\tcodeInterpreterEnabled = input.codeInterpreterEnabled;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\tshowControlsSubscribe = showControls.subscribe(async (value) => {\n\t\t\tif (controlPane && !$mobile) {\n\t\t\t\ttry {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tcontrolPaneComponent.openPane();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontrolPane.collapse();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!value) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tshowOverview.set(false);\n\t\t\t\tshowArtifacts.set(false);\n\t\t\t\tshowEmbeds.set(false);\n\t\t\t}\n\t\t});\n\n\t\tselectedFolderSubscribe = selectedFolder.subscribe(async (folder) => {\n\t\t\tif (\n\t\t\t\tfolder?.data?.model_ids &&\n\t\t\t\tJSON.stringify(selectedModels) !== JSON.stringify(folder.data.model_ids)\n\t\t\t) {\n\t\t\t\tselectedModels = folder.data.model_ids;\n\n\t\t\t\tconsole.log('Set selectedModels from folder data:', selectedModels);\n\t\t\t}\n\t\t});\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tchatInput?.focus();\n\t});\n\n\tonDestroy(() => {\n\t\ttry {\n\t\t\tpageSubscribe();\n\t\t\tshowControlsSubscribe();\n\t\t\tselectedFolderSubscribe();\n\t\t\tchatIdUnsubscriber?.();\n\t\t\twindow.removeEventListener('message', onMessageHandler);\n\t\t\t$socket?.off('events', chatEventHandler);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t});\n\n\t// File upload functions\n\n\tconst uploadGoogleDriveFile = async (fileData) => {\n\t\tconsole.log('Starting uploadGoogleDriveFile with:', {\n\t\t\tid: fileData.id,\n\t\t\tname: fileData.name,\n\t\t\turl: fileData.url,\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${token}`\n\t\t\t}\n\t\t});\n\n\t\t// Validate input\n\t\tif (!fileData?.id || !fileData?.name || !fileData?.url || !fileData?.headers?.Authorization) {\n\t\t\tthrow new Error('Invalid file data provided');\n\t\t}\n\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: fileData.url,\n\t\t\tname: fileData.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\terror: '',\n\t\t\titemId: tempItemId,\n\t\t\tsize: 0\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, fileItem];\n\t\t\tconsole.log('Processing web file with URL:', fileData.url);\n\n\t\t\t// Configure fetch options with proper headers\n\t\t\tconst fetchOptions = {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: fileData.headers.Authorization,\n\t\t\t\t\tAccept: '*/*'\n\t\t\t\t},\n\t\t\t\tmethod: 'GET'\n\t\t\t};\n\n\t\t\t// Attempt to fetch the file\n\t\t\tconsole.log('Fetching file content from Google Drive...');\n\t\t\tconst fileResponse = await fetch(fileData.url, fetchOptions);\n\n\t\t\tif (!fileResponse.ok) {\n\t\t\t\tconst errorText = await fileResponse.text();\n\t\t\t\tthrow new Error(`Failed to fetch file (${fileResponse.status}): ${errorText}`);\n\t\t\t}\n\n\t\t\t// Get content type from response\n\t\t\tconst contentType = fileResponse.headers.get('content-type') || 'application/octet-stream';\n\t\t\tconsole.log('Response received with content-type:', contentType);\n\n\t\t\t// Convert response to blob\n\t\t\tconsole.log('Converting response to blob...');\n\t\t\tconst fileBlob = await fileResponse.blob();\n\n\t\t\tif (fileBlob.size === 0) {\n\t\t\t\tthrow new Error('Retrieved file is empty');\n\t\t\t}\n\n\t\t\tconsole.log('Blob created:', {\n\t\t\t\tsize: fileBlob.size,\n\t\t\t\ttype: fileBlob.type || contentType\n\t\t\t});\n\n\t\t\t// Create File object with proper MIME type\n\t\t\tconst file = new File([fileBlob], fileData.name, {\n\t\t\t\ttype: fileBlob.type || contentType\n\t\t\t});\n\n\t\t\tconsole.log('File object created:', {\n\t\t\t\tname: file.name,\n\t\t\t\tsize: file.size,\n\t\t\t\ttype: file.type\n\t\t\t});\n\n\t\t\tif (file.size === 0) {\n\t\t\t\tthrow new Error('Created file is empty');\n\t\t\t}\n\n\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\tlet metadata = null;\n\t\t\tif (\n\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t) {\n\t\t\t\tmetadata = {\n\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Upload file to server\n\t\t\tconsole.log('Uploading file to server...');\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata);\n\n\t\t\tif (!uploadedFile) {\n\t\t\t\tthrow new Error('Server returned null response for file upload');\n\t\t\t}\n\n\t\t\tconsole.log('File uploaded successfully:', uploadedFile);\n\n\t\t\t// Update file item with upload results\n\t\t\tfileItem.status = 'uploaded';\n\t\t\tfileItem.file = uploadedFile;\n\t\t\tfileItem.id = uploadedFile.id;\n\t\t\tfileItem.size = file.size;\n\t\t\tfileItem.collection_name = uploadedFile?.meta?.collection_name;\n\t\t\tfileItem.url = `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`;\n\n\t\t\tfiles = files;\n\t\t\ttoast.success($i18n.t('File uploaded successfully'));\n\t\t} catch (e) {\n\t\t\tconsole.error('Error uploading file:', e);\n\t\t\tfiles = files.filter((f) => f.itemId !== tempItemId);\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t('Error uploading file: {{error}}', {\n\t\t\t\t\terror: e.message || 'Unknown error'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t};\n\n\tconst uploadWeb = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst fileItem = {\n\t\t\ttype: 'text',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, fileItem];\n\t\t\tconst res = await processWeb(localStorage.token, '', url);\n\n\t\t\tif (res) {\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.collection_name = res.collection_name;\n\t\t\t\tfileItem.file = {\n\t\t\t\t\t...res.file,\n\t\t\t\t\t...fileItem.file\n\t\t\t\t};\n\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(JSON.stringify(e));\n\t\t}\n\t};\n\n\tconst uploadYoutubeTranscription = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst fileItem = {\n\t\t\ttype: 'text',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tcontext: 'full',\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, fileItem];\n\t\t\tconst res = await processYoutubeVideo(localStorage.token, url);\n\n\t\t\tif (res) {\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.collection_name = res.collection_name;\n\t\t\t\tfileItem.file = {\n\t\t\t\t\t...res.file,\n\t\t\t\t\t...fileItem.file\n\t\t\t\t};\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(`${e}`);\n\t\t}\n\t};\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst initNewChat = async () => {\n\t\tconsole.log('initNewChat');\n\t\tif ($user?.role !== 'admin' && $user?.permissions?.chat?.temporary_enforced) {\n\t\t\tawait temporaryChatEnabled.set(true);\n\t\t}\n\n\t\tif ($settings?.temporaryChatByDefault ?? false) {\n\t\t\tif ($temporaryChatEnabled === false) {\n\t\t\t\tawait temporaryChatEnabled.set(true);\n\t\t\t} else if ($temporaryChatEnabled === null) {\n\t\t\t\t// if set to null set to false; refer to temp chat toggle click handler\n\t\t\t\tawait temporaryChatEnabled.set(false);\n\t\t\t}\n\t\t}\n\n\t\tconst availableModels = $models\n\t\t\t.filter((m) => !(m?.info?.meta?.hidden ?? false))\n\t\t\t.map((m) => m.id);\n\n\t\tif ($page.url.searchParams.get('models') || $page.url.searchParams.get('model')) {\n\t\t\tconst urlModels = (\n\t\t\t\t$page.url.searchParams.get('models') ||\n\t\t\t\t$page.url.searchParams.get('model') ||\n\t\t\t\t''\n\t\t\t)?.split(',');\n\n\t\t\tif (urlModels.length === 1) {\n\t\t\t\tconst m = $models.find((m) => m.id === urlModels[0]);\n\t\t\t\tif (!m) {\n\t\t\t\t\tconst modelSelectorButton = document.getElementById('model-selector-0-button');\n\t\t\t\t\tif (modelSelectorButton) {\n\t\t\t\t\t\tmodelSelectorButton.click();\n\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\tconst modelSelectorInput = document.getElementById('model-search-input');\n\t\t\t\t\t\tif (modelSelectorInput) {\n\t\t\t\t\t\t\tmodelSelectorInput.focus();\n\t\t\t\t\t\t\tmodelSelectorInput.value = urlModels[0];\n\t\t\t\t\t\t\tmodelSelectorInput.dispatchEvent(new Event('input'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tselectedModels = urlModels;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tselectedModels = urlModels;\n\t\t\t}\n\n\t\t\tselectedModels = selectedModels.filter((modelId) =>\n\t\t\t\t$models.map((m) => m.id).includes(modelId)\n\t\t\t);\n\t\t} else {\n\t\t\tif ($selectedFolder?.data?.model_ids) {\n\t\t\t\tselectedModels = $selectedFolder?.data?.model_ids;\n\t\t\t} else {\n\t\t\t\tif (sessionStorage.selectedModels) {\n\t\t\t\t\tselectedModels = JSON.parse(sessionStorage.selectedModels);\n\t\t\t\t\tsessionStorage.removeItem('selectedModels');\n\t\t\t\t} else {\n\t\t\t\t\tif ($settings?.models) {\n\t\t\t\t\t\tselectedModels = $settings?.models;\n\t\t\t\t\t} else if ($config?.default_models) {\n\t\t\t\t\t\tconsole.log($config?.default_models.split(',') ?? '');\n\t\t\t\t\t\tselectedModels = $config?.default_models.split(',');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tselectedModels = selectedModels.filter((modelId) => availableModels.includes(modelId));\n\t\t}\n\n\t\tif (selectedModels.length === 0 || (selectedModels.length === 1 && selectedModels[0] === '')) {\n\t\t\tif (availableModels.length > 0) {\n\t\t\t\tselectedModels = [availableModels?.at(0) ?? ''];\n\t\t\t} else {\n\t\t\t\tselectedModels = [''];\n\t\t\t}\n\t\t}\n\n\t\tawait showControls.set(false);\n\t\tawait showCallOverlay.set(false);\n\t\tawait showOverview.set(false);\n\t\tawait showArtifacts.set(false);\n\n\t\tif ($page.url.pathname.includes('/c/')) {\n\t\t\twindow.history.replaceState(history.state, '', `/`);\n\t\t}\n\n\t\tautoScroll = true;\n\n\t\tresetInput();\n\t\tawait chatId.set('');\n\t\tawait chatTitle.set('');\n\n\t\thistory = {\n\t\t\tmessages: {},\n\t\t\tcurrentId: null\n\t\t};\n\n\t\tchatFiles = [];\n\t\tparams = {};\n\n\t\tif ($page.url.searchParams.get('youtube')) {\n\t\t\tuploadYoutubeTranscription(\n\t\t\t\t`https://www.youtube.com/watch?v=${$page.url.searchParams.get('youtube')}`\n\t\t\t);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('load-url')) {\n\t\t\tawait uploadWeb($page.url.searchParams.get('load-url'));\n\t\t}\n\n\t\tif ($page.url.searchParams.get('web-search') === 'true') {\n\t\t\twebSearchEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('image-generation') === 'true') {\n\t\t\timageGenerationEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('code-interpreter') === 'true') {\n\t\t\tcodeInterpreterEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('tools')) {\n\t\t\tselectedToolIds = $page.url.searchParams\n\t\t\t\t.get('tools')\n\t\t\t\t?.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\t\t} else if ($page.url.searchParams.get('tool-ids')) {\n\t\t\tselectedToolIds = $page.url.searchParams\n\t\t\t\t.get('tool-ids')\n\t\t\t\t?.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('call') === 'true') {\n\t\t\tshowCallOverlay.set(true);\n\t\t\tshowControls.set(true);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('q')) {\n\t\t\tconst q = $page.url.searchParams.get('q') ?? '';\n\t\t\tmessageInput?.setText(q);\n\n\t\t\tif (q) {\n\t\t\t\tif (($page.url.searchParams.get('submit') ?? 'true') === 'true') {\n\t\t\t\t\tawait tick();\n\t\t\t\t\tsubmitPrompt(q);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\tif (userSettings) {\n\t\t\tsettings.set(userSettings.ui);\n\t\t} else {\n\t\t\tsettings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t}\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tsetTimeout(() => chatInput?.focus(), 0);\n\t};\n\n\tconst loadChat = async () => {\n\t\tchatId.set(chatIdProp);\n\n\t\tif ($temporaryChatEnabled) {\n\t\t\ttemporaryChatEnabled.set(false);\n\t\t}\n\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\ttags = await getTagsById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\t\treturn [];\n\t\t\t});\n\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\n\t\t\t\tif (!($user?.role === 'admin' || ($user?.permissions?.chat?.multiple_models ?? true))) {\n\t\t\t\t\tselectedModels = selectedModels.length > 0 ? [selectedModels[0]] : [''];\n\t\t\t\t}\n\n\t\t\t\toldSelectedModelIds = selectedModels;\n\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\n\t\t\t\tchatTitle.set(chatContent.title);\n\n\t\t\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\t\t\tif (userSettings) {\n\t\t\t\t\tawait settings.set(userSettings.ui);\n\t\t\t\t} else {\n\t\t\t\t\tawait settings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t\t\t}\n\n\t\t\t\tparams = chatContent?.params ?? {};\n\t\t\t\tchatFiles = chatContent?.files ?? [];\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (history.currentId) {\n\t\t\t\t\tfor (const message of Object.values(history.messages)) {\n\t\t\t\t\t\tif (message.role === 'assistant') {\n\t\t\t\t\t\t\tmessage.done = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst taskRes = await getTaskIdsByChatId(localStorage.token, $chatId).catch((error) => {\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (taskRes) {\n\t\t\t\t\ttaskIds = taskRes.task_ids;\n\t\t\t\t}\n\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToBottom = async (behavior = 'auto') => {\n\t\tawait tick();\n\t\tif (messagesContainerElement) {\n\t\t\tmessagesContainerElement.scrollTo({\n\t\t\t\ttop: messagesContainerElement.scrollHeight,\n\t\t\t\tbehavior\n\t\t\t});\n\t\t}\n\t};\n\tconst chatCompletedHandler = async (chatId, modelId, responseMessageId, messages) => {\n\t\tconst res = await chatCompleted(localStorage.token, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp,\n\t\t\t\t...(m.usage ? { usage: m.usage } : {}),\n\t\t\t\t...(m.sources ? { sources: m.sources } : {})\n\t\t\t})),\n\t\t\tfilter_ids: selectedFilterIds.length > 0 ? selectedFilterIds : undefined,\n\t\t\tmodel_item: $models.find((m) => m.id === modelId),\n\t\t\tchat_id: chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\tmessages.at(-1).error = { content: error };\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null && res.messages) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\tif (message?.id) {\n\t\t\t\t\t// Add null check for message and message.id\n\t\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t...message\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($chatId == chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\n\t\ttaskIds = null;\n\t};\n\n\tconst chatActionHandler = async (chatId, actionId, modelId, responseMessageId, event = null) => {\n\t\tconst messages = createMessagesList(history, responseMessageId);\n\n\t\tconst res = await chatAction(localStorage.token, actionId, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp,\n\t\t\t\t...(m.sources ? { sources: m.sources } : {})\n\t\t\t})),\n\t\t\t...(event ? { event: event } : {}),\n\t\t\tmodel_item: $models.find((m) => m.id === modelId),\n\t\t\tchat_id: chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\tmessages.at(-1).error = { content: error };\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null && res.messages) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\n\t\treturn setInterval(() => {\n\t\t\t$socket?.emit('usage', {\n\t\t\t\taction: 'chat',\n\t\t\t\tmodel: modelId,\n\t\t\t\tchat_id: chatId\n\t\t\t});\n\t\t}, 1000);\n\t};\n\n\tconst createMessagePair = async (userPrompt) => {\n\t\tmessageInput?.setText('');\n\t\tif (selectedModels.length === 0) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t} else {\n\t\t\tconst modelId = selectedModels[0];\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\tconst parentMessage = messages.length !== 0 ? messages.at(-1) : null;\n\n\t\t\tconst userMessageId = uuidv4();\n\t\t\tconst responseMessageId = uuidv4();\n\n\t\t\tconst userMessage = {\n\t\t\t\tid: userMessageId,\n\t\t\t\tparentId: parentMessage ? parentMessage.id : null,\n\t\t\t\tchildrenIds: [responseMessageId],\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userPrompt ? userPrompt : `[PROMPT] ${userMessageId}`,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t};\n\n\t\t\tconst responseMessage = {\n\t\t\t\tid: responseMessageId,\n\t\t\t\tparentId: userMessageId,\n\t\t\t\tchildrenIds: [],\n\t\t\t\trole: 'assistant',\n\t\t\t\tcontent: `[RESPONSE] ${responseMessageId}`,\n\t\t\t\tdone: true,\n\n\t\t\t\tmodel: modelId,\n\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\tmodelIdx: 0,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t};\n\n\t\t\tif (parentMessage) {\n\t\t\t\tparentMessage.childrenIds.push(userMessageId);\n\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t}\n\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\thistory.messages[responseMessageId] = responseMessage;\n\n\t\t\thistory.currentId = responseMessageId;\n\n\t\t\tawait tick();\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tif (messages.length === 0) {\n\t\t\t\tawait initChatHandler(history);\n\t\t\t} else {\n\t\t\t\tawait saveChatHandler($chatId, history);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst addMessages = async ({ modelId, parentId, messages }) => {\n\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\tlet parentMessage = history.messages[parentId];\n\t\tlet currentParentId = parentMessage ? parentMessage.id : null;\n\t\tfor (const message of messages) {\n\t\t\tlet messageId = uuidv4();\n\n\t\t\tif (message.role === 'user') {\n\t\t\t\tconst userMessage = {\n\t\t\t\t\tid: messageId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\t...message\n\t\t\t\t};\n\n\t\t\t\tif (parentMessage) {\n\t\t\t\t\tparentMessage.childrenIds.push(messageId);\n\t\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t\t}\n\n\t\t\t\thistory.messages[messageId] = userMessage;\n\t\t\t\tparentMessage = userMessage;\n\t\t\t\tcurrentParentId = messageId;\n\t\t\t} else {\n\t\t\t\tconst responseMessage = {\n\t\t\t\t\tid: messageId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\tdone: true,\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: 0,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\t...message\n\t\t\t\t};\n\n\t\t\t\tif (parentMessage) {\n\t\t\t\t\tparentMessage.childrenIds.push(messageId);\n\t\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t\t}\n\n\t\t\t\thistory.messages[messageId] = responseMessage;\n\t\t\t\tparentMessage = responseMessage;\n\t\t\t\tcurrentParentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\thistory.currentId = currentParentId;\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length === 0) {\n\t\t\tawait initChatHandler(history);\n\t\t} else {\n\t\t\tawait saveChatHandler($chatId, history);\n\t\t}\n\t};\n\n\tconst chatCompletionEventHandler = async (data, message, chatId) => {\n\t\tconst { id, done, choices, content, sources, selected_model_id, error, usage } = data;\n\n\t\tif (error) {\n\t\t\tawait handleOpenAIError(error, message);\n\t\t}\n\n\t\tif (sources && !message?.sources) {\n\t\t\tmessage.sources = sources;\n\t\t}\n\n\t\tif (choices) {\n\t\t\tif (choices[0]?.message?.content) {\n\t\t\t\t// Non-stream response\n\t\t\t\tmessage.content += choices[0]?.message?.content;\n\t\t\t} else {\n\t\t\t\t// Stream response\n\t\t\t\tlet value = choices[0]?.delta?.content ?? '';\n\t\t\t\tif (message.content == '' && value == '\\n') {\n\t\t\t\t\tconsole.log('Empty response');\n\t\t\t\t} else {\n\t\t\t\t\tmessage.content += value;\n\n\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\t\t\tnavigator.vibrate(5);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Emit chat event for TTS\n\t\t\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t\t);\n\t\t\t\t\tmessageContentParts.pop();\n\n\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\tif (\n\t\t\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== message.lastSentence\n\t\t\t\t\t) {\n\t\t\t\t\t\tmessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (content) {\n\t\t\t// REALTIME_CHAT_SAVE is disabled\n\t\t\tmessage.content = content;\n\n\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\tnavigator.vibrate(5);\n\t\t\t}\n\n\t\t\t// Emit chat event for TTS\n\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t);\n\t\t\tmessageContentParts.pop();\n\n\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\tif (\n\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== message.lastSentence\n\t\t\t) {\n\t\t\t\tmessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (selected_model_id) {\n\t\t\tmessage.selectedModelId = selected_model_id;\n\t\t\tmessage.arena = true;\n\t\t}\n\n\t\tif (usage) {\n\t\t\tmessage.usage = usage;\n\t\t}\n\n\t\thistory.messages[message.id] = message;\n\n\t\tif (done) {\n\t\t\tmessage.done = true;\n\n\t\t\tif ($settings.responseAutoCopy) {\n\t\t\t\tcopyToClipboard(message.content);\n\t\t\t}\n\n\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\tawait tick();\n\t\t\t\tdocument.getElementById(`speak-button-${message.id}`)?.click();\n\t\t\t}\n\n\t\t\t// Emit chat event for TTS\n\t\t\tlet lastMessageContentPart =\n\t\t\t\tgetMessageContentParts(\n\t\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t)?.at(-1) ?? '';\n\t\t\tif (lastMessageContentPart) {\n\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\tdetail: { id: message.id, content: lastMessageContentPart }\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\tcontent: message.content\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\n\t\t\thistory.messages[message.id] = message;\n\n\t\t\tawait tick();\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tawait chatCompletedHandler(\n\t\t\t\tchatId,\n\t\t\t\tmessage.model,\n\t\t\t\tmessage.id,\n\t\t\t\tcreateMessagesList(history, message.id)\n\t\t\t);\n\t\t}\n\n\t\tconsole.log(data);\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\t};\n\n\t//////////////////////////\n\t// Chat functions\n\t//////////////////////////\n\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\n\t\tconsole.log('submitPrompt', userPrompt, $chatId);\n\n\t\tconst _selectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tif (JSON.stringify(selectedModels) !== JSON.stringify(_selectedModels)) {\n\t\t\tselectedModels = _selectedModels;\n\t\t}\n\n\t\tif (userPrompt === '' && files.length === 0) {\n\t\t\ttoast.error($i18n.t('Please enter a prompt'));\n\t\t\treturn;\n\t\t}\n\t\tif (selectedModels.includes('')) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tfiles.length > 0 &&\n\t\t\tfiles.filter((file) => file.type !== 'image' && file.status === 'uploading').length > 0\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`Oops! There are files still uploading. Please wait for the upload to complete.`)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + chatFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (history?.currentId) {\n\t\t\tconst lastMessage = history.messages[history.currentId];\n\t\t\tif (lastMessage.done != true) {\n\t\t\t\t// Response not done\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (lastMessage.error && !lastMessage.content) {\n\t\t\t\t// Error in response\n\t\t\t\ttoast.error($i18n.t(`Oops! There was an error in the previous response.`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tmessageInput?.setText('');\n\t\tprompt = '';\n\n\t\tconst messages = createMessagesList(history, history.currentId);\n\t\tconst _files = JSON.parse(JSON.stringify(files));\n\n\t\tchatFiles.push(\n\t\t\t..._files.filter((item) =>\n\t\t\t\t['doc', 'text', 'file', 'note', 'chat', 'folder', 'collection'].includes(item.type)\n\t\t\t)\n\t\t);\n\t\tchatFiles = chatFiles.filter(\n\t\t\t// Remove duplicates\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tfiles = [];\n\t\tmessageInput?.setText('');\n\n\t\t// Create user message\n\t\tlet userMessageId = uuidv4();\n\t\tlet userMessage = {\n\t\t\tid: userMessageId,\n\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\tchildrenIds: [],\n\t\t\trole: 'user',\n\t\t\tcontent: userPrompt,\n\t\t\tfiles: _files.length > 0 ? _files : undefined,\n\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\n\t\t\tmodels: selectedModels\n\t\t};\n\n\t\t// Add message to history and Set currentId to messageId\n\t\thistory.messages[userMessageId] = userMessage;\n\t\thistory.currentId = userMessageId;\n\n\t\t// Append messageId to childrenIds of parent message\n\t\tif (messages.length !== 0) {\n\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t}\n\n\t\t// focus on chat input\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tchatInput?.focus();\n\n\t\tsaveSessionSelectedModels();\n\n\t\tawait sendMessage(history, userMessageId, { newChat: true });\n\t};\n\n\tconst generateUserTurn = async () => {\n\t\tconsole.log('generateUserTurn called');\n\n\t\tif (!params.system || params.system.trim() === '') {\n\t\t\ttoast.error($i18n.t('Please enter a system prompt first'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (selectedModels.length === 0 || selectedModels[0] === '') {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// Build the conversation history for the prompt\n\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\tlet promptText = `<|start_header_id|>system<|end_header_id|>\\n${params.system}<|eot_id|>`;\n\n\t\t\t// Add any existing conversation turns\n\t\t\tfor (const msg of messages) {\n\t\t\t\tif (msg.role === 'user') {\n\t\t\t\t\tpromptText += `<|start_header_id|>user<|end_header_id|>\\n${msg.content}<|eot_id|>`;\n\t\t\t\t} else if (msg.role === 'assistant') {\n\t\t\t\t\tpromptText += `<|start_header_id|>assistant<|end_header_id|>\\n${msg.content}<|eot_id|>`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add the user header to prompt for user generation\n\t\t\tpromptText += `<|start_header_id|>user<|end_header_id|>\\n`;\n\n\t\t\tconst res = await generateOpenAICompletion(localStorage.token, {\n\t\t\t\tmodel: selectedModels[0],\n\t\t\t\tprompt: promptText,\n\t\t\t\tmax_tokens: 256,\n\t\t\t\ttemperature: 1.0,\n\t\t\t\ttop_p: 0.8,\n\t\t\t\tstop: ['<|eot_id|>', '<|endconversation|>']\n\t\t\t});\n\n\t\t\tif (res && res.choices && res.choices[0]?.text) {\n\t\t\t\tconst generatedText = res.choices[0].text.trim();\n\t\t\t\tconsole.log('Generated user turn:', generatedText);\n\n\t\t\t\t// Create a user message with the generated content\n\t\t\t\tlet userMessageId = uuidv4();\n\t\t\t\tlet userMessage = {\n\t\t\t\t\tid: userMessageId,\n\t\t\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: generatedText,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tdone: true\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\t\thistory.currentId = userMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (messages.length !== 0) {\n\t\t\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t\t\t}\n\n\t\t\t\t// Trigger reactivity\n\t\t\t\thistory = history;\n\n\t\t\t\tawait tick();\n\t\t\t\tif (autoScroll) {\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t}\n\n\t\t\t\ttoast.success($i18n.t('User turn generated successfully'));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Error generating user turn:', error);\n\t\t\ttoast.error($i18n.t('Failed to generate user turn: ') + (error?.message || error));\n\t\t}\n\t};\n\n\tconst sendMessage = async (\n\t\t_history,\n\t\tparentId: string,\n\t\t{\n\t\t\tmessages = null,\n\t\t\tmodelId = null,\n\t\t\tmodelIdx = null,\n\t\t\tnewChat = false\n\t\t}: {\n\t\t\tmessages?: any[] | null;\n\t\t\tmodelId?: string | null;\n\t\t\tmodelIdx?: number | null;\n\t\t\tnewChat?: boolean;\n\t\t} = {}\n\t) => {\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tlet _chatId = JSON.parse(JSON.stringify($chatId));\n\t\t_history = JSON.parse(JSON.stringify(_history));\n\n\t\tconst responseMessageIds: Record<PropertyKey, string> = {};\n\t\t// If modelId is provided, use it, else use selected model\n\t\tlet selectedModelIds = modelId\n\t\t\t? [modelId]\n\t\t\t: atSelectedModel !== undefined\n\t\t\t\t? [atSelectedModel.id]\n\t\t\t\t: selectedModels;\n\n\t\t// Create response messages for each selected model\n\t\tfor (const [_modelIdx, modelId] of selectedModelIds.entries()) {\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tlet responseMessageId = uuidv4();\n\t\t\t\tlet responseMessage = {\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: modelIdx ? modelIdx : _modelIdx,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null && history.messages[parentId]) {\n\t\t\t\t\t// Add null check before accessing childrenIds\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`] = responseMessageId;\n\t\t\t}\n\t\t}\n\t\thistory = history;\n\n\t\t// Create new chat if newChat is true and first user message\n\t\tif (newChat && _history.messages[_history.currentId].parentId === null) {\n\t\t\t_chatId = await initChatHandler(_history);\n\t\t}\n\n\t\tawait tick();\n\n\t\t_history = JSON.parse(JSON.stringify(history));\n\t\t// Save chat after all messages have been created\n\t\tawait saveChatHandler(_chatId, _history);\n\n\t\tawait Promise.all(\n\t\t\tselectedModelIds.map(async (modelId, _modelIdx) => {\n\t\t\t\tconsole.log('modelId', modelId);\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\t\tif (model) {\n\t\t\t\t\t// If there are image files, check if model is vision capable\n\t\t\t\t\tconst hasImages = createMessagesList(_history, parentId).some((message) =>\n\t\t\t\t\t\tmessage.files?.some((file) => file.type === 'image')\n\t\t\t\t\t);\n\n\t\t\t\t\tif (hasImages && !(model.info?.meta?.capabilities?.vision ?? true)) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet responseMessageId =\n\t\t\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`];\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\n\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t\tawait sendMessageSocket(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tmessages && messages.length > 0\n\t\t\t\t\t\t\t? messages\n\t\t\t\t\t\t\t: createMessagesList(_history, responseMessageId),\n\t\t\t\t\t\t_history,\n\t\t\t\t\t\tresponseMessageId,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tcurrentChatPage.set(1);\n\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\t};\n\n\tconst getFeatures = () => {\n\t\tlet features = {};\n\n\t\tif ($config?.features)\n\t\t\tfeatures = {\n\t\t\t\timage_generation:\n\t\t\t\t\t$config?.features?.enable_image_generation &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.image_generation)\n\t\t\t\t\t\t? imageGenerationEnabled\n\t\t\t\t\t\t: false,\n\t\t\t\tcode_interpreter:\n\t\t\t\t\t$config?.features?.enable_code_interpreter &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.code_interpreter)\n\t\t\t\t\t\t? codeInterpreterEnabled\n\t\t\t\t\t\t: false,\n\t\t\t\tweb_search:\n\t\t\t\t\t$config?.features?.enable_web_search &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.web_search)\n\t\t\t\t\t\t? webSearchEnabled\n\t\t\t\t\t\t: false\n\t\t\t};\n\n\t\tconst currentModels = atSelectedModel?.id ? [atSelectedModel.id] : selectedModels;\n\t\tif (\n\t\t\tcurrentModels.filter(\n\t\t\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.web_search ?? true\n\t\t\t).length === currentModels.length\n\t\t) {\n\t\t\tif ($config?.features?.enable_web_search && ($settings?.webSearch ?? false) === 'always') {\n\t\t\t\tfeatures = { ...features, web_search: true };\n\t\t\t}\n\t\t}\n\n\t\tif ($settings?.memory ?? false) {\n\t\t\tfeatures = { ...features, memory: true };\n\t\t}\n\n\t\treturn features;\n\t};\n\n\tconst sendMessageSocket = async (model, _messages, _history, responseMessageId, _chatId) => {\n\t\tconst responseMessage = _history.messages[responseMessageId];\n\t\tconst userMessage = _history.messages[responseMessage.parentId];\n\n\t\tconst chatMessageFiles = _messages\n\t\t\t.filter((message) => message.files)\n\t\t\t.flatMap((message) => message.files);\n\n\t\t// Filter chatFiles to only include files that are in the chatMessageFiles\n\t\tchatFiles = chatFiles.filter((item) => {\n\t\t\tconst fileExists = chatMessageFiles.some((messageFile) => messageFile.id === item.id);\n\t\t\treturn fileExists;\n\t\t});\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tfiles.push(\n\t\t\t...(userMessage?.files ?? []).filter((item) =>\n\t\t\t\t['doc', 'text', 'file', 'note', 'chat', 'collection'].includes(item.type)\n\t\t\t)\n\t\t);\n\t\t// Remove duplicates\n\t\tfiles = files.filter(\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tscrollToBottom();\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tawait tick();\n\n\t\tlet userLocation;\n\t\tif ($settings?.userLocation) {\n\t\t\tuserLocation = await getAndUpdateUserLocation(localStorage.token).catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t\treturn undefined;\n\t\t\t});\n\t\t}\n\n\t\tconst stream =\n\t\t\tmodel?.info?.params?.stream_response ??\n\t\t\t$settings?.params?.stream_response ??\n\t\t\tparams?.stream_response ??\n\t\t\ttrue;\n\n\t\tlet messages = [\n\t\t\tparams?.system || $settings.system\n\t\t\t\t? {\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: `${params?.system ?? $settings?.system ?? ''}`\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\t..._messages.map((message) => ({\n\t\t\t\t...message,\n\t\t\t\tcontent: processDetails(message.content)\n\t\t\t}))\n\t\t].filter((message) => message);\n\n\t\tmessages = messages\n\t\t\t.map((message, idx, arr) => ({\n\t\t\t\trole: message.role,\n\t\t\t\t...((message.files?.filter((file) => file.type === 'image').length > 0 ?? false) &&\n\t\t\t\tmessage.role === 'user'\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\ttext: message?.merged?.content ?? message.content\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t...message.files\n\t\t\t\t\t\t\t\t\t.filter((file) => file.type === 'image')\n\t\t\t\t\t\t\t\t\t.map((file) => ({\n\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\t\t\t\t\t\timage_url: {\n\t\t\t\t\t\t\t\t\t\t\turl: file.url\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\t\tcontent: message?.merged?.content ?? message.content\n\t\t\t\t\t\t})\n\t\t\t}))\n\t\t\t.filter((message) => message?.role === 'user' || message?.content?.trim());\n\n\t\tconst toolIds = [];\n\t\tconst toolServerIds = [];\n\n\t\tfor (const toolId of selectedToolIds) {\n\t\t\tif (toolId.startsWith('direct_server:')) {\n\t\t\t\tlet serverId = toolId.replace('direct_server:', '');\n\t\t\t\t// Check if serverId is a number\n\t\t\t\tif (!isNaN(parseInt(serverId))) {\n\t\t\t\t\ttoolServerIds.push(parseInt(serverId));\n\t\t\t\t} else {\n\t\t\t\t\ttoolServerIds.push(serverId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoolIds.push(toolId);\n\t\t\t}\n\t\t}\n\n\t\tconst res = await generateOpenAIChatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tstream: stream,\n\t\t\t\tmodel: model.id,\n\t\t\t\tmessages: messages,\n\t\t\t\tparams: {\n\t\t\t\t\t...$settings?.params,\n\t\t\t\t\t...params,\n\t\t\t\t\tstop:\n\t\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\n\t\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\n\t\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t},\n\n\t\t\t\tfiles: (files?.length ?? 0) > 0 ? files : undefined,\n\n\t\t\t\tfilter_ids: selectedFilterIds.length > 0 ? selectedFilterIds : undefined,\n\t\t\t\ttool_ids: toolIds.length > 0 ? toolIds : undefined,\n\t\t\t\ttool_servers: ($toolServers ?? []).filter(\n\t\t\t\t\t(server, idx) => toolServerIds.includes(idx) || toolServerIds.includes(server?.id)\n\t\t\t\t),\n\t\t\t\tfeatures: getFeatures(),\n\t\t\t\tvariables: {\n\t\t\t\t\t...getPromptVariables($user?.name, $settings?.userLocation ? userLocation : undefined)\n\t\t\t\t},\n\t\t\t\tmodel_item: $models.find((m) => m.id === model.id),\n\n\t\t\t\tsession_id: $socket?.id,\n\t\t\t\tchat_id: $chatId,\n\t\t\t\tid: responseMessageId,\n\n\t\t\t\tbackground_tasks: {\n\t\t\t\t\t...(!$temporaryChatEnabled &&\n\t\t\t\t\t(messages.length == 1 ||\n\t\t\t\t\t\t(messages.length == 2 &&\n\t\t\t\t\t\t\tmessages.at(0)?.role === 'system' &&\n\t\t\t\t\t\t\tmessages.at(1)?.role === 'user')) &&\n\t\t\t\t\t(selectedModels[0] === model.id || atSelectedModel !== undefined)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\ttitle_generation: $settings?.title?.auto ?? true,\n\t\t\t\t\t\t\t\ttags_generation: $settings?.autoTags ?? true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {}),\n\t\t\t\t\tfollow_up_generation: $settings?.autoFollowUps ?? true\n\t\t\t\t},\n\n\t\t\t\t...(stream && (model.info?.meta?.capabilities?.usage ?? false)\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tstream_options: {\n\t\t\t\t\t\t\t\tinclude_usage: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t).catch(async (error) => {\n\t\t\tconsole.log(error);\n\n\t\t\tlet errorMessage = error;\n\t\t\tif (error?.error?.message) {\n\t\t\t\terrorMessage = error.error.message;\n\t\t\t} else if (error?.message) {\n\t\t\t\terrorMessage = error.message;\n\t\t\t}\n\n\t\t\tif (typeof errorMessage === 'object') {\n\t\t\t\terrorMessage = $i18n.t(`Uh-oh! There was an issue with the response.`);\n\t\t\t}\n\n\t\t\ttoast.error(`${errorMessage}`);\n\t\t\tresponseMessage.error = {\n\t\t\t\tcontent: error\n\t\t\t};\n\n\t\t\tresponseMessage.done = true;\n\n\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\thistory.currentId = responseMessageId;\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tif (res.error) {\n\t\t\t\tawait handleOpenAIError(res.error, responseMessage);\n\t\t\t} else {\n\t\t\t\tif (taskIds) {\n\t\t\t\t\ttaskIds.push(res.task_id);\n\t\t\t\t} else {\n\t\t\t\t\ttaskIds = [res.task_id];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\t\tscrollToBottom();\n\t};\n\n\tconst handleOpenAIError = async (error, responseMessage) => {\n\t\tlet errorMessage = '';\n\t\tlet innerError;\n\n\t\tif (error) {\n\t\t\tinnerError = error;\n\t\t}\n\n\t\tconsole.error(innerError);\n\t\tif ('detail' in innerError) {\n\t\t\t// FastAPI error\n\t\t\ttoast.error(innerError.detail);\n\t\t\terrorMessage = innerError.detail;\n\t\t} else if ('error' in innerError) {\n\t\t\t// OpenAI error\n\t\t\tif ('message' in innerError.error) {\n\t\t\t\ttoast.error(innerError.error.message);\n\t\t\t\terrorMessage = innerError.error.message;\n\t\t\t} else {\n\t\t\t\ttoast.error(innerError.error);\n\t\t\t\terrorMessage = innerError.error;\n\t\t\t}\n\t\t} else if ('message' in innerError) {\n\t\t\t// OpenAI error\n\t\t\ttoast.error(innerError.message);\n\t\t\terrorMessage = innerError.message;\n\t\t}\n\n\t\tresponseMessage.error = {\n\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue with the response.`) + '\\n' + errorMessage\n\t\t};\n\t\tresponseMessage.done = true;\n\n\t\tif (responseMessage.statusHistory) {\n\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t);\n\t\t}\n\n\t\thistory.messages[responseMessage.id] = responseMessage;\n\t};\n\n\tconst stopResponse = async () => {\n\t\tif (taskIds) {\n\t\t\tfor (const taskId of taskIds) {\n\t\t\t\tconst res = await stopTask(localStorage.token, taskId).catch((error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttaskIds = null;\n\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\t// Set all response messages to done\n\t\t\tfor (const messageId of history.messages[responseMessage.parentId].childrenIds) {\n\t\t\t\thistory.messages[messageId].done = true;\n\t\t\t}\n\n\t\t\thistory.messages[history.currentId] = responseMessage;\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\t\t}\n\n\t\tif (generating) {\n\t\t\tgenerating = false;\n\t\t\tgenerationController?.abort();\n\t\t\tgenerationController = null;\n\t\t}\n\t};\n\n\tconst submitMessage = async (parentId, prompt) => {\n\t\tlet userPrompt = prompt;\n\t\tlet userMessageId = uuidv4();\n\n\t\tlet userMessage = {\n\t\t\tid: userMessageId,\n\t\t\tparentId: parentId,\n\t\t\tchildrenIds: [],\n\t\t\trole: 'user',\n\t\t\tcontent: userPrompt,\n\t\t\tmodels: selectedModels,\n\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t};\n\n\t\tif (parentId !== null) {\n\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\tuserMessageId\n\t\t\t];\n\t\t}\n\n\t\thistory.messages[userMessageId] = userMessage;\n\t\thistory.currentId = userMessageId;\n\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tawait sendMessage(history, userMessageId);\n\t};\n\n\tconst regenerateResponse = async (message, suggestionPrompt = null) => {\n\t\tconsole.log('regenerateResponse');\n\n\t\tif (history.currentId) {\n\t\t\tlet userMessage = history.messages[message.parentId];\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tawait sendMessage(history, userMessage.id, {\n\t\t\t\t...(suggestionPrompt\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tmessages: [\n\t\t\t\t\t\t\t\t...createMessagesList(history, message.id),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trole: 'user',\n\t\t\t\t\t\t\t\t\tcontent: suggestionPrompt\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t: {}),\n\t\t\t\t...((userMessage?.models ?? [...selectedModels]).length > 1\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t// If multiple models are selected, use the model from the message\n\t\t\t\t\t\t\tmodelId: message.model,\n\t\t\t\t\t\t\tmodelIdx: message.modelIdx\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t});\n\t\t}\n\t};\n\n\tconst continueResponse = async () => {\n\t\tconsole.log('continueResponse');\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tif (history.currentId && history.messages[history.currentId].done == true) {\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\tresponseMessage.done = false;\n\t\t\tawait tick();\n\n\t\t\tconst model = $models\n\t\t\t\t.filter((m) => m.id === (responseMessage?.selectedModelId ?? responseMessage.model))\n\t\t\t\t.at(0);\n\n\t\t\tif (model) {\n\t\t\t\tawait sendMessageSocket(\n\t\t\t\t\tmodel,\n\t\t\t\t\tcreateMessagesList(history, responseMessage.id),\n\t\t\t\t\thistory,\n\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t_chatId\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst mergeResponses = async (messageId, responses, _chatId) => {\n\t\tconsole.log('mergeResponses', messageId, responses);\n\t\tconst message = history.messages[messageId];\n\t\tconst mergedResponse = {\n\t\t\tstatus: true,\n\t\t\tcontent: ''\n\t\t};\n\t\tmessage.merged = mergedResponse;\n\t\thistory.messages[messageId] = message;\n\n\t\ttry {\n\t\t\tgenerating = true;\n\t\t\tconst [res, controller] = await generateMoACompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tmessage.model,\n\t\t\t\thistory.messages[message.parentId].content,\n\t\t\t\tresponses\n\t\t\t);\n\n\t\t\tif (res && res.ok && res.body && generating) {\n\t\t\t\tgenerationController = controller;\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, sources, error, usage } = update;\n\t\t\t\t\tif (error || done) {\n\t\t\t\t\t\tgenerating = false;\n\t\t\t\t\t\tgenerationController = null;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mergedResponse.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmergedResponse.content += value;\n\t\t\t\t\t\thistory.messages[messageId] = message;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait saveChatHandler(_chatId, history);\n\t\t\t} else {\n\t\t\t\tconsole.error(res);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t};\n\n\tconst initChatHandler = async (history) => {\n\t\tlet _chatId = $chatId;\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\tchat = await createNewChat(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t{\n\t\t\t\t\tid: _chatId,\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\tparams: params,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmessages: createMessagesList(history, history.currentId),\n\t\t\t\t\ttags: [],\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t},\n\t\t\t\t$selectedFolder?.id\n\t\t\t);\n\n\t\t\t_chatId = chat.id;\n\t\t\tawait chatId.set(_chatId);\n\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\n\t\t\tawait tick();\n\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\tcurrentChatPage.set(1);\n\n\t\t\tselectedFolder.set(null);\n\t\t} else {\n\t\t\t_chatId = `local:${$socket?.id}`; // Use socket id for temporary chat\n\t\t\tawait chatId.set(_chatId);\n\t\t}\n\t\tawait tick();\n\n\t\treturn _chatId;\n\t};\n\n\tconst saveChatHandler = async (_chatId, history) => {\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmessages: createMessagesList(history, history.currentId),\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst MAX_DRAFT_LENGTH = 5000;\n\tlet saveDraftTimeout = null;\n\n\tconst saveDraft = async (draft, chatId = null) => {\n\t\tif (saveDraftTimeout) {\n\t\t\tclearTimeout(saveDraftTimeout);\n\t\t}\n\n\t\tif (draft.prompt !== null && draft.prompt.length < MAX_DRAFT_LENGTH) {\n\t\t\tsaveDraftTimeout = setTimeout(async () => {\n\t\t\t\tawait sessionStorage.setItem(\n\t\t\t\t\t`chat-input${chatId ? `-${chatId}` : ''}`,\n\t\t\t\t\tJSON.stringify(draft)\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t} else {\n\t\t\tsessionStorage.removeItem(`chat-input${chatId ? `-${chatId}` : ''}`);\n\t\t}\n\t};\n\n\tconst clearDraft = async (chatId = null) => {\n\t\tif (saveDraftTimeout) {\n\t\t\tclearTimeout(saveDraftTimeout);\n\t\t}\n\t\tawait sessionStorage.removeItem(`chat-input${chatId ? `-${chatId}` : ''}`);\n\t};\n\n\tconst moveChatHandler = async (chatId, folderId) => {\n\t\tif (chatId && folderId) {\n\t\t\tconst res = await updateChatFolderIdById(localStorage.token, chatId, folderId).catch(\n\t\t\t\t(error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (res) {\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\tawait pinnedChats.set(await getPinnedChatList(localStorage.token));\n\n\t\t\t\ttoast.success($i18n.t('Chat moved successfully'));\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Failed to move chat'));\n\t\t}\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{$settings.showChatTitleInTab !== false && $chatTitle\n\t\t\t? `${$chatTitle.length > 30 ? `${$chatTitle.slice(0, 30)}...` : $chatTitle}  ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\" />\n\n<EventConfirmDialog\n\tbind:show={showEventConfirmation}\n\ttitle={eventConfirmationTitle}\n\tmessage={eventConfirmationMessage}\n\tinput={eventConfirmationInput}\n\tinputPlaceholder={eventConfirmationInputPlaceholder}\n\tinputValue={eventConfirmationInputValue}\n\ton:confirm={(e) => {\n\t\tif (e.detail) {\n\t\t\teventCallback(e.detail);\n\t\t} else {\n\t\t\teventCallback(true);\n\t\t}\n\t}}\n\ton:cancel={() => {\n\t\teventCallback(false);\n\t}}\n/>\n\n<div\n\tclass=\"h-screen max-h-[100dvh] transition-width duration-200 ease-in-out {$showSidebar\n\t\t? '  md:max-w-[calc(100%-260px)]'\n\t\t: ' '} w-full max-w-full flex flex-col\"\n\tid=\"chat-container\"\n>\n\t{#if !loading}\n\t\t<div in:fade={{ duration: 50 }} class=\"w-full h-full flex flex-col\">\n\t\t\t{#if $selectedFolder && $selectedFolder?.meta?.background_image_url}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute {$showSidebar\n\t\t\t\t\t\t? 'md:max-w-[calc(100%-260px)] md:translate-x-[260px]'\n\t\t\t\t\t\t: ''} top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\tstyle=\"background-image: url({$selectedFolder?.meta?.background_image_url})  \"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0\"\n\t\t\t\t/>\n\t\t\t{:else if $settings?.backgroundImageUrl ?? $config?.license_metadata?.background_image_url ?? null}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute {$showSidebar\n\t\t\t\t\t\t? 'md:max-w-[calc(100%-260px)] md:translate-x-[260px]'\n\t\t\t\t\t\t: ''} top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\tstyle=\"background-image: url({$settings?.backgroundImageUrl ??\n\t\t\t\t\t\t$config?.license_metadata?.background_image_url})  \"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0\"\n\t\t\t\t/>\n\t\t\t{/if}\n\n\t\t\t<PaneGroup direction=\"horizontal\" class=\"w-full h-full\">\n\t\t\t\t<Pane defaultSize={50} minSize={30} class=\"h-full flex relative max-w-full flex-col\">\n\t\t\t\t\t<Navbar\n\t\t\t\t\t\tbind:this={navbarElement}\n\t\t\t\t\t\tchat={{\n\t\t\t\t\t\t\tid: $chatId,\n\t\t\t\t\t\t\tchat: {\n\t\t\t\t\t\t\t\ttitle: $chatTitle,\n\t\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{history}\n\t\t\t\t\t\ttitle={$chatTitle}\n\t\t\t\t\t\tbind:selectedModels\n\t\t\t\t\t\tshareEnabled={!!history.currentId}\n\t\t\t\t\t\t{initNewChat}\n\t\t\t\t\t\tarchiveChatHandler={() => {}}\n\t\t\t\t\t\t{moveChatHandler}\n\t\t\t\t\t\tonSaveTempChat={async () => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!history?.currentId || !Object.keys(history.messages).length) {\n\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('No conversation to save'));\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\t\t\t\t\t\tconst title =\n\t\t\t\t\t\t\t\t\tmessages.find((m) => m.role === 'user')?.content ?? $i18n.t('New Chat');\n\n\t\t\t\t\t\t\t\tconst savedChat = await createNewChat(\n\t\t\t\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: uuidv4(),\n\t\t\t\t\t\t\t\t\t\ttitle: title.length > 50 ? `${title.slice(0, 50)}...` : title,\n\t\t\t\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (savedChat) {\n\t\t\t\t\t\t\t\t\ttemporaryChatEnabled.set(false);\n\t\t\t\t\t\t\t\t\tchatId.set(savedChat.id);\n\t\t\t\t\t\t\t\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\n\t\t\t\t\t\t\t\t\tawait goto(`/c/${savedChat.id}`);\n\t\t\t\t\t\t\t\t\ttoast.success($i18n.t('Conversation saved successfully'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tconsole.error('Error saving conversation:', error);\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Failed to save conversation'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div class=\"flex flex-col flex-auto z-10 w-full @container overflow-auto\">\n\t\t\t\t\t\t{#if ($settings?.landingPageMode === 'chat' && !$selectedFolder) || createMessagesList(history, history.currentId).length > 0}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden\"\n\t\t\t\t\t\t\t\tid=\"messages-container\"\n\t\t\t\t\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\t\t\t\t\ton:scroll={(e) => {\n\t\t\t\t\t\t\t\t\tautoScroll =\n\t\t\t\t\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\t\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" h-full w-full flex flex-col\">\n\t\t\t\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\t\tsetInputText={(text) => {\n\t\t\t\t\t\t\t\t\t\t\tmessageInput?.setText(text);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\t\t{atSelectedModel}\n\t\t\t\t\t\t\t\t\t\t{sendMessage}\n\t\t\t\t\t\t\t\t\t\t{showMessage}\n\t\t\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t\t\t\t\t\t{chatActionHandler}\n\t\t\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t\t\ttopPadding={true}\n\t\t\t\t\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t\t\t\t\t{onSelect}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" pb-2\">\n\t\t\t\t\t\t\t\t<MessageInput\n\t\t\t\t\t\t\t\t\tbind:this={messageInput}\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{taskIds}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\t\t\t\t\tbind:showCommands\n\t\t\t\t\t\t\t\t\ttoolServers={$toolServers}\n\t\t\t\t\t\t\t\t\t{generating}\n\t\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t\t{createMessagePair}\n\t\t\t\t\t\t\t\t\tonChange={(data) => {\n\t\t\t\t\t\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tsaveDraft(data, $chatId);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:upload={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconst { type, data } = e.detail;\n\n\t\t\t\t\t\t\t\t\t\tif (type === 'web') {\n\t\t\t\t\t\t\t\t\t\t\tawait uploadWeb(data);\n\t\t\t\t\t\t\t\t\t\t} else if (type === 'youtube') {\n\t\t\t\t\t\t\t\t\t\t\tawait uploadYoutubeTranscription(data);\n\t\t\t\t\t\t\t\t\t\t} else if (type === 'google-drive') {\n\t\t\t\t\t\t\t\t\t\t\tawait uploadGoogleDriveFile(data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:submit={async (e) => {\n\t\t\t\t\t\t\t\t\t\tclearDraft();\n\t\t\t\t\t\t\t\t\t\tif (e.detail || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(e.detail.replaceAll('\\n\\n', '\\n'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('LLMs can make mistakes. Verify important information.')} -->\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"flex items-center h-full\">\n\t\t\t\t\t\t\t\t<Placeholder\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tbind:messageInput\n\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\t\t\t\t\tbind:showCommands\n\t\t\t\t\t\t\t\t\ttoolServers={$toolServers}\n\t\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t\t{createMessagePair}\n\t\t\t\t\t\t\t\t\t{onSelect}\n\t\t\t\t\t\t\t\t\tonChange={(data) => {\n\t\t\t\t\t\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tsaveDraft(data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:upload={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconst { type, data } = e.detail;\n\n\t\t\t\t\t\t\t\t\t\tif (type === 'web') {\n\t\t\t\t\t\t\t\t\t\t\tawait uploadWeb(data);\n\t\t\t\t\t\t\t\t\t\t} else if (type === 'youtube') {\n\t\t\t\t\t\t\t\t\t\t\tawait uploadYoutubeTranscription(data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:submit={async (e) => {\n\t\t\t\t\t\t\t\t\t\tclearDraft();\n\t\t\t\t\t\t\t\t\t\tif (e.detail || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(e.detail.replaceAll('\\n\\n', '\\n'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</Pane>\n\n\t\t\t\t<ChatControls\n\t\t\t\t\tbind:this={controlPaneComponent}\n\t\t\t\t\tbind:history\n\t\t\t\t\tbind:chatFiles\n\t\t\t\t\tbind:params\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:pane={controlPane}\n\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\tmodelId={selectedModelIds?.at(0) ?? null}\n\t\t\t\t\tmodels={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\t\t\tif (model) {\n\t\t\t\t\t\t\treturn [...a, model];\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t}, [])}\n\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t{generateUserTurn}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{showMessage}\n\t\t\t\t\t{eventTarget}\n\t\t\t\t/>\n\t\t\t</PaneGroup>\n\t\t</div>\n\t{:else if loading}\n\t\t<div class=\" flex items-center justify-center h-full w-full\">\n\t\t\t<div class=\"m-auto\">\n\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n"],"file":"_app/immutable/chunks/Yhn2jMBR.js"}